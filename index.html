<!DOCTYPE html>
<html lang="pt-br">
<head>
    <title>Mapa RPG Interativo 8K</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
    /* Remove margens e define o fundo */
    body { margin: 0; background: #1a1a1a; overflow: hidden; font-family: sans-serif; }
    
    /* Garante que o mapa ocupe a tela toda */
    #map { height: 100vh; width: 100vw; z-index: 1; }

    /* MENU LATERAL DE PROV√çNCIAS */
    #menu-provincias {
        position: fixed;
        top: 20px;
        right: 20px;
        width: 220px;
        background: rgba(26, 26, 26, 0.95);
        border: 2px solid #8b4513;
        border-radius: 8px;
        color: white;
        z-index: 2000; /* Garante que fique acima do mapa */
        padding: 15px;
        box-shadow: 0 0 15px rgba(0,0,0,0.8);
    }

    #menu-provincias h3 {
        text-align: center;
        margin-top: 0;
        color: #cd853f;
        border-bottom: 1px solid #555;
        padding-bottom: 10px;
    }

    .botao-provincia {
        display: block;
        width: 100%;
        padding: 10px;
        margin: 5px 0;
        background: transparent;
        color: #ddd;
        border: 1px solid #444;
        border-radius: 4px;
        text-align: left;
        cursor: pointer;
        transition: 0.3s;
    }

    .botao-provincia:hover {
        background: #8b4513;
        color: white;
        border-color: #a0522d;
    }

    /* CONTAINER DA FOTO DA CIDADE (Centralizado) */
    #provincia-container {
        display: none; /* Controlado pelo JS */
        background: #1a1a1a; 
        height: 100vh; 
        width: 100vw; 
        position: fixed;
        top: 0; left: 0;
        z-index: 3000; /* Acima de tudo */
        
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }

    #img-provincia {
        max-height: 85vh; 
        max-width: 90vw;
        object-fit: contain;
        box-shadow: 0 0 50px rgba(0,0,0,1);
        border: 2px solid #333;
    }

    /* BOT√ÉO VOLTAR (Fixo no topo esquerdo) */
    .botao-fixo-voltar {
        position: absolute;
        top: 20px;
        left: 20px;
        padding: 10px 20px;
        background: #8b4513;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-weight: bold;
        z-index: 3001;
        font-size: 14px; /* Tamanho controlado */
    }

    /* Estilo dos Popups do Leaflet */
    .leaflet-popup-content-wrapper {
        background: #2c2c2c;
        color: #fff;
        font-size: 14px;
    }
    .leaflet-popup-tip { background: #2c2c2c; }
    
    /* Bot√µes dentro dos popups */
    .btn-popup {
        background: #8b4513;
        color: white;
        border: none;
        padding: 5px 10px;
        border-radius: 3px;
        cursor: pointer;
        margin-top: 5px;
    }

    /* Fundo escuro atr√°s da janela */
    #modal-info {
        position: fixed;
        z-index: 5000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.8); /* Fundo preto transparente */
        display: flex;
        align-items: center;
        justify-content: center;
    }

    /* A janela em si */
    .modal-conteudo {
        background-color: #2c2c2c;
        border: 2px solid #cd853f; /* Borda dourada/cobre */
        width: 60%;
        max-width: 800px;
        max-height: 80vh;
        overflow-y: auto;
        padding: 30px;
        border-radius: 10px;
        color: #ddd;
        font-family: serif;
        box-shadow: 0 0 20px #cd853f;
        position: relative;
    }

    .modal-conteudo h2 {
        color: #cd853f;
        border-bottom: 1px solid #555;
        padding-bottom: 10px;
        margin-top: 0;
    }

    .modal-conteudo p {
        line-height: 1.6;
        font-size: 18px;
    }

    .modal-conteudo strong {
        color: #ffdead; /* Cor de destaque para t√≠tulos internos */
    }

    /* Bot√£o de fechar (X) */
    .fechar-modal {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
    }

    .fechar-modal:hover {
        color: white;
    }

</style>
</head>
<body>
    <div id="map-container">
        <div id="map" style="height: 100vh; width: 100vw;"></div>
    </div>

    <div id="modal-info" style="display: none;">
    <div class="modal-conteudo">
        <span class="fechar-modal" onclick="fecharModalInfo()">&times;</span>
        <h2 id="titulo-provincia">T√≠tulo da Prov√≠ncia</h2>
        <div id="texto-provincia">
            </div>
    </div>
</div>

<div id="menu-provincias">
    <h3>Prov√≠ncias</h3>
    <button class="botao-provincia" onclick="abrirMapaProvincia('Hukmal_tep.jpg')">Hukmal'tep</button>
    <button class="botao-provincia" onclick="abrirMapaProvincia('Blat_khyr.jpg')">Blat'khyr</button>
    <button class="botao-provincia" onclick="abrirMapaProvincia('Deserto.jpg')">Deserto</button>
    <button class="botao-provincia" onclick="abrirMapaProvincia('Lago.jpg')">Lago</button>
    <button class="botao-provincia" onclick="abrirMapaProvincia('Alcova.jpg')">Alcova</button>
    <button class="botao-provincia" onclick="abrirMapaProvincia('Espinha do Gigante.jpg')">Espinha do Gigante</button>
</div>

<div id="provincia-container" style="display: none;">
    <button onclick="voltarParaMapa()" class="botao-fixo-voltar" style="padding: 10px 20px; cursor: pointer; background: #8b4513; color: white; border: none; border-radius: 5px; font-family: sans-serif;">
        ‚¨Ö Voltar para o Mapa
    </button>
    <img id="img-provincia" src="">
</div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
// --- 1. CONFIGURA√á√ïES T√âCNICAS ---
    const configContinental = {
        arquivo: 'Mapa teste.png',
        largura: 7680,
        altura: 4320,
        minZoom: -1.5,
        maxZoom: 3
    };

    const configProvincia = {
        largura: 2048,
        altura: 1536,
        minZoom: -0.5,
        maxZoom: 2
    };

    let map; 
    let mapaAtualAtivo = 'continente';

    // --- 2. INICIALIZA√á√ÉO DO MAPA ---
    function inicializarMapa(arquivo, largura, altura, minZoom, maxZoom) {
        if (map) { map.remove(); } 

        const limites = [[0, 0], [altura, largura]];
        
        map = L.map('map', {
            crs: L.CRS.Simple,
            minZoom: minZoom,
            maxZoom: maxZoom,
            maxBounds: limites,
            maxBoundsViscosity: 1.0
        });

        L.imageOverlay(arquivo, limites).addTo(map);
        map.fitBounds(limites);

        // Ferramenta de Coordenadas
        map.on('click', function(e) {
            const y = e.latlng.lat.toFixed(0);
            const x = e.latlng.lng.toFixed(0);
            L.popup().setLatLng(e.latlng).setContent(`Coordenadas: [${y}, ${x}]`).openOn(map);
            console.log(`[${y}, ${x}]`);
        });
    }

    // --- 3. NAVEGA√á√ÉO ---
    function carregarMapaPrincipal() {
        mapaAtualAtivo = 'continente';
        document.getElementById('map-container').style.display = 'block';
        document.getElementById('provincia-container').style.display = 'none';
        
        // Mostra o Menu de Prov√≠ncias no Continente
        document.getElementById('menu-provincias').style.display = 'block';

        inicializarMapa(configContinental.arquivo, configContinental.largura, configContinental.altura, configContinental.minZoom, configContinental.maxZoom);
        
        // CORRE√á√ÉO: Chama os marcadores do continente de volta!
        adicionarMarcadoresPrincipais();
    }

// --- BANCO DE DADOS DAS PROV√çNCIAS ---
    const dadosProvincias = {
        'Hukmal_tep.jpg': {
            titulo: "Hukmal'tep - As Terras Altas",
            descricao: `
                <p><strong>üìú Descri√ß√£o:</strong> Uma regi√£o montanhosa e de frio intenso, marcada por grandes picos e vales profundos onde o vento uiva constantemente.</p>
                <p><strong>üëë Governo:</strong> Conselho das Tr√™s Tribos (Felistas, Malistas e Garra do Inverno). N√£o h√° um rei √∫nico, mas sim uma tr√©gua tensa.</p>
                <p><strong>üßë‚Äçü§ù‚Äçüßë Ra√ßas Principais:</strong> Humanos (adaptados ao frio), An√µes e Mesti√ßos.</p>
                <p><strong>‚öîÔ∏è Cultura:</strong> Valorizam a for√ßa e a sobreviv√™ncia. A magia √© vista com desconfian√ßa. N√£o √© muito comum haver estudiosos na prov√≠ncia.</p>
                <p><strong>üíé Economia:</strong> O com√©rcio √© focado em peles e outros produtos originados de monstros e animais da regi√£o.</p>
            `
        },
        'Blat_khyr.jpg': {
            titulo: "Blat'khyr - O Ber√ßo da Magia",
            descricao: `
                <p><strong>üìú Descri√ß√£o:</strong> Uma regi√£o repleta de magia onde todo o ambiente foi transformado devido √† alta densidade de mana da prov√≠ncia.</p>
                <p><strong>üëë Governo:</strong> Existe uma fam√≠lia real √©lfica mas em geral quem cuida da gest√£o da prov√≠ncia √© o conselho √©lfico que √© formados por elfos anci√µes.</p>
                <p><strong>üßë‚Äçü§ù‚Äçüßë Ra√ßas Principais:</strong> Elfos e Humanos.</p>
                <p><strong>‚öîÔ∏è Cultura:</strong> Valorizam a intelig√™ncia, eleg√¢ncia e o poder m√°gico acima de tudo. Muitos elfos n√£o gostam de misturar com outras ra√ßas pois "diminui o potencial m√°gico deles"</p>
                <p><strong>üíé Economia:</strong> O com√©rcio √© focado em itens m√°gicos diversos.</p>
            `
        },
        // Adicione as outras prov√≠ncias aqui...
        'default': {
            titulo: "Regi√£o Desconhecida",
            descricao: "<p>N√£o h√° registros detalhados sobre esta √°rea nos arquivos imperiais.</p>"
        }
    };

    // --- FUN√á√ïES DO MODAL ---
    function abrirModalInfo() {
        const dados = dadosProvincias[mapaAtualAtivo] || dadosProvincias['default'];
        
        document.getElementById('titulo-provincia').innerHTML = dados.titulo;
        document.getElementById('texto-provincia').innerHTML = dados.descricao;
        document.getElementById('modal-info').style.display = 'flex';
    }

    function fecharModalInfo() {
        document.getElementById('modal-info').style.display = 'none';
    }

    // --- SUA FUN√á√ÉO ATUALIZADA ---
    function abrirMapaProvincia(arquivo) {
        mapaAtualAtivo = arquivo;
        
        document.getElementById('menu-provincias').style.display = 'none';
        document.getElementById('map-container').style.display = 'block';
        document.getElementById('provincia-container').style.display = 'none';

        inicializarMapa(arquivo, configProvincia.largura, configProvincia.altura, configProvincia.minZoom, configProvincia.maxZoom);

        // 1. Bot√£o Voltar (J√° existente)
        const botaoVoltar = L.control({position: 'topleft'});
        botaoVoltar.onAdd = function() {
            const btn = L.DomUtil.create('button', ''); 
            btn.innerHTML = "‚¨Ö Voltar ao Continente";
            btn.style.whiteSpace = "nowrap";
            btn.style.padding = "10px 15px";
            btn.style.background = "#8b4513";
            btn.style.color = "white";
            btn.style.border = "2px solid #5e2f0d";
            btn.style.borderRadius = "5px";
            btn.style.cursor = "pointer";
            btn.style.fontWeight = "bold";
            btn.onclick = carregarMapaPrincipal; 
            return btn;
        };
        botaoVoltar.addTo(map);

        // 2. NOVO: Bot√£o de Detalhes da Prov√≠ncia (Canto Superior Direito)
        const botaoInfo = L.control({position: 'topright'});
        botaoInfo.onAdd = function() {
            const btn = L.DomUtil.create('button', ''); 
            btn.innerHTML = "üìú Detalhes da Regi√£o";
            btn.style.whiteSpace = "nowrap";
            btn.style.padding = "10px 15px";
            btn.style.background = "#2c3e50"; /* Azul escuro para diferenciar */
            btn.style.color = "#cd853f";      /* Texto dourado */
            btn.style.border = "2px solid #cd853f";
            btn.style.borderRadius = "5px";
            btn.style.cursor = "pointer";
            btn.style.fontWeight = "bold";
            btn.style.fontSize = "16px";
            
            // Ao clicar, abre a janela que criamos
            btn.onclick = abrirModalInfo; 
            return btn;
        };
        botaoInfo.addTo(map);

        adicionarMarcadoresLocais(arquivo);
    }

    function verImagemEstatica(arquivo) {
        document.getElementById('map-container').style.display = 'none';
        document.getElementById('provincia-container').style.display = 'flex'; 
        document.getElementById('img-provincia').src = arquivo;
    }

    function voltarParaMapa() {
        if (mapaAtualAtivo === 'continente') {
            carregarMapaPrincipal();
        } else {
            abrirMapaProvincia(mapaAtualAtivo);
        }
    }

    // --- 4. MARCADORES LOCAIS (PROV√çNCIAS) ---
    function adicionarMarcadoresLocais(nomeDoMapa) {
        
        const hitboxPadrao = L.icon({
            iconUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png',
            iconSize: [50, 50], iconAnchor: [25, 25], popupAnchor: [0, -25]
        });
        const hitboxGrande = L.icon({
            iconUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png',
            iconSize: [100, 100], iconAnchor: [50, 50], popupAnchor: [0, -50]
        });

        // CORRE√á√ÉO: Removi a parte que tentava adicionar na lista lateral inexistente
        function criarPontoLocal(coord, nome, info, foto = null, grande = false) {
            const m = L.marker(coord, { 
                icon: grande ? hitboxGrande : hitboxPadrao, 
                opacity: 0 // Mantive invis√≠vel (hitbox). Mude para 0.5 se quiser ver para testar.
            }).addTo(map);

            let popupHtml = `<div style="text-align:center;"><b>${nome}</b><br><small>${info}</small>`;
            if (foto) {
                popupHtml += `<br><br><button onclick="verImagemEstatica('${foto}')" class="btn-popup">Ver Foto</button>`;
            }
            popupHtml += `</div>`;
            m.bindPopup(popupHtml);
        }

        if (nomeDoMapa === 'Hukmal_tep.jpg') {
            // Seus pontos de Hukmal'tep
            criarPontoLocal([1396, 780], "Capital de Hukmal'tep", "Felista", "C√≥pia de capital de hukmal_tep.png", true);
            criarPontoLocal([1422, 441], "Torre de Vigia", "(Felista)");
            criarPontoLocal([1209, 520], "Torre de Vigia", "(Felista)");
            criarPontoLocal([1488, 1081], "Torre de Vigia", "(Felista)");
            criarPontoLocal([1222, 1158], "Torre de Vigia", "(Felista)");
            criarPontoLocal([1474, 546], "Porto", "(Felista)");
            criarPontoLocal([1256, 1129], "Vilarejo", "(Felista)");
            criarPontoLocal([1106, 505], "Vilarejo", "(Felista)");

            criarPontoLocal([157, 267], "Cidade", "(Garra do Inverno)");
            criarPontoLocal([419, 483], "Vilarejo", "(Garra do Inverno)");
            criarPontoLocal([242, 1338], "Vilarejo", "(Garra do Inverno)", "C√≥pia de cidade ponte.png", true);
            criarPontoLocal([369, 868], "Vilarejo", "(Garra do inverno)", "C√≥pia de Cidade neve 3.png", true);

            criarPontoLocal([268, 1472], "Torre de Vigia", "(Malista)");
            criarPontoLocal([513, 1617], "Cidade", "(Malista)", "C√≥pia de Cidade neve 5.png", true);
            criarPontoLocal([534, 1918], "Vilarejo", "(Malista)");
            criarPontoLocal([530, 1710], "Porto", "(Malista)");
            criarPontoLocal([678, 101], "Porto", "(Malista)");
            criarPontoLocal([707, 1520], "Vilarejo", "(Malista)");
            criarPontoLocal([659, 1127], "Vilarejo", "(Malista)", "C√≥pia de Cidade neve 4.png", true);
            criarPontoLocal([796, 1134], "Torre de Vigia", "(Malista)");
            criarPontoLocal([960, 1733], "Torre de Vigia", "(Malista)");
            criarPontoLocal([1113, 1460], "Vilarejo", "(Malista)");
            criarPontoLocal([1003, 172], "Vilarejo", "(Malista)");
            criarPontoLocal([673, 640], "Vilarejo", "(Malista)", "C√≥pia de cidade drag√£o.png", true);
            criarPontoLocal([621, 358], "Torre de Vigia", "(Malista)");
            criarPontoLocal([740, 452], "Torre de Vigia", "(Malista)");
            criarPontoLocal([713, 257], "Cidade Malista", "(Malista)", "C√≥pia de Cidade portuaria gelo.png", true);

            criarPontoLocal([141, 578], "Vilarejo", "(Neutro)", "inicial.png", true);
            criarPontoLocal([1184, 1014], "Vilarejo", "(Neutro)");
        }

        if (nomeDoMapa === 'Blat_khyr.jpg') {
            criarPontoLocal( [382, 1359], "Capital de Blat'khyr", "Elfos", "cidade magica.png", true);
            criarPontoLocal([986, 1239], "Vilarejo", "Desconhecido");
            criarPontoLocal( [1091, 606], "Vilarejo", "Desconhecido");
            criarPontoLocal([1463, 1151], "Vilarejo", "Desconhecido");
            criarPontoLocal([491, 371], "Cidade", "Elfos", "Cidade portu√°ria 4.png", true);
            criarPontoLocal([741, 963], "Cidade", "Elfos", "Cidade portu√°ria.png", true);
            criarPontoLocal([621, 1760], "Cidade", "Elfos", "Cidade portu√°ria 2.png", true);
            criarPontoLocal([69, 1054], "Cidade", "Elfos", "Cidade portu√°ria 3.png", true);
            criarPontoLocal([408, 745], "Cidade", "Elfos", "Cidade portu√°ria 5.webp", true);
            criarPontoLocal([252, 891], "Cidade", "Elfos", "Cidade portu√°ria 6.jpg", true);
            criarPontoLocal([611, 1210], "Vilarejo", "Humanos", "Vila.png", true);
            criarPontoLocal([530, 1149], "Vilarejo", "Humanos");
            criarPontoLocal([556, 850], "Vilarejo", "Humanos");
            criarPontoLocal([641, 641], "Vilarejo", "Humanos");
            criarPontoLocal([256, 1302], "Vilarejo", "Humanos");
            criarPontoLocal([500, 1644], "Vilarejo", "Humanos");
            criarPontoLocal([273, 1366], "Cidade", "Elfos");
            criarPontoLocal([824, 894], "Muralha", "Elfos");
            criarPontoLocal([791, 648], "Muralha", "Elfos");
            criarPontoLocal([766, 388], "Muralha", "Elfos");
            criarPontoLocal([884, 1094], "Muralha", "Elfos");
            criarPontoLocal([882, 1271], "Muralha", "Elfos");
        }
    }

    // --- 5. MARCADORES DO CONTINENTE ---
    function adicionarMarcadoresPrincipais() {
        const iconePadrao = L.icon({
            iconUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png',
            iconSize: [80, 80], iconAnchor: [40, 40], popupAnchor: [0, -40]
        });

        const iconeGrande = L.icon({
            iconUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png',
            iconSize: [120, 120], iconAnchor: [60, 60], popupAnchor: [0, -60]
        });

        function criarPonto(coord, nome, arquivo, tipo, grande = false) {
            const m = L.marker(coord, { icon: grande ? iconeGrande : iconePadrao, opacity: 0 }).addTo(map);
            let btn = "";

            if (tipo === 'mapa') {
                btn = `<button onclick="abrirMapaProvincia('${arquivo}')" class="btn-popup">Explorar Prov√≠ncia</button>`;
            } else if (tipo === 'imagem') {
                btn = `<button onclick="verImagemEstatica('${arquivo}')" class="btn-popup">Ver Foto</button>`;
            } else {
                btn = `<p style="color:#aaa;">Sem detalhes.</p>`;
            }

            m.bindPopup(`<div style="text-align:center;"><b>${nome}</b><br><br>${btn}</div>`);
        }

        // Seus pontos continentais originais
        criarPonto([824, 2330], "Deserto", "Deserto.jpg", 'mapa');
        criarPonto([3850, 3580], "Hukmal'tep", "Hukmal_tep.jpg", 'mapa');
        criarPonto([2902, 5464], "Blat'khyr", "Blat_khyr.jpg", 'mapa');
        criarPonto([1118, 4346], "Lago", "Lago.jpg", 'mapa');
        criarPonto([1356, 3284], "Alcova", "Alcova.jpg", 'mapa', true);
        criarPonto([2250, 4258], "Espinha do Gigante", "Espinha do Gigante.jpg", 'mapa', true);
        criarPonto([2142, 4378], "Espinha do Gigante", "Espinha do Gigante.jpg", 'mapa', true);

        criarPonto([2370, 3767], "Capital Imperial", "Capital.png", 'imagem');
        criarPonto([1648, 4438], "Cidade Santa", "Cidade Santa.png", 'imagem');
        criarPonto([2862, 2890], "Torre dos S√°bios", "Torre dos Sabios.png", 'imagem');
        criarPonto([1188, 5574], "Ilha Paradis√≠aca", "ilha 2.png", 'imagem');
        criarPonto([1830, 2322], "Vilarejo", "cidade da ra√ßa l√°.png", 'imagem');
        criarPonto([2114, 3854], "Vilarejo", "vilarejo.png", 'imagem');
        criarPonto([2142, 3254], "Vilarejo", "vilarejo 2.jpg", 'imagem');
        criarPonto([1758, 4620], "Vilarejo", "vilarejo 3.jpg", 'imagem');


        criarPonto([2252, 2880], "P√¢ntano", "pantano.png", 'imagem');
        criarPonto([2138, 2890], "P√¢ntano", "pantano.png", 'imagem');
        criarPonto([2228, 3032], "P√¢ntano", "pantano.png", 'imagem');
        criarPonto([2220, 2656], "P√¢ntano", "pantano.png", 'imagem');
        criarPonto([2232, 3936], "Vilarejo");
        criarPonto([2300, 3400], "Vilarejo");
        criarPonto([1830, 4354], "Vilarejo");
        criarPonto([2464, 4974], "Ilha de Blat'khyr", "Ilha.png", 'imagem');
        criarPonto([1838, 3526], "Floresta dos Sonhos", "floresta dos sonhos.png", 'imagem');
        criarPonto([1750, 3320], "Floresta dos Sonhos", "floresta dos sonhos.png", 'imagem');
        criarPonto([1536, 3634], "Floresta dos Sonhos", "floresta dos sonhos.png", 'imagem');
        criarPonto([2070, 3642], "Floresta dos Sonhos", "floresta dos sonhos.png", 'imagem');
        criarPonto([3912, 1780], "Inverno Desolado", null, 'none', true);
    }

    // Inicializa√ß√£o
    carregarMapaPrincipal();
    </script>
</body>
</html>