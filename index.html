<!--
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   MAPA RPG INTERATIVO 8K
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   
   Autor: Ot√°vio Gums Willrich
   Data: 2026-02-03
   Vers√£o: 1.0 - Full Documentation & Bug Fixes
   
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   VIS√ÉO GERAL DO PROJETO:
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   - Single-file HTML5/JS RPG explorer com mapa interativo usando Leaflet.js
   - Mapa continental 8K (7680x4320px) com 5 prov√≠ncias explor√°veis
   - Sistema cosmol√≥gico com 3 planos extras (Divino, Demon√≠aco, Espiritual)
   - M√∫ltiplos subsistemas: banco, besti√°rio, squad, rumors, pantheon, lore
   
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   ARQUITETURA:
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   1. MAPA (Leaflet.js CRS.Simple)
      - N√£o usa lat/lng, mas coordenadas pixel [Y, X]
      - Dois n√≠veis: Continental (7680x4320) -> Prov√≠ncias/Planos (2048x1536)
      - Zoom din√¢mico: -2.0 a 3.0 continental, -1.0 a 2.0 prov√≠ncias
      
   2. SISTEMA DE NAVEGA√á√ÉO
      - Estado rastreado via: mapaAtualAtivo, menuAtualAberto, modoCoordenadas, medindo
      - Callback pattern para voltar entre telas (verImagemEstatica)
      - Modais sobrepostas (info, capital, senha, viagem)
      
   3. DADOS EMBARCADOS (3 objetos globais)
      - dadosProvincias: Descri√ß√µes de 5 regi√µes
      - dadosGerais: Banco (6 packages), Pantheon (12 deuses), Investimentos
      - dadosCapital: Squad (6 PCs), Procurados (8), Besti√°rio, Boatos (100), Lore (5 caps), Her√≥is (12)
      
   4. SUBSISTEMAS
      - Medidor de Rota: Calcula dist√¢ncia (km) -> tempo (dias) -> custo (ouro/prata/bronze)
      - Sistema de Coordenadas: Clique exibe [Y, X] com popup persistente
      - Prote√ß√£o por Senha: 'portal', 'fofoca', 'Seita', 'ninja' permitem explora√ß√£o
      - Imagem Viewer: Fullscreen com bot√£o de voltar customiz√°vel via callback
      
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   SCALE FACTORS (mapa continente = baseline):
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   - Continental: 1 px = 0.23 km (escala 1:23)
   - Prov√≠ncias: 1 px = 0.13 km (escala 1:13)
   - Planos: 1 px = 0.5 km (escala 1:50, mais "m√°gico")
   
   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   TEMPO E ECONOMIA:
   - Velocidade base: 30 km/dia a p√©
   - Montarias: 1.5x mula, 2x cavalo, 4x especial
   - Custo imperial: 2.5 ouro taxa + 2.5 prata/km
   - Convers√£o: 1 ouro = 100 prata = 10000 bronze
   
   FLUXOS PRINCIPAIS:
   1. Continente (Mapa teste.png) -> Clica Prov√≠ncia -> abrirMapaProvincia()
   2. Dentro Prov√≠ncia -> Clica Localidade -> popup com a√ß√µes -> verImagemEstatica()
   3. Voltando de imagem -> callback restaura mapa + reabre menu anterior
   4. Cosmologia: Clica "Outros Planos" -> modalSenha -> Planos.jpg -> criarPontoNexus()
   
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
-->
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <title>Mapa RPG Interativo 8K</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
    /* --- ESTILOS GERAIS --- */
    
    /* Fundo Azul Escolhido (#4F686E) */
    body { margin: 0; background: #4F686E; overflow: hidden; font-family: sans-serif; }
    #map { height: 100vh; width: 100vw; z-index: 1; background: #4F686E; }

    /* MENU LATERAL (PRETO) */
    #menu-provincias {
        position: fixed;
        top: 20px; right: 20px;
        width: 220px;
        background: rgba(26, 26, 26, 0.95); 
        border: 2px solid #8b4513;
        border-radius: 8px;
        color: white;
        z-index: 2000;
        padding: 15px;
        box-shadow: 0 0 15px rgba(0,0,0,0.8);
        transition: 0.3s;
    }

    #menu-provincias h3 {
        text-align: center;
        margin-top: 0;
        color: #cd853f;
        border-bottom: 1px solid #555;
        padding-bottom: 10px;
        cursor: pointer;
    }

/* Remove o fundo branco do √≠cone de emoji */
.marcador-emoji {
    background: none !important;
    border: none !important;
    display: flex;
    justify-content: center;
    align-items: center;
}

    /* Estilo para foto na lista (besti√°rio, esquadr√£o, etc) */
    .foto-lista { 
        width: 80px; height: 110px; 
        object-fit: cover; /* Isso impede a foto de ficar esticada/deformada */
        border: 1px solid #8b4513; 
        margin-right: 15px; 
        flex-shrink: 0; 
        background: #000;
    }

    /* Estilo para os links dentro do hist√≥rico */
    .link-historia {
        color: #ffd700; /* Amarelo Ouro */
        text-decoration: underline;
        cursor: pointer;
        font-weight: bold;
        transition: 0.2s;
    }
    .link-historia:hover {
        color: #fff; /* Fica branco ao passar o mouse */
        text-shadow: 0 0 5px #ffd700;
    }
    .texto-capitulo {
        font-size: 16px;
        line-height: 1.6;
        text-align: justify;
        white-space: pre-wrap; /* Mant√©m par√°grafos do texto */
    }

    #seta-menu { display: none; }
    #lista-botoes-provincia { display: block; }

/* --- ESTILO DOS BOT√ïES DOS POPUPS --- */
    .botao-estiloso {
        display: flex;
        align-items: center;
        width: 100%;
        margin-bottom: 6px;
        padding: 10px 12px;
        background: rgba(30, 30, 30, 0.95); 
        color: #e0e0e0;
        border: none;
        border-left: 4px solid #555; /* A cor muda no JS */
        text-align: left;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.2s ease;
        box-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }

    .botao-estiloso:hover {
        background: #444;
        padding-left: 18px; /* Efeito de deslize */
        color: #fff;
    }

    /* --- VOLTANDO O ESTILO ORIGINAL DO MENU --- */
    .botao-provincia {
        display: block; width: 100%;
        padding: 10px; margin: 5px 0;
        background: transparent; color: #ddd;
        border: 1px solid #444; border-radius: 4px;
        text-align: left; cursor: pointer;
        transition: 0.3s;
    }


/* 1. Efeito de brilho marrom APENAS para bot√µes normais (Prov√≠ncias e Voltar) */
.botao-provincia:hover {
    background: #8b4513 !important;
    color: white !important;
    border-color: #46362f !important;
}

/* 2. Trava os bot√µes de Ferramentas para N√ÉO brilharem nem deslizarem quando est√£o OFF */
#btn-coords-menu:hover, #btn-coords-prov:hover,
#btn-medidor:hover, #btn-medidor-prov:hover {
    background: transparent !important;
    border-color: #444 !important;
    color: #ddd !important;
    padding-left: 10px !important;
}

/* 3. PRIORIDADE TOTAL: Se estiver ON, fica verde e ignora qualquer outro hover ou cor */
.btn-ferramenta-ativa, 
.btn-ferramenta-ativa:hover,
#btn-coords-menu.btn-ferramenta-ativa:hover, #btn-coords-prov.btn-ferramenta-ativa:hover,
#btn-medidor.btn-ferramenta-ativa:hover, #btn-medidor-prov.btn-ferramenta-ativa:hover {
    background-color: #27ae60 !important;
    color: white !important;
    border-color: #2ecc71 !important;
    padding-left: 10px !important; /* Mant√©m parado mesmo verde */
}

    /* CONTAINER DA FOTO EST√ÅTICA */
    #provincia-container {
        display: none;
        background: #1a1a1a; /* Fundo escuro fica melhor para fotos */
        height: 100vh; width: 100vw; 
        position: fixed; top: 0; left: 0;
        z-index: 9000; /* Garante que fique na frente do mapa e dos menus */
        flex-direction: column;
        align-items: center; justify-content: center;
    }

    #img-provincia {
        max-height: 85vh; max-width: 90vw;
        object-fit: contain;
        box-shadow: 0 0 50px rgba(0,0,0,1);
        border: 2px solid #333;
    }

    #provincia-container img {
    animation: fadeIn 0.5s ease-in-out;
}

@keyframes fadeIn { 
    from { opacity: 0; transform: scale(0.9); }
    to { opacity: 1; transform: scale(1); }
} 
    /* POPUPS E BOT√ïES */
    .leaflet-popup-content-wrapper { background: #2c2c2c; color: #fff; font-size: 14px; }
    .leaflet-popup-tip { background: #2c2c2c; }
    
    .btn-popup {
        background: #8b4513; color: white; border: none;
        padding: 8px 12px; border-radius: 3px;
        cursor: pointer; font-weight: bold;
    }

    /* MODAL DE DETALHES */
    #modal-info {
        position: fixed; z-index: 5000; left: 0; top: 0;
        width: 100%; height: 100%;
        background-color: rgba(0,0,0,0.8);
        display: flex; align-items: center; justify-content: center;
    }

    .modal-conteudo {
        background-color: #2c2c2c; border: 2px solid #cd853f;
        width: 60%; max-width: 800px; max-height: 80vh;
        overflow-y: auto; padding: 30px; border-radius: 10px;
        color: #ddd; font-family: serif; box-shadow: 0 0 20px #cd853f;
        position: relative;
    }
    .modal-conteudo h2 { color: #cd853f; border-bottom: 1px solid #555; padding-bottom: 10px; margin-top: 0; }
    .modal-conteudo p { line-height: 1.6; font-size: 18px; }
    .modal-conteudo strong { color: #ffdead; }
    .fechar-modal { color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer; }


    /* Estilo para a lista de boatos */
    .lista-boatos {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }
    .boato-item {
        background: rgba(0, 0, 0, 0.3);
        border: 1px solid #444;
        padding: 10px;
        border-radius: 5px;
        display: flex;
        align-items: flex-start;
    }
    .boato-numero {
        font-weight: bold;
        color: #cd853f;
        margin-right: 10px;
        min-width: 30px;
    }
    .boato-texto {
        font-style: italic;
        color: #aaa;
    }
    /* Estilo quando o boato √© descoberto */
    .boato-descoberto {
        border-color: #ffd700;
        background: rgba(139, 69, 19, 0.2);
    }
    .boato-descoberto .boato-texto {
        color: #ffdead;
        font-style: normal;
        font-weight: 500;
    }

    /* --- ESTILO BANCO --- */
    .tabela-banco { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 14px; }
    .tabela-banco th, .tabela-banco td { border: 1px solid #555; padding: 8px; text-align: left; color: #ddd; }
    .tabela-banco th { background-color: #3e2723; color: #ffdead; }
    .preco-banco { color: #ffd700; font-weight: bold; }
    .nota-banco { font-size: 12px; color: #aaa; margin-top: 10px; font-style: italic; }

    /* --- ESTILO DEUSES (ATUALIZADO) --- */
    .grid-deuses { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
    
    .item-deus { 
        background: rgba(0,0,0,0.4); 
        border: 1px solid #444; 
        padding: 10px; 
        border-radius: 5px; 
        text-align: center; /* Centraliza tudo */
        cursor: pointer;    /* M√£ozinha de clique */
        transition: transform 0.2s, border-color 0.2s;
    }
    .item-deus:hover {
        transform: scale(1.02);
        border-color: #ffd700;
        background: rgba(255, 215, 0, 0.1);
    }

    /* Nova classe para a imagem do deus */
    .foto-deus-thumb {
        width: 100%;
        height: 100px;
        object-fit: cover; /* Corta a imagem pra caber sem esticar */
        border-radius: 4px;
        border: 1px solid #8b4513;
        margin-bottom: 5px;
    }

    .nome-deus { color: #87ceeb; font-weight: bold; font-size: 16px; display: block; margin-bottom: 3px; }
    .desc-deus { font-size: 13px; color: #ccc; display: block; }
    .dominio-deus { font-size: 11px; color: #aaa; text-transform: uppercase; margin-top: 5px; display: block; }

    /* --- AJUSTES PARA CELULAR --- */
    @media only screen and (max-width: 600px) {
        #menu-provincias {
            width: auto !important;
            right: 10px !important; top: 10px !important;
            padding: 10px; max-width: 70vw; 
        }
        #menu-provincias h3 { margin: 0; padding-bottom: 0; border-bottom: none; font-size: 14px; }
        #seta-menu { display: inline; margin-left: 5px; }
        #lista-botoes-provincia { 
            display: none; 
            margin-top: 10px; border-top: 1px solid #555; padding-top: 5px;
        }
        /* Aplica mesma borda ao menu da regi√£o em mobile para exibir a linha cinza */
        #lista-ferramentas-regiao {
            display: none; 
            margin-top: 10px; border-top: 1px solid #555; padding-top: 5px;
        }
        .modal-conteudo { width: 90% !important; padding: 15px !important; }
        #img-provincia { max-height: 70vh !important; max-width: 95vw !important; }
        
        /* Ajuste do bot√£o de voltar para ficar no topo, abaixo do zoom */
        .leaflet-control-button-voltar {
            margin-top: 10px !important; 
        }
    }
    /* --- NOVOS ESTILOS PARA O MENU DA CAPITAL --- */
    #modal-capital {
        position: fixed; z-index: 5000; left: 0; top: 0; width: 100%; height: 100%;
        background-color: rgba(0,0,0,0.85); display: none; align-items: center; justify-content: center;
    }
    
    /* Estilo da lista de membros/procurados */
    .item-menu { 
        border-bottom: 1px solid #444; padding: 15px 0; display: flex; align-items: flex-start; 
    }
    .item-menu:last-child { border-bottom: none; }
    
    .foto-placeholder { 
        width: 80px; height: 110px; background: #3d3d3d; border: 1px solid #8b4513; 
        margin-right: 15px; flex-shrink: 0; display: flex; 
        align-items: center; justify-content: center; font-size: 10px; color: #777; 
    }
    
    .texto-item h4 { margin: 0 0 5px 0; color: #ffdead; font-size: 18px; }
    .texto-item p { font-size: 14px; margin: 0; color: #ccc; }
    .recompensa { color: #ffd700; font-weight: bold; display: block; margin-bottom: 5px; }
    .classe-char { color: #cd853f; font-weight: bold; font-size: 12px; text-transform: uppercase; display: block; margin-bottom: 5px; }
    
/* --- ESTILO DA CALCULADORA --- */
    .tabela-viagem { width: 100%; border-collapse: collapse; margin-top: 10px; color: #ddd; }
    .tabela-viagem td, .tabela-viagem th { border: 1px solid #444; padding: 8px; text-align: left; }
    .tabela-viagem th { background: #2c3e50; color: #ffd700; }
    
    .modo-medicao-ativo {
        cursor: crosshair !important; /* Muda o mouse para uma cruz */
    }
    .destaque-gold { color: #ffd700; font-weight: bold; }
    .destaque-silver { color: #c0c0c0; font-weight: bold; }
    .destaque-bronze { color: #cd7f32; font-weight: bold; }

    /* Quando ativo, desabilita cliques nos marcadores existentes para permitir tra√ßar rota por cima */
    .mapa-intangivel .leaflet-marker-icon,
    .mapa-intangivel .leaflet-popup {
        pointer-events: none !important;
        opacity: 0.7; /* Fica meio transparente pra indicar que n√£o pode clicar */
    }
    
    /* Marcadores da pr√≥pria rota (bolinhas vermelhas) devem continuar vis√≠veis */
    .marcador-rota {
        pointer-events: none; /* Apenas visual */
    }
    /* Container dos andares */
.torre-container {
    display: flex;
    flex-direction: column;
    gap: 8px;
    padding: 10px;
}

/* Estilo de cada andar */
.andar-item {
    background: rgba(40, 40, 40, 0.9);
    border: 1px solid #444;
    border-left: 5px solid #555; /* Cor padr√£o */
    padding: 15px;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.andar-item:hover {
    transform: scale(1.02) translateX(10px);
    background: rgba(60, 60, 60, 1);
}

.andar-numero {
    position: absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 30px;
    font-weight: bold;
    color: rgba(255, 255, 255, 0.05);
}

.andar-titulo { font-weight: bold; color: #ffdead; display: block; }
.andar-sage { font-size: 13px; color: #aaa; }

/* Container da Torre com Scroll Suave */
.torre-wrapper {
    max-height: 500px;
    overflow-y: auto;
    padding-right: 10px;
    perspective: 1000px; /* Efeito de profundidade */
}

/* Efeito de N√©voa para Andares Bloqueados */
.andar-bloqueado {
    filter: blur(4px) grayscale(1);
    opacity: 0.5;
    pointer-events: none; /* N√£o clica */
    cursor: not-allowed;
}

/* Andar Atual (Onde eles podem interagir) */
.andar-atual {
    border-left: 8px solid #ffd700 !important;
    box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
    animation: pulsoMagico 2s infinite ease-in-out;
}

@keyframes pulsoMagico {
    0% { transform: scale(1); }
    50% { transform: scale(1.01); box-shadow: 0 0 25px rgba(255, 215, 0, 0.5); }
    100% { transform: scale(1); }
}

/* Badge de Aprendizes */
.aprendiz-tag {
    background: rgba(255,255,255,0.1);
    padding: 2px 8px;
    border-radius: 10px;
    font-size: 11px;
    float: right;
}

/* --- VISUAL DO BESTI√ÅRIO (BORDAS E TAGS) --- */
.item-bestiario { 
    border: 2px solid #ff4444 !important; 
    background: rgba(255, 0, 0, 0.1) !important;
    padding: 15px; margin-bottom: 12px; border-radius: 8px; display: flex;
}
.tag-perigo { color: #ff4444; font-weight: bold; font-size: 16px; margin-left: 5px; }
.tag-info { font-size: 12px; color: #aaa; display: block; margin-top: 4px; }
.tag-titulo-info { color: #cd853f; font-weight: bold; }

/* --- ATRIBUTOS (CAIXINHAS ORIGINAIS) --- */
.grid-atributos { display: grid; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); gap: 10px; margin-top: 15px; }
.card-atributo { 
    background: rgba(255, 255, 255, 0.05); border: 1px solid #555; 
    padding: 12px; border-radius: 8px; text-align: center; 
}
.card-atributo strong { display: block; color: #ffd700; font-size: 15px; margin-bottom: 3px; }
.card-atributo span { font-size: 12px; color: #ccc; }

/* --- AJUSTE DEFINITIVO DO GRID (2x2 NO CELULAR) --- */
.biblio-nav { 
    display: grid; 
    /* For√ßa exatamente 2 colunas no celular */
    grid-template-columns: repeat(2, 1fr); 
    gap: 10px; 
    margin-top: 15px; 
}

/* No computador (telas maiores que 600px), ele volta a ser expans√≠vel */
@media only screen and (min-width: 600px) {
    .biblio-nav { 
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); 
    }
}

.rpg-card-small {
    background: linear-gradient(145deg, #2c2c2c, #1a1a1a);
    border: 1px solid #555; border-radius: 8px; padding: 12px;
    cursor: pointer; text-align: center; transition: 0.3s;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
}
.rpg-card-small:hover { border-color: #ffd700; background: rgba(139, 69, 19, 0.4); transform: scale(1.05); }
.rpg-card-small span { font-size: 24px; margin-bottom: 5px; }
.rpg-card-small strong { font-size: 10px; color: #ffdead; text-transform: uppercase; }

/* --- MAGIAS E HABILIDADES --- */
.spell-level { color: #ffd700; font-size: 14px; text-transform: uppercase; margin: 15px 0 5px 0; border-left: 3px solid #ffd700; padding-left: 8px; }
.spell-item { background: rgba(255,255,255,0.05); padding: 10px; border-radius: 4px; margin-bottom: 6px; font-size: 13px; border-left: 2px solid #555; }

.rpg-card-small {
    background: linear-gradient(145deg, #2c2c2c, #1a1a1a);
    border: 1px solid #555; border-radius: 8px; padding: 12px;
    cursor: pointer; text-align: center; transition: 0.3s;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
}
.rpg-card-small:hover { border-color: #ffd700; background: rgba(139, 69, 19, 0.4); transform: scale(1.05); }
.rpg-card-small span { font-size: 24px; margin-bottom: 5px; }
.rpg-card-small strong { font-size: 11px; color: #ffdead; text-transform: uppercase; }

/* --- ESTILO MAGIAS --- */
.spell-section { border-bottom: 1px solid #444; padding-bottom: 10px; margin-bottom: 15px; }
.spell-level { color: #ffd700; font-size: 14px; text-transform: uppercase; margin: 10px 0 5px 0; border-left: 3px solid #ffd700; padding-left: 8px; }
.spell-item { background: rgba(255,255,255,0.05); padding: 8px; border-radius: 4px; margin-bottom: 5px; font-size: 13px; }
.spell-name { color: #87ceeb; font-weight: bold; }

    </style>
</head>
<body>
    <div id="map-container">
        <div id="map"></div>
    </div>

    <div id="modal-info" style="display: none;">
        <div class="modal-conteudo">
            <span class="fechar-modal" onclick="fecharModalInfo()">&times;</span>
            <h2 id="titulo-provincia">T√≠tulo</h2>
            <div id="texto-provincia"></div>
        </div>
    </div>
    <div id="modal-capital">
        <div class="modal-conteudo">
            <span class="fechar-modal" onclick="fecharModais()">&times;</span>
            <h2 id="titulo-menu-capital" style="color: #cd853f; border-bottom: 1px solid #555;">Capital</h2>
            <div id="conteudo-menu-capital">
                </div>
        </div>
    </div>

<div id="menu-provincias">
    <h3 onclick="alternarMenuMobile()">Menu Principal <span id="seta-menu">‚ñº</span></h3>
    
    <div id="lista-botoes-provincia">
        <div style="color: #cd853f; font-size: 12px; margin-bottom: 5px; text-align: center;">PROV√çNCIAS</div>
        <button class="botao-provincia" onclick="abrirMapaProvincia('Hukmal_tep.jpg')">‚ùÑÔ∏è Hukmal'tep</button>
        <button class="botao-provincia" onclick="abrirMapaProvincia('Blat_khyr.jpg')">üçÇ Blat'khyr</button>
        <button class="botao-provincia" onclick="abrirMapaProvincia('Deserto.jpg')">üèúÔ∏è Deserto</button>
        <button class="botao-provincia" onclick="abrirMapaProvincia('Lago.jpg')">‚õ©Ô∏è Lago</button>
        <button class="botao-provincia" onclick="abrirMapaProvincia('Alcova.jpg')">üè¥‚Äç‚ò†Ô∏è Alcova</button>

        <hr style="border: 0; border-top: 1px solid #555; margin: 10px 0;">
        <div style="color: #cd853f; font-size: 12px; margin-bottom: 5px; text-align: center;">COSMOLOGIA</div>
        <button class="botao-provincia" onclick="abrirModalSenha('portal', 'Planos.jpg', 'mapa')" style="color: #aeb6bf;">üåå Outros Planos</button>

        <hr style="border: 0; border-top: 1px solid #555; margin: 10px 0;">
        <div style="color: #cd853f; font-size: 12px; margin-bottom: 5px; text-align: center;">FERRAMENTAS</div>
        <button id="btn-coords-menu" class="botao-provincia" onclick="alternarCoordenadas()" style="color: #aaa;">üìç Coords: OFF</button>
        <button id="btn-medidor" class="botao-provincia" onclick="ativarMedidor()" style="color: #90EE90; border-color: #2E8B57;">üìè Calculadora de Viagem</button>
    </div>
    
    <div id="lista-ferramentas-regiao" style="display: none;">
        
        
        <div style="color: #cd853f; font-size: 12px; margin-bottom: 5px; text-align: center;">MENU DA REGI√ÉO</div>
        <button class="botao-provincia" onclick="abrirModalInfo()">üìú Detalhes da Regi√£o</button>
        <button id="btn-coords-prov" class="botao-provincia" onclick="alternarCoordenadas()">üìç Coordenadas: OFF</button>
        <button id="btn-medidor-prov" class="botao-provincia" onclick="ativarMedidor()">üìè Medir Rota</button>
        <hr style="border: 0; border-top: 1px solid #555; margin: 10px 0;">
        <button id="btn-voltar-dinamico" class="botao-provincia" onclick="carregarMapaPrincipal()" style="color: #ffdead; border-color: #ffdead;">‚¨Ö Voltar ao Continente</button>
    </div>
</div>

<div id="provincia-container">
    <img id="img-provincia" src="">
</div>

<div id="modal-senha" style="display: none; position: fixed; z-index: 6000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.85); align-items: center; justify-content: center;">
        <div class="modal-conteudo" style="width: 400px; text-align: center;">
            <h3 style="color: #cd853f;">üîí √Årea Bloqueada</h3>
            <p>Qual a palavra de passe?</p>
            
            <input type="text" id="input-senha-rpg" placeholder="Digite a senha..." 
                   style="width: 80%; padding: 10px; margin-bottom: 20px; background: #222; border: 1px solid #8b4513; color: white; font-size: 16px; text-align: center;">
            
            <br>
            <button class="btn-popup" onclick="verificarSenha()" style="background: #2E8B57; font-size: 16px; margin-right: 10px;">üîì Tentar</button>
            <button class="btn-popup" onclick="fecharModalSenha()" style="background: #8b0000; font-size: 16px;">‚ùå Cancelar</button>
            
            <p id="msg-erro-senha" style="color: #ff4444; display: none; font-size: 14px; margin-top: 10px;">
                Senha incorreta. Por favor AGUARDE descobrirem a senha.
            </p>
        </div>
    </div>

<div id="modal-viagem" style="display: none; position: fixed; z-index: 6000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.85); align-items: center; justify-content: center;">
        <div class="modal-conteudo" style="max-width: 500px;">
            <span class="fechar-modal" onclick="document.getElementById('modal-viagem').style.display='none'">&times;</span>
            <h3 style="color: #90EE90;">üìä Relat√≥rio de Viagem</h3>
            <div id="resultado-viagem"></div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>

/**
 * RPG INTERATIVO - MAPA 8K COM LEAFLET
 * ==========================================
 * Aplicativo web de explora√ß√£o de mundo RPG com mapa continental 7680x4320px
 * Suporta: navega√ß√£o entre prov√≠ncias, sistema de combate cosmol√≥gico (m√∫ltiplos planos),
 * banco imperial, besti√°rio, hist√≥rico de aventuras, senhas, c√°lculo de rotas */

// Vari√°vel de controle: qual o andar m√°ximo que o grupo j√° liberou?


const dadosTorre = [
    { andar: 12, titulo: "O Primeiro S√°bio", nome: "Aurelius, o Eterno", desc: "O pilar da sabedoria e fundador da ordem.", cor: "#ffd700", aprendizes: 1 },
    { andar: 11, titulo: "O S√°bio do Espa√ßo", nome: "Void-Walker", desc: "Mestre das dimens√µes e portais.", cor: "#8a2be2", aprendizes: 3 },
    { andar: 10, titulo: "O S√°bio do Tempo", nome: "Chronos", desc: "Aquele que observa o fluxo do destino.", cor: "#40e0d0", aprendizes: 2 },
    { andar: 9,  titulo: "O S√°bio Arcano", nome: "Malygos", desc: "A pr√≥pria personifica√ß√£o da mana pura.", cor: "#1e90ff", aprendizes: 15 },
    { andar: 8,  titulo: "O S√°bio das Trevas", nome: "Umbra", desc: "Estudioso do que reside no abismo.", cor: "#4b0082", aprendizes: 5 },
    { andar: 7,  titulo: "O S√°bio das Chamas", nome: "Ignis", desc: "O calor da cria√ß√£o e da destrui√ß√£o.", cor: "#ff4500", aprendizes: 8 },
    { andar: 6,  titulo: "O S√°bio do Gelo", nome: "Frost-Beard", desc: "A paci√™ncia e o sil√™ncio do zero absoluto.", cor: "#00ffff", aprendizes: 6 },
    { andar: 5,  titulo: "O S√°bio das Armas", nome: "Kensei", desc: "A filosofia atrav√©s do fio da espada.", cor: "#708090", aprendizes: 20 },
    { andar: 4,  titulo: "O S√°bio da Alquimia", nome: "Paracelsus", desc: "Transmuta√ß√£o da mat√©ria e da alma.", cor: "#32cd32", aprendizes: 12 },
    { andar: 3,  titulo: "O S√°bio Tolo", nome: "Jester", desc: "A sabedoria encontrada na loucura e no riso.", cor: "#ba55d3", aprendizes: 0 },
    { andar: 2,  titulo: "O S√°bio", nome: "Novatus", desc: "O guardi√£o da porta e mestre dos iniciados.", cor: "#cd853f", aprendizes: 50 },
    { andar: 1,  titulo: "A S√°bia das Fofocas", nome: "Madame Murmur", desc: "Nada acontece em Tarre sem que ela saiba. Ela troca segredos por informa√ß√µes valiosas.", cor: "#ff69b4", aprendizes: 40 }
];
        
    document.addEventListener("keydown", (e) => {
    if (medindo && e.ctrlKey && (e.key === 'z' || e.key === 'Z')) desfazerUltimoPonto();
});

let andarMaximoLiberado = 1; // Inicia apenas com o 1¬∫ andar (S√°bia das Fofocas)

function abrirMenuTorre() {
    const modal = document.getElementById('modal-capital');
    const container = document.getElementById('conteudo-menu-capital');
    const titulo = document.getElementById('titulo-menu-capital');
    
    modal.style.display = 'flex';
    titulo.innerText = "üóº Ascens√£o √† Torre dos S√°bios";
    
    container.innerHTML = `
        <div style="background: rgba(0,0,0,0.4); padding: 15px; border-radius: 8px; margin-bottom: 20px; text-align: center;">
            <p style="color:#ffd700; margin:0; font-size: 14px;">Andar M√°ximo Desbloqueado: <strong>${andarMaximoLiberado}¬∫</strong></p>
        </div>
        <div class="torre-wrapper">
            <div class="torre-container">
                ${dadosTorre.map(f => {
                    const bloqueado = f.andar > andarMaximoLiberado;
                    const classeAndar = bloqueado ? 'andar-bloqueado' : (f.andar === andarMaximoLiberado ? 'andar-item andar-atual' : 'andar-item');
                    const iconeStatus = bloqueado ? 'üîí' : '‚ú®';
                    
                    return `
                        <div class="${classeAndar}" style="border-left-color: ${f.cor}" ${!bloqueado ? `onclick="detalharAndar(${f.andar})"` : ''}>
                            <span class="andar-numero">${f.andar}¬∫</span>
                            <span class="andar-titulo">${iconeStatus} ${f.titulo}</span>
                            <span class="andar-sage">${bloqueado ? "S√°bio Oculto pela N√©voa" : f.nome}</span>
                        </div>
                    `;
                }).join('')}
            </div>
        </div>

        <div style="margin-top: 30px; text-align: center; border-top: 1px dashed #444; padding-top: 10px;">
            <button onclick="subirAndar()" style="background: rgba(139, 69, 19, 0.3); border: 1px solid #8b4513; color: #cd853f; font-size: 11px; cursor: pointer; padding: 5px 15px; border-radius: 4px;">
                ‚öôÔ∏è MESTRE: Desbloquear Pr√≥ximo Andar
            </button>
        </div>
    `;
}

function subirAndar() {
    if (andarMaximoLiberado < 12) {
        andarMaximoLiberado++;
        abrirMenuTorre(); // Atualiza a interface da torre imediatamente
    } else {
        alert("O topo da torre j√° foi alcan√ßado!");
    }
}

// Fun√ß√£o que faz a m√°gica acontecer
function subirAndar() {
    if (andarMaximoLiberado < 12) {
        andarMaximoLiberado++;
        abrirMenuTorre(); // Atualiza a tela na hora
        alert("A n√©voa se dissipou! O " + andarMaximoLiberado + "¬∫ andar agora est√° acess√≠vel.");
    } else {
        alert("A torre j√° est√° totalmente desbloqueada!");
    }
}

// Fun√ß√£o para voc√™, Mestre, usar no console quando quiser que eles subam
function subirAndar() {
    if (andarMaximoLiberado < 12) {
        andarMaximoLiberado++;
        abrirMenuTorre();
        console.log("Os Pandem√¥nios subiram para o andar " + andarMaximoLiberado);
    }
}

function detalharAndar(num) {
    const andar = dadosTorre.find(a => a.andar === num);
    const container = document.getElementById('conteudo-menu-capital');
    
    container.innerHTML = `
        <button onclick="abrirMenuTorre()" class="btn-popup" style="margin-bottom:20px; background:#444;">‚¨Ö Voltar aos Andares</button>
        <div style="text-align:center; padding: 20px; border: 2px solid ${andar.cor}; border-radius: 10px; background: rgba(0,0,0,0.3);">
            <h2 style="color:${andar.cor}; margin-top:0;">${andar.titulo}</h2>
            <h3 style="color:#fff;">${andar.nome}</h3>
            <hr style="border:0; border-top:1px solid #444;">
            <p style="font-size:18px; line-height:1.6;">${andar.desc}</p>
            <div style="margin-top:20px; padding:10px; background:rgba(255,255,255,0.05);">
                <strong>üë• Aprendizes no andar:</strong> ${andar.aprendizes}
            </div>
        </div>
    `;
}

function detalharAndar(num) {
    const andar = dadosTorre.find(a => a.andar === num);
    const container = document.getElementById('conteudo-menu-capital');
    
    container.innerHTML = `
        <button onclick="abrirMenuTorre()" class="btn-popup" style="margin-bottom:20px; background:#444;">‚¨Ö Voltar aos Andares</button>
        <div style="text-align:center; padding: 20px; border: 2px solid ${andar.cor}; border-radius: 10px; background: rgba(0,0,0,0.3);">
            <h2 style="color:${andar.cor}; margin-top:0;">${andar.titulo}</h2>
            <h3 style="color:#fff;">${andar.nome}</h3>
            <hr style="border:0; border-top:1px solid #444;">
            <p style="font-size:18px; line-height:1.6;">${andar.desc}</p>
            <div style="margin-top:20px; padding:10px; background:rgba(255,255,255,0.05);">
                <strong>üë• Aprendizes no andar:</strong> ${andar.aprendizes}
            </div>
        </div>
    `;
}

/**
 * CONFIGURA√á√ïES DE MAPA
 * Cada mapa tem tamanho e zoom diferentes
 */
    const configContinental = { arquivo: 'Mapa teste.png', largura: 7680, altura: 4320, minZoom: -2.0, maxZoom: 3 };
    const configProvincia = { largura: 2048, altura: 1536, minZoom: -1.0, maxZoom: 2 };
    
/**
 * VARI√ÅVEIS GLOBAIS - Estado da aplica√ß√£o
 * Rastreiam qual mapa/menu est√° ativo e qual ferramenta est√° habilitada
 */
    let map; 
    let mapaAtualAtivo = 'continente';     // 'continente', 'Hukmal_tep.jpg', 'Planos.jpg', etc
    let modoCoordenadas = false;           // true = cliques mostram coordenadas
    let marcadorTempCoords = null;         // Armazena popup de coordenadas atual
    let fatorEscala = 0.23;                // Varia por mapa: 0.23 continental, 0.13 prov√≠ncias, 0.5 planos
    let menuAtualAberto = null;            // 'banco', 'bestiario', 'esquadrao', 'deuses', etc (essencial para voltar)
    let selecaoAtual = null;               // Rastreia qual regi√£o foi clicada (para planos)
    
/**
 * √çCONE CUSTOMIZADO - Marcador de coordenadas
 * Emoji üìç com sombra preta para visibilidade
 */
const iconCoords = L.divIcon({
    html: '<div style="font-size: 24px; filter: drop-shadow(0 0 2px black);">üìç</div>',
    className: 'marcador-emoji',
    iconSize: [30, 30],
    iconAnchor: [15, 25],
    popupAnchor: [0, -20]
});

/**
 * HELPER - Gera HTML de bot√£o com barra colorida √† esquerda
 * Usado em popups para consistent styling
 * @param {string} texto - Texto do bot√£o (com emojis)
 * @param {string} acao - onclick action (ex: "abrirMapaProvincia('arquivo.jpg')")
 * @param {string} corBarra - Cor hex da barra esquerda (ex: "#5F9EA0")
 */
    function criarBtn(texto, acao, corBarra) {
        return `<button onclick="${acao}" class="botao-estiloso" style="border-left-color: ${corBarra};">${texto}</button>`;
    }

/**
 * LAYER GROUP PARA ROTA
 * Armazena visual da rota (bolinhas e linhas de conex√£o)
 * Deve ser criado ANTES de inicializarMapa()
 */
    const grupoRota = L.layerGroup(); 
     
    
    let medindo = false;
    let pontosRota = [];


    const bancoClasses = {
    "Feiticeiro": {
        desc: "Habilidades de controle e utilidade, adaptando-se a diversas situa√ß√µes.",
        t2: {
            "Invocador": { 
                desc: "Usa magias m√≠sticas para invocar criaturas que lutam ao seu lado.",
                t3: { 
                    "Mestre Invocador": "Invoca criaturas mais poderosas por mais tempo, podendo realizar rituais de dias.",
                    "Espiritualista": "Conex√£o com o mundo espiritual, invocando esp√≠ritos poderosos para ataques ou defesas r√°pidas."
                }
            },
            "Bruxo": { 
                desc: "Usa magia negra para enfraquecer, envenenar e amaldi√ßoar oponentes.",
                t3: { 
                    "Necromante": "Faz com que criaturas mortas voltem √† vida para ajudar como desejar.",
                    "Demonologista": "Liga√ß√£o com o mundo inferior para rituais e feiti√ßos demon√≠acos intensos."
                }
            },
            "Feiticeiro Temporal": {
                desc: "Usa poderes estranhos para controlar o tempo ao seu redor (n√£o volta no tempo).",
                t3: {
                    "Temporalista": "Maximiza seus poderes temporais ao limite.",
                    "Dimensionalista": "Controla o espa√ßo, criando fendas dimensionais e alterando a mat√©ria."
                }
            }
        }
    },
    "Mago": {
        desc: "Habilidades de ataque massivo, sem deixar de lado truques importantes.",
        t2: {
            "Elementalista": {
                desc: "Extrai o poder da natureza usando magias dos elementos.",
                t3: { 
                    "Mestre do Fogo": "Extrai o poder puro do fogo e seus derivados.",
                    "Mestre do Ar": "Extrai o poder puro do ar e seus derivados.",
                    "Mestre da √Ågua": "Extrai o poder puro da √°gua e seus derivados.",
                    "Mestre da Terra": "Extrai o poder puro da terra e seus derivados."
                }
            },
            "Mago Arcano": {
                desc: "Manipula a magia pura atrav√©s do conhecimento e for√ßa mental.",
                t3: { "R√∫nico": "Usa escritas antigas para feiti√ßos complexos e poderosos." }
            },
            "Mago de Combate": {
                desc: "Especialista em combates m√°gicos corpo a corpo e m√©dia dist√¢ncia.",
                t3: { "Mago de Combate Especializado": "Escolhe uma arma ou estilo de luta para criar t√©cnicas especiais." }
            }
        }
    },
    "Guerreiro": {
        desc: "Usa espadas e escudos para causar grande dano e suportar ataques.",
        t2: {
            "Paladino": {
                desc: "Recebe o dom m√°gico de um deus sem abandonar as t√©cnicas de esgrima.",
                t3: { 
                    "Anjo": "Ganha a gra√ßa divina total, tornando-se quase um anjo verdadeiro com energia divina.",
                    "Monge": "Abandona seu deus mas segue o caminho da bondade, ganhando resist√™ncia e poderes elementais."
                }
            },
            "Cavaleiro das Trevas": {
                desc: "Torna-se um cavaleiro sombrio que ganha poder quanto mais mata.",
                t3: { 
                    "Cavaleiro Demon√≠aco": "Adquire poderes de entidades superiores com acesso a magias perdidas do submundo.",
                    "Berserker": "Focado em dano extremo e resist√™ncia, ganha poder ao receber e causar dano."
                }
            },
            "Guerreiro Arcano": {
                desc: "Combina magia arcana com habilidades de esgrima.",
                t3: { "Veterano": "Mestre em todos os tipos de armas, podendo melhor√°-las e realizar feiti√ßos extras." }
            }
        }
    },
    "Ca√ßador": {
        desc: "Vers√°til, usa arcos, facas e conhecimentos da natureza para emboscadas.",
        t2: {
            "Arqueiro": { desc: "Foca no arco, combinando magia e precis√£o t√©cnica.", t3: { "Sniper": "Vis√£o melhorada para dist√¢ncias extremas.", "Atirador de Elite": "Invoca armas de fogo antigas.", "Mestre Arqueiro": "Flechas variadas para qualquer situa√ß√£o." } },
            "Assassino": { desc: "Usa adagas e venenos para permanecer oculto.", t3: { "Ceifador": "Maneja correntes e foices para um deus.", "Sombra": "N√≠vel elevado de oculta√ß√£o e assassinato." } },
            "Druida": { desc: "Domina plantas e animais com magias de natureza e cura.", t3: { "Druida (reencarnado)": "Torna-se um com a natureza, ganhando poderes m√≠sticos selvagens." } }
        }
    },
    "Curandeiro": {
        desc: "Essencial para combates, usa poderes divinos para curar e aben√ßoar.",
        t2: {
            "Sacerdote": { desc: "Ilumina√ß√£o divina para curar aliados e destruir mortos-vivos.", t3: { "Anjo": "Ascens√£o divina total.", "Vampiro": "Amaldi√ßoado pela noite, precisa de sangue para sobreviver." } },
            "Encantador": { desc: "Mestre em buffs, debuffs e encantamento de itens utilit√°rios.", t3: { "Mestre Encantador": "Modifica magias e cria itens m√°gicos complexos." } },
            "Bardo": { desc: "Habilidades musicais de cura e utilidade.", t3: { "Estrela": "Controle total do som e fala m√°gica c√≥smica." } }
        }
    }
};

    // --- FUN√á√ïES DE NAVEGA√á√ÉO E SISTEMA ---

/**
 * Inicializa o mapa Leaflet com CRS.Simple (pixel coordinates, n√£o lat/lng)
 * Define limites de navega√ß√£o, carrega imagem de fundo, inicializa camadas
 * CR√çTICO: grupoRota deve estar criado ANTES dessa fun√ß√£o
 * @param {string} arquivo - Caminho do arquivo PNG (ex: 'Mapa teste.png')
 * @param {number} largura - Largura em pixels
 * @param {number} altura - Altura em pixels  
 * @param {number} minZoom - Zoom m√≠nimo (geralmente -2.0 para continental)
 * @param {number} maxZoom - Zoom m√°ximo (geralmente 3)
 */
function inicializarMapa(arquivo, largura, altura, minZoom, maxZoom) {
    if (map) { map.remove(); } 

    const limitesImagem = [[0, 0], [altura, largura]];
    const padding = 1500; 
    const limitesNavegacao = [[-padding, -padding], [altura + padding, largura + padding]];
    
    map = L.map('map', {
        crs: L.CRS.Simple,
        minZoom: minZoom,
        maxZoom: maxZoom,
        maxBounds: limitesNavegacao, 
        maxBoundsViscosity: 0.5,     
        tap: false,
        zoomControl: false 
    });

    grupoRota.addTo(map);
    L.control.zoom({ position: 'topleft' }).addTo(map);
    L.imageOverlay(arquivo, limitesImagem).addTo(map);
    map.fitBounds(limitesImagem);
    
    /**
     * LISTENER DE CLIQUE NO MAPA
     * Prioridade: medi√ß√£o > coordenadas > marcadores
     * Se medindo: adiciona ponto √† rota
     * Se modo coordenadas: exibe popup com [Y, X] e fecha ao clicar X
     * Sen√£o: deixa Leaflet processar (marcadores t√™m seus pr√≥prios listeners)
     */
    map.on('click', function(e) {
        if (medindo) {
            processarCliqueMedicao(e.latlng);
            return;
        }

        if (modoCoordenadas) {
            // Se j√° existe um ponto, remove ele para colocar o novo
            if (marcadorTempCoords) {
                // Removemos o listener temporariamente para a remo√ß√£o manual n√£o bugar a l√≥gica
                marcadorTempCoords.off('popupclose'); 
                map.removeLayer(marcadorTempCoords);
            }

            const y = e.latlng.lat.toFixed(0);
            const x = e.latlng.lng.toFixed(0);

            // Cria o marcador com o emoji üìç
            marcadorTempCoords = L.marker(e.latlng, { 
                icon: iconCoords,
                zIndexOffset: 1000 
            }).addTo(map);
            
            // CONFIGURA√á√ÉO M√ÅGICA: closeOnClick e autoClose como FALSE
            marcadorTempCoords.bindPopup(`<b>üìç Coordenadas</b><br>[${y}, ${x}]`, {
                closeOnClick: false, // N√£o fecha se voc√™ clicar no mapa
                autoClose: false     // N√£o fecha se voc√™ abrir outro popup (cidades, etc)
            }).openPopup();

            // Agora ele S√ì vai sumir se clicar no 'X' do popup
            marcadorTempCoords.on('popupclose', function() {
                map.removeLayer(marcadorTempCoords);
                marcadorTempCoords = null;
            });
        }
    });
}

/**
 * Alterna visibilidade do menu no mobile (< 600px)
 * Mostra/esconde a lista de prov√≠ncias ou ferramentas conforme clique
 * Chamada por: onclick em h3 do menu
 */
function alternarMenuMobile() {
    if (window.innerWidth > 600) return;
    const listaProv = document.getElementById('lista-botoes-provincia');
    const listaFerramentas = document.getElementById('lista-ferramentas-regiao');
    const seta = document.getElementById('seta-menu');
    
    // Identifica qual parte do menu est√° ativa para abrir/fechar
    let listaAtiva = (mapaAtualAtivo === 'continente') ? listaProv : listaFerramentas;
    
    if (window.getComputedStyle(listaAtiva).display === 'none') {
        listaAtiva.style.display = 'block';
        seta.innerHTML = '‚ñ≤';
    } else {
        listaAtiva.style.display = 'none';
        seta.innerHTML = '‚ñº';
    }
}

/**
 * Sincroniza visibilidade do menu conforme tamanho da tela
 * Desktop: mostra prov√≠ncias OU ferramentas (depend do mapa)
 * Mobile (< 600px): esconde ambos por padr√£o (podem ser expandidos)
 * Chamada por: abrirMapaProvincia(), carregarMapaPrincipal(), window.resize
 */
function atualizarVisibilidadeMenuMobile() {
    const listaProv = document.getElementById('lista-botoes-provincia');
    const listaFerramentas = document.getElementById('lista-ferramentas-regiao');
    const seta = document.getElementById('seta-menu');

    if (window.innerWidth <= 600) {
        if (listaProv) listaProv.style.display = 'none';
        if (listaFerramentas) listaFerramentas.style.display = 'none';
        if (seta) seta.innerHTML = '‚ñº';
        return;
    }

    // Desktop/tablet: mostra a parte correta do menu dependendo do mapa ativo
    if (mapaAtualAtivo === 'continente') {
        if (listaProv) listaProv.style.display = 'block';
        if (listaFerramentas) listaFerramentas.style.display = 'none';
    } else {
        if (listaProv) listaProv.style.display = 'none';
        if (listaFerramentas) listaFerramentas.style.display = 'block';
    }
}

/**
 * Carrega o mapa do continente (vista inicial do jogo)
 * Limpa rotas, marcadores tempor√°rios, reseta estado global
 * Adiciona marcadores das 5 prov√≠ncias principais + locais especiais
 * Chamada por: inicializa√ß√£o e bot√£o voltar do mapa
 */
    function carregarMapaPrincipal() {
        mapaAtualAtivo = 'continente';
        fatorEscala = 0.23; // Escala do continente

        // Limpeza: Remove rota anterior e cancela modo de medi√ß√£o se ativo
        if (medindo) cancelarModoMedicao();
        grupoRota.clearLayers();
        pontosRota = [];

        document.getElementById('map-container').style.display = 'block';
        document.getElementById('provincia-container').style.display = 'none';
        document.getElementById('menu-provincias').style.display = 'block';

        // Ajusta visibilidade do menu dependendo do tamanho da tela
        atualizarVisibilidadeMenuMobile();

        if (marcadorTempCoords) { map.removeLayer(marcadorTempCoords); marcadorTempCoords = null; }
        inicializarMapa(configContinental.arquivo, configContinental.largura, configContinental.altura, configContinental.minZoom, configContinental.maxZoom);
        adicionarMarcadoresPrincipais();
        // Visibilidade de menu mobile j√° foi aplicada via helper
    }

/**
 * FUN√á√ïES DOS BOT√ïES EXTRAS - Menu Principal e Regional
 * Alternar Menu (mobile), Coordenadas, Medidor de Rota
 */

/**
 * SISTEMA DE SENHAS - Prote√ß√£o para √°reas ocultas
 * Senhas conhecidas: 'portal' (Planos), 'fofoca' (Torre), 'Seita' (P√¢ntano), 'ninja' (Lago), etc
 * Compara√ß√£o case-insensitive
 * Fluxo: abrirModalSenha -> verifica -> sucesso/erro -> executa a√ß√£o ou mostra erro
 */
    let senhaCorretaAtual = "";
    let destinoAposSenha = ""; 
    let tipoAcaoSenha = "mapa";
/**
 * Abre modal de prote√ß√£o por senha
 * @param {string} senha - Senha correta (aceita mai√∫scula/min√∫scula)
 * @param {string} destino - Arquivo a carregar ap√≥s sucesso
 * @param {string} tipo - 'mapa' ou 'imagem' (define a√ß√£o ap√≥s sucesso)
 */
    function abrirModalSenha(senha, destino, tipo = 'mapa') {
        senhaCorretaAtual = senha;
        destinoAposSenha = destino;
        tipoAcaoSenha = tipo;
        
        const modal = document.getElementById('modal-senha');
        const input = document.getElementById('input-senha-rpg');
        const msg = document.getElementById('msg-erro-senha');

        // Limpa estados anteriores
        input.value = "";
        input.disabled = false;
        msg.style.display = 'none';
        modal.style.display = 'flex';
        
        // Foca no campo automaticamente
        setTimeout(() => input.focus(), 50); 
    }

/**
 * Valida entrada da senha contra a senha correta
 * Sucesso: exibe mensagem verde, aguarda 1.2s, executa a√ß√£o (abrirMapaProvincia ou verImagemEstatica)
 * Erro: mostra mensagem padr√£o "AGUARDE descobrirem a senha", destaca input em vermelho
 */
function verificarSenha() {
    const input = document.getElementById('input-senha-rpg');
    const msg = document.getElementById('msg-erro-senha');
    
    if (input.value.toLowerCase() === (senhaCorretaAtual || "").toLowerCase()) {
        msg.style.display = 'block';
        msg.style.color = '#2ecc71'; 
        msg.innerHTML = "‚ú® Acesso concedido!";
        input.disabled = true;

        setTimeout(() => {
            fecharModalSenha();
            input.disabled = false;
            
            // L√≥gica para executar fun√ß√£o, imagem ou carregar mapa
            if (tipoAcaoSenha === 'imagem') {
                verImagemEstatica(destinoAposSenha);
            } else if (tipoAcaoSenha === 'funcao') {
                // Executa o comando de c√≥digo (ex: abrirMenuTorre)
                new Function(destinoAposSenha)(); 
            } else {
                abrirMapaProvincia(destinoAposSenha);
            }
        }, 1200);
    } else {
        msg.style.display = 'block';
        msg.style.color = '#ff4444';
        msg.innerHTML = "Senha incorreta. Por favor AGUARDE descobrirem a senha.";
        input.style.borderColor = "red";
        setTimeout(() => input.style.borderColor = "#8b4513", 500);
        input.select(); 
    }
}
/**
 * Fecha o modal de senha sem verifica√ß√£o
 * Reseta estado para pr√≥ximo uso
 */
    function fecharModalSenha() {
        document.getElementById('modal-senha').style.display = 'none';
    }

    // Atalho de teclado: ENTER executa verifica√ß√£o (melhora UX)
    const inputPass = document.getElementById('input-senha-rpg');
    if (inputPass) {
        inputPass.addEventListener("keypress", function(e) {
            if (e.key === "Enter") verificarSenha();
        });
    }
/**
 * Ativa/desativa modo de coordenadas
 * Ao ativar: cliques mostram [Y, X] em popup persistente (fecha com X do popup)
 * Conflita com: modeMedicao (desativa medidor se ativar coords)
 * Muda visual do bot√£o para indicar estado
 */
function alternarCoordenadas() {
    // Se for ligar as coordenadas e o medidor estiver ativo, mata o medidor primeiro
    if (!modoCoordenadas && medindo) {
        cancelarModoMedicao(); // Esta fun√ß√£o j√° seta medindo = false e limpa o visual
    }

    modoCoordenadas = !modoCoordenadas;
    
    const container = document.getElementById('map-container');
    
    // Atualiza o visual de TODOS os bot√µes de coordenadas (Menu e Prov√≠ncia)
    atualizarVisualBotao();

    if (modoCoordenadas) {
        container.classList.add('mapa-intangivel');
    } else {
        container.classList.remove('mapa-intangivel');
    }
}
/**
 * Sincroniza visual dos bot√µes de coordenadas (Menu + Regi√£o)
 * Aplica classe 'btn-ferramenta-ativa' (verde) quando coords est√£o ON
 * Atualiza texto: "Coords: ON" ou "Coords: OFF"
 */
function atualizarVisualBotao() {
    const botoes = [document.getElementById('btn-coords-menu'), document.getElementById('btn-coords-prov')];
    botoes.forEach(btn => {
        if (!btn) return;
        if (modoCoordenadas) {
            btn.innerHTML = "üìç Coords: ON";
            btn.classList.add('btn-ferramenta-ativa');
        } else {
            btn.innerHTML = "üìç Coords: OFF";
            btn.classList.remove('btn-ferramenta-ativa');
        }
    });
}
    // ... (O resto do seu c√≥digo: dadosProvincias, dadosCapital, etc. continua igual abaixo)

    // --- 5. BANCO DE DADOS (TEXTOS COMPLETOS RESTAURADOS) ---

    const textosPlanos = {
        'divino': {
            titulo: "O Plano Divino",
            texto: "<p><strong>A Luz Eterna:</strong> Onde residem as divindades da ordem. O tempo √© um eterno 'agora'.</p><hr><p>1. Port√£o Dourado<br>2. Jardins El√≠sios<br>3. Trono de Cristal</p>"
        },
        'demoniaco': {
            titulo: "O Plano Demon√≠aco",
            texto: "<p><strong>O Abismo:</strong> Reino de caos e sofrimento.</p><hr><p>1. Lama de Sangue<br>2. Cidadela de Ferro<br>3. Po√ßo Sem Fundo</p>"
        },
        'espiritual': {
            titulo: "O Plano Espiritual",
            texto: "<p><strong>O Fluxo:</strong> O rio de mana e almas.</p><hr><p>1. O V√©u<br>2. Biblioteca dos Sonhos<br>3. Mar de Almas</p>"
        },
        'mortal': {
            titulo: "O Plano Mortal (Arton)",
            texto: "<p><strong>O Equil√≠brio:</strong> O mundo material onde a vida acontece.</p>"
        }
    };

    const dadosProvincias = {
        'Hukmal_tep.jpg': {
            titulo: "Hukmal'tep - O Inverno Absoluto",
            descricao: `
                <p><strong>üìú Panorama:</strong> Uma vastid√£o dominada por picos colossais e frio implac√°vel. O vento uiva incessantemente entre os vales profundos, moldando uma paisagem onde apenas os mais resilientes prosperam sob o manto de neve eterna.</p>
                <p><strong>üëë Governan√ßa:</strong> O poder √© partilhado pelo <em>Conselho das Tr√™s Tribos</em> (Felistas, Malistas e Garra do Inverno). N√£o existe um soberano √∫nico, mas sim uma tr√©gua armada e tensa entre os cl√£s.</p>
                <p><strong>üßë‚Äçü§ù‚Äçüßë Habitantes:</strong> Predominantemente composta por Humanos adaptados ao clima severo, An√µes das montanhas e Mesti√ßos que buscam ref√∫gio na isola√ß√£o.</p>
                <p><strong>‚öîÔ∏è Tradi√ß√µes:</strong> Uma cultura que exalta a for√ßa bruta e o instinto de sobreviv√™ncia. A magia √© encarada com profundo ceticismo e desconfian√ßa. Estudiosos e acad√™micos s√£o raros e raramente bem-vindos.</p>
                <p><strong>üíé Subsist√™ncia:</strong> A economia gira em torno do com√©rcio de peles ex√≥ticas e subprodutos obtidos da ca√ßa de feras colossais que habitam a regi√£o.</p>
            `
        },
        'Blat_khyr.jpg': {
            titulo: "Blat'khyr - O Ber√ßo da Magia",
            descricao: `
                <p><strong>üìú Panorama:</strong> Um reino onde a realidade √© moldada pelo fluxo m√≠stico. A densidade de mana nesta prov√≠ncia √© t√£o alta que a pr√≥pria fauna e flora sofreram muta√ß√µes m√°gicas, criando cen√°rios de beleza surreal e perigo arcano.</p>
                <p><strong>üëë Governan√ßa:</strong> Embora exista uma linhagem real √©lfica cerimonial, a gest√£o administrativa e pol√≠tica reside nas m√£os do <em>Conselho √âlfico</em>, composto pelos mais experientes anci√£os da ra√ßa.</p>
                <p><strong>üßë‚Äçü§ù‚Äçüßë Habitantes:</strong> Uma popula√ß√£o majoritariamente de Elfos e Humanos com afinidade m√°gica.</p>
                <p><strong>‚öîÔ∏è Tradi√ß√µes:</strong> A sociedade valoriza o intelecto, a eleg√¢ncia e a maestria arcana. Existe um forte sentimento de preserva√ß√£o cultural entre os Elfos, que muitas vezes evitam o contato pr√≥ximo com outras ra√ßas para preservar o seu "potencial m√≠stico".</p>
                <p><strong>üíé Subsist√™ncia:</strong> O epicentro do mercado arcano, focado na cria√ß√£o, encantamento e exporta√ß√£o de itens m√°gicos de alt√≠ssima qualidade.</p>
            `
        },
        'Deserto.jpg': {
            titulo: "O Deserto - A Origem do Mundo",
            descricao: `
                <p><strong>üìú Sociedade de Castas:</strong> Uma teocracia r√≠gida baseada no controle da √°gua. No topo est√£o os <strong>Zha-Ruk</strong> (Senhores da Nascente), seguidos pelos <strong>Atarim</strong> (Buscadores de Rel√≠quias) e os ricos <strong>Samum</strong> (Mercadores). A base √© formada pelos <strong>Ghovar</strong> (Trabalhadores) e, √† margem, os temidos <strong>Khali</strong> (Os "Secos" ou intoc√°veis).</p>
                <p><strong>üëë Governan√ßa:</strong> Cidades-estado controladas pelos Zha-Ruk, onde a lei √© ditada pela preserva√ß√£o h√≠drica. Desperdi√ßar √°gua √© punido com a morte ou ex√≠lio.</p>
                <p><strong>üßë‚Äçü§ù‚Äçüßë Ra√ßas Principais:</strong> Humanos, Meio-dem√¥nios, an√µes, mesti√ßos e seres adaptados ao calor extremo.</p>
                <p><strong>‚öîÔ∏è Tradi√ß√µes:</strong> Forte tradi√ß√£o oral e leis de hospitalidade r√≠gidas. As ru√≠nas antigas s√£o consideradas sagradas e perigosas, acess√≠veis apenas aos autorizados.</p>
                <p><strong>üíé Economia:</strong> Extra√ß√£o de especiarias raras, min√©rios e venda de rel√≠quias da "Primeira Era" encontradas nas escava√ß√µes.</p>
            `
        },
        'Lago.jpg': {
            titulo: "O Lago - O Solo Aben√ßoado",
            descricao: `
                <p><strong>üìú Panorama:</strong> Uma regi√£o de serenidade contemplativa, onde a honra se reflete nas √°guas cristalinas do lago sagrado. A arquitetura √© integrada √† natureza, utilizando madeira e pedra em designs orientais cl√°ssicos.</p>
                <p><strong>üëë Governan√ßa:</strong> Uma oligarquia de disnastias que comandam as terras e que governam sob um r√≠gido c√≥digo de honra e lealdade ao trono imperial.</p>
                <p><strong>üßë‚Äçü§ù‚Äçüßë Habitantes:</strong> Humanos e Mesti√ßos.</p>
                <p><strong>‚öîÔ∏è Tradi√ß√µes:</strong> Os costumes s√£o profundamente orientais, valorizando o respeito aos ancestrais, a cerim√¥nia do ch√° e a disciplina das artes marciais e caligrafia. A harmonia e o equil√≠brio espiritual s√£o os pilares da sociedade.</p>
                <p><strong>üíé Subsist√™ncia:</strong> Produz gr√£os finos, seda de alta qualidade e pescados raros encontrados apenas nas profundezas do lago.</p>
            `
        },
        'Alcova.jpg': {
            titulo: "Alcova - O Lar dos Piratas",
            descricao: `
                <p><strong>üìú Descri√ß√£o:</strong> Um arquip√©lago repleto de ba√≠as escondidas, cavernas marinhas e rotas de navega√ß√£o perigosas.</p>
                <p><strong>üëë Governo:</strong> Uma "Confedera√ß√£o Livre" onde a lei √© ditada por quem possui o navio mais r√°pido ou os canh√µes mais fortes.</p>
                <p><strong>üßë‚Äçü§ù‚Äçüßë Ra√ßas Principais:</strong> Uma mistura ca√≥tica de todas as ra√ßas, principalmente aquelas fugindo da lei imperial.</p>
                <p><strong>‚öîÔ∏è Cultura:</strong> Liberdade individual extrema e um c√≥digo de honra duvidoso entre capit√£es.</p>
                <p><strong>üíé Economia:</strong> Pirataria, mercado negro e transporte de mercadorias ex√≥ticas "n√£o taxadas".</p>
            `
        },
        'Espinha do Gigante.jpg': {
            titulo: "Regi√£o Desconhecida",
            descricao: "<p>N√£o h√° registros detalhados sobre esta √°rea nos arquivos imperiais.</p>"
        },

    'Mar.jpg': {
        titulo: "O Mar Profundo",
        descricao: "<p><strong>üåä Descri√ß√£o:</strong> Uma vastid√£o azul e perigosa, acess√≠vel apenas para aqueles que conhecem os segredos das mar√©s.</p>"
    }, 
'Planos.jpg': {
        titulo: "A Grande Roda Cosmol√≥gica",
        descricao: `
            <p><strong>üåå O Nexus:</strong> O ponto de converg√™ncia absoluto entre todas as realidades. √â daqui que as almas partem para seus destinos finais ou retornam para suas origens.</p>
            <p>Este √© o centro da exist√™ncia, onde os v√©us entre os mundos s√£o mais finos e a pr√≥pria realidade parece vibrar com a energia dos portais.</p>
        `
    },
    'Plano Espiritual.png': {
        titulo: "üçÉ O Plano Espiritual",
        descricao: `
            <p><strong>Lei do Mundo:</strong> O tempo aqui √© uma ilus√£o; dias podem passar como segundos. A pr√≥pria ess√™ncia do plano √© inebriante, e viajantes devem testar sua vontade constantemente, pois o desejo de permanecer para sempre √© uma armadilha doce e perigosa.</p>
            <hr>
            <p><strong>1¬∫ Andar: √âden</strong><br>Um para√≠so de luz eterna onde a noite nunca cai. Habitado por fadas e esp√≠ritos elementais, oferece frutas e conforto em abund√¢ncia. √â a distra√ß√£o perfeita para quem esquece seu prop√≥sito.</p>
            <p><strong>2¬∫ Andar: Naitim√©re</strong><br>O reflexo sombrio. Um reino de noite perp√©tua que distorce a realidade para manifestar seus pesadelos mais profundos. A sanidade √© o recurso mais escasso aqui.</p>
            <p><strong>3¬∫ Andar: Animalia</strong><br>Lar de Bestas Primordiais dotadas de fala e intelecto. A regra da ca√ßa √© brutal: "aquele que tira uma vida, assume sua forma", transformando ca√ßadores em presas.</p>
            <p><strong>4¬∫ Andar: Fungi</strong><br>Uma floresta alien√≠gena de cogumelos colossais. Esporos flutuam no ar com efeitos que variam da cura milagrosa √† alucina√ß√£o mortal. √â o territ√≥rio de gigantes silenciosos.</p>
            <p><strong>5¬∫ Andar: O Vegetal</strong><br>O cora√ß√£o verde onde Ents e Dr√≠ades guardam a vida. A flora √© t√£o vibrante que consome a carne; visitantes sentem sua pele enrijecer e folhas brotarem se ficarem tempo demais.</p>
            <p><strong>6¬∫ Andar: Draconfelt</strong><br>O ber√ßo dos Drag√µes. Uma terra de biomas extremos e majestosos. A grandiosidade do ambiente cobra um pre√ßo, drenando lentamente a energia vital daqueles que n√£o pertencem a este lugar.</p>
        `
    },
    'Plano Divino.png': {
        titulo: "‚òÄÔ∏è O Plano Divino",
        descricao: `
            <p><strong>Lei do Mundo:</strong> Um santu√°rio de pureza absoluta. Maldi√ß√µes s√£o anuladas instantaneamente e poderes das trevas definham. Os Anjos, guardi√µes deste reino, s√£o incapazes de mentir, embora sejam mestres na arte da verdade incompleta.</p>
            <hr>
            <p><strong>1¬∫ Andar: Olimpo</strong><br>O cume da cria√ß√£o. Morada exclusiva das divindades maiores. O ar vibra com poder divino e a entrada √© restrita apenas aos pr√≥prios deuses ou convidados de honra excepcional.</p>
            <p><strong>2¬∫ Andar: Angeheim</strong><br>A Cidadela da Verdade. A atmosfera imp√µe uma press√£o f√≠sica sobre a falsidade; √© imposs√≠vel proferir uma mentira enquanto se respira o ar deste lugar.</p>
            <p><strong>3¬∫ Andar: Sovengarde</strong><br>O eterno campo de batalha. O destino daqueles que ca√≠ram bravamente em combate. Aqui, ferimentos mortais cicatrizam ao amanhecer, permitindo que a gl√≥ria da luta recomece.</p>
            <p><strong>4¬∫ Andar: R√©vem</strong><br>O descanso final das almas benevolentes. A paz √© t√£o absoluta que se torna perigosa: a bondade do ambiente for√ßa uma purifica√ß√£o espiritual, podendo apagar a personalidade original do visitante.</p>
            <p><strong>5¬∫ Andar: Cosmos</strong><br>O vazio iluminado. O lar das Estrelas e entidades c√≥smicas. Caminhar por aqui √© tocar o tecido do universo, e os dignos podem receber b√™n√ß√£os estelares.</p>
        `
    },
    'Plano Demon√≠aco.png': {
        titulo: "üî• O Plano Demon√≠aco",
        descricao: `
            <p><strong>Lei do Mundo:</strong> Um abismo que fortalece a magia negra e as artes profanas. A atmosfera √© t√≥xica para a alma; a exposi√ß√£o prolongada convida maldi√ß√µes terr√≠veis a se instalarem no corpo do viajante.</p>
            <hr>
            <p><strong>1¬∫ Andar: O Abismo</strong><br>Um labirinto de crep√∫sculo eterno e n√©voa densa. As luzes brilham com metade da for√ßa e as sombras parecem ter vida pr√≥pria. Perder o caminho aqui √© fatalmente f√°cil.</p>
            <p><strong>2¬∫ Andar: Gehenna</strong><br>O Deserto da Desola√ß√£o. Dunas infinitas feitas das cinzas de almas. O vento drena a energia f√≠sica e mental, levando os viajantes √† exaust√£o e √† depress√£o profunda.</p>
            <p><strong>3¬∫ Andar: O C√°rcere</strong><br>A pris√£o eterna de rocha e ferro est√©ril. Magias de transporte e comunica√ß√£o s√£o anuladas. √â um lugar de sil√™ncio, repleto de armadilhas para garantir que nada escape.</p>
            <p><strong>4¬∫ Andar: Inferno</strong><br>O epicentro da dor, cortado por rios de lava e sangue. A maldade do ambiente √© contagiosa, tentando ativamente corromper o cora√ß√£o dos visitantes e torn√°-los naquilo que desprezam.</p>
            <p><strong>5¬∫ Andar: Diabolos</strong><br>O Ninho. Uma rede claustrof√≥bica de t√∫neis org√¢nicos e f√©tidos. A exposi√ß√£o prolongada inicia uma metamorfose grotesca, transformando o vivo em mais uma larva da colmeia.</p>
        `
    },
    // ... outros mapas
        'default': { 
            titulo: "Regi√£o Desconhecida", 
            descricao: "<p>N√£o h√° registros detalhados sobre esta √°rea nos arquivos imperiais.</p>" 
            
        }
    };

/**
 * ESTRUTURA DE DADOS PRINCIPAL
 * Tr√™s objetos globais mant√™m TODO conte√∫do do jogo (sem banco de dados externo)
 * 
 * 1. dadosProvincias: Descri√ß√µes textuais de 5 regi√µes principais
 *    Exemplo: dadosProvincias['Hukmal_tep.jpg'] = { titulo: "...", descricao: "..." }
 * 
 * 2. dadosGerais: Banco, investimentos, pante√£o de 12 deuses
 *    Usado por: menuCapital('banco'), menuDeuses()
 * 
 * 3. dadosCapital: Conte√∫do da capital (squad, criminosos, besti√°rio, etc)
 *    - esquadrao: 6 personagens jog√°veis
 *    - procurados: 8 criminosos com recompensas
 *    - bestiario: Criaturas encontradas com fraquezas/drops
 *    - boatos: 100 boatos, apenas 1 descoberto
 *    - historico: 5 cap√≠tulos de lore com imagens embarcadas
 *    - lendas: 12 her√≥is lend√°rios
 * 
 * SISTEMA DE FOTOS:
 *   - Todos os nomes de foto devem ser EXATOS (case-sensitive)
 *   - Fotos s√£o PNGs/JPGs no workspace root
 *   - Se null, exibe placeholder gen√©rico
 * 
 * BOATOS: Sistema simples de descoberta
 *   - Lista[0..98]: N√£o descobertos, texto mascarado com \"??\"
 *   - Lista[99]: Boato 100, √∫nico descoberto no in√≠cio
 */

// --- DADOS DA CAPITAL (COM FOTOS) ---
// 1. Cria 100 boatos vazios automaticamente
    const listaBoatos = Array.from({ length: 100 }, (_, i) => ({
        id: i + 1,
        texto: "Boato ainda n√£o ouvido...",
        descoberto: false
    }));

    // 2. Define o Boato 100 (O √∫nico conhecido agora)
    // Nota: Como array come√ßa no 0, o boato 100 fica na posi√ß√£o 99
    listaBoatos[99] = {
        id: 100,
        texto: "Dizem que existe um 101¬∫ boato que revela o segredo para se tornar um deus, mas ningu√©m nunca o ouviu. E dizem que tudo o que voc√™ ouviu at√© agora pode ser uma mentira inventada para te manter longe da verdade.",
        descoberto: true
    };

/**
 * DADOS GERAIS - Banco Imperial e Pantheon
 * Informa√ß√µes de investimentos, pacotes de seguro, e 12 deuses principais
 */
    const dadosGerais = {
        banco: [
            { nome: "Pacote Econ√¥mico", custo: "2 Golds", desc: "Poder enterrar em um canto e o gerente finge que n√£o viu." },
            { nome: "Pacote Iniciante", custo: "5 Golds", desc: "Guarda at√© 50 golds e 1 item." },
            { nome: "Pacote Intermedi√°rio", custo: "15 Golds", desc: "Guarda 150g, 1 armadura, 1 arma, 3 itens. (Acesso transporte imperial)" },
            { nome: "Pacote Avan√ßado", custo: "35 Golds", desc: "Seguro de vida, 300g, 2 armaduras, 4 armas, 6 itens, 1 criatura. (Acesso transporte)" },
            { nome: "Pacote Arranjado", custo: "A Definir", desc: "Negociado diretamente com o contratante." },
            { nome: "Pacote VIP", custo: "Exclusivo", desc: "Guarda de objeto/criatura com avalia√ß√£o personalizada." }
        ],
        investimentos: [
            { nome: "Tesouro Imperial", risco: "Baixo Risco", min: "5g" },
            { nome: "A√ß√µes do Imp√©rio", risco: "Alto Risco", min: "5g" }
        ],
        // Pante√£o: 12 deuses principais com dom√≠nios
        deuses: [
        { nome: "Pelor", titulo: "Sol, Luz e Fogo", raca: "Anjos", foto: "Pelor.png" },
        { nome: "Aqua", titulo: "√Ågua e Serenidade", raca: "Halflings", foto: "Aqua.png" },
        { nome: "Celeste", titulo: "Espa√ßo", raca: "Estrelas", foto: "Celeste.png" },
        { nome: "Luna", titulo: "Lua e Trevas", raca: "Dem√¥nios", foto: "Luna.png" },
        { nome: "Laphiaferd", titulo: "Magia", raca: "Esp√≠ritos", foto: "Laphiaferd.png" },
        { nome: "H√∫ngaro", titulo: "Tempo", raca: "Humanos", foto: "H√∫ngaro.png" },
        { nome: "Terraria", titulo: "Terra e Lealdade", raca: "An√µes", foto: "Terraria.png" },
        { nome: "Astronof", titulo: "Ar e Conhecimento", raca: "Machinas", foto: "Astronof.png" },
        { nome: "Golias (PVP)", titulo: "Guerra", raca: "Gigantes", foto: "Golias (PvP).png" },
        { nome: "Dentos", titulo: "Gan√¢ncia", raca: "Orcs e Trolls", foto: "Dentos.png" },
        { nome: "Lusit√¢nia", titulo: "Plantas", raca: "Elfos", foto: "Lusit√¢nia.png" },
        { nome: "Ruegra", titulo: "Animais", raca: "Mesti√ßos", foto: "Ruegra.png" }
    ]
};

    const dadosCapital = {
        esquadrao: [
            // Coloque o nome EXATO do arquivo da imagem que est√° na pasta
            { 
                nome: "Lythael Serind√´", 
                classe: "Curandeira", 
                raca: "Elfa alta",
                foto: "Lythael.png",  // <--- AQUI VAI O ARQUIVO DA FOTO
                desc: "Uma guardi√£ serena e observadora, cuja gentileza externa esconde uma for√ßa inabal√°vel dedicada a proteger e valorizar toda forma de vida.om uma espada longa." 
            },
            { 
                nome: "Valkia Huniman", 
                raca: "Meio Anja",
                classe: "Guerreira", 
                foto: "Valkia.png",     // <--- AQUI VAI O ARQUIVO DA FOTO
                desc: "Embora aparente seriedade inicial, logo revela uma natureza vibrante e impetuosa, movida pelo desejo de provar sua evolu√ß√£o enquanto exalta constantemente os nomes de Ryuiki e Daruin." 
            },
                        { 
                nome: "Greta Thunder", 
                raca: "Elfa da Floresta",
                classe: "Maga", 
                foto: "Greta.jpg",     // <--- AQUI VAI O ARQUIVO DA FOTO
                desc: "Uma guardi√£ solit√°ria de Desterroth que nutre profundo desprezo pela humanidade e outras ra√ßas, confiando apenas na justi√ßa da natureza e em seus cactos; agora, ela √© for√ßada a agir contra uma corrup√ß√£o obscura que amea√ßa a floresta que jurou proteger." 
            },
                        { 
                nome: "Balon Blacktide", 
                raca: "Meio Dem√¥nio",
                classe: "Ca√ßador", 
                foto: "Balon.jpg",     // <--- AQUI VAI O ARQUIVO DA FOTO
                desc: "Das li√ß√µes da nobreza aos naufr√°gios da pirataria, este meio-dem√¥nio de poucas palavras carrega no sobrenome a marca de sua sobreviv√™ncia e, na alma, o conflito eterno entre o sangue amaldi√ßoado e a luz que busca gui√°-lo." 
            },
                        { 
                nome: "Thorga Punho de Ferro", 
                raca: "An√£o",
                classe: "Guerreiro", 
                foto: "Thorga.jpg",     // <--- AQUI VAI O ARQUIVO DA FOTO
                desc: "Exilado injustamente das forjas ancestrais, Thorgar √© um mercen√°rio impetuoso que rejeita a autoridade de reis e deuses, lutando pela pura emo√ß√£o da batalha e para provar que sua for√ßa basta por si s√≥." 
            },
                        { 
                nome: "Li√©sty", 
                raca: "Elfa Negra",
                classe: "Maga", 
                foto: "Li√©sty.jpg",     // <--- AQUI VAI O ARQUIVO DA FOTO
                desc: "Sobrevivente solit√°ria de uma destrui√ß√£o brutal, esta elfa negra trocou a companhia dos vivos pelo sil√™ncio de sua cabana na floresta, onde sua natureza sombria e suas artes arcanas servem como barreira contra um mundo que ela aprendeu a desprezar." 
            }
        ],
        procurados: [
            { 
                nome: "Kalamar", 
                recompensa: "1.800 Moedas de Ouro", 
                foto: "Kalamar.png",   // <--- AQUI VAI O ARQUIVO DA FOTO
                desc: "Vivo ou morto. Lenda dos mares que trocou a gl√≥ria da aventura pelo submundo. Comanda uma frota colossal que espalha terror pelos oceanos, traficando de rel√≠quias a vidas sem distin√ß√£o." 
            },
            { 
                nome: "Bruiser", 
                recompensa: "1.200 Moedas de Ouro", 
                foto: "Bruiser.png",        // Se n√£o tiver foto, coloque null ou apague a linha foto
                desc: "Vivo ou morto. Um mago renegado cuja sede de conhecimento ultrapassou a moralidade. Procurado por conduzir experimentos grotescos e ilegais em seres vivos, distorcendo a natureza em busca de poder." 
            },
            { 
                nome: "Leimo", 
                recompensa: "1.500 Moedas de Ouro", 
                foto: "Leimo.png",           // Se n√£o tiver foto, coloque null ou apague a linha foto
                desc: "Morto. Ex-membro da Torre dos S√°bios. Sua genialidade tornou-se arrog√¢ncia; ele se rebelou por acreditar ser uma divindade entre mortais, usando segredos arcanos para cometer crimes contra o Imp√©rio." 
            },
            { 
                nome: "O Palha√ßo", 
                recompensa: "10.000 Moedas de Ouro", 
                foto: "Palha√ßo.png",          // Se n√£o tiver foto, coloque null ou apague a linha foto
                desc: "Vivo. Um agente do caos que semeia disc√≥rdia por puro entretenimento. Suspeito de conspirar com for√ßas das trevas, ele manipula reinos para incitar guerras, rindo enquanto o mundo queima." 
            },
            { 
                nome: "Fanastia", 
                recompensa: "700 Moedas de Ouro", 
                foto: "Fanastia.png",           // Se n√£o tiver foto, coloque null ou apague a linha foto
                desc: "Vivo ou morto. Uma vampira ancestral com um rastro de sangue que atravessa s√©culos. Respons√°vel pelo massacre de mais de mil almas, ela v√™ a humanidade apenas como alimento para saciar sua sede eterna." 
            },
            { 
                nome: "Mari, a Psicopata", 
                recompensa: "500 Moedas de Ouro", 
                foto: "Mari.png",           // Se n√£o tiver foto, coloque null ou apague a linha foto
                desc: "Morto. Uma for√ßa de destrui√ß√£o imprevis√≠vel e sem remorso. N√£o possui agenda pol√≠tica ou m√°gica; mata por impulso e loucura, deixando um rastro de terror por onde passa." 
            },
            { 
                nome: "Leoncio", 
                recompensa: "2.000 Moedas", 
                foto: "Leoncio.png",           // Se n√£o tiver foto, coloque null ou apague a linha foto
                desc: "Morto. Antigo instrutor de elite do Imp√©rio, agora seu maior traidor. Conhece todas as t√°ticas militares de seus ex-aliados, usando esse conhecimento para desestabilizar a na√ß√£o que jurou defender." 
            },
            { 
                nome: "Drai", 
                recompensa: "2.000 Moedas", 
                foto: "Drai.png",           // Se n√£o tiver foto, coloque null ou apague a linha foto
                desc: "Morto. Feiticeira xen√≥foba obcecada pelos esp√≠ritos da floresta. V√™ outras ra√ßas como pragas e executa assassinatos em massa para 'purificar' a natureza, servindo a uma vis√£o distorcida do equil√≠brio." 
            }
        ],
        
        // --- NOVO: HIST√ìRICO ---
        historico: [
            {
                titulo: "Cap√≠tulo 0: O Chamado",
                texto: `
                A jornada come√ßou com um sonho misterioso, onde o <span class="link-historia" onclick="verImagemHistoria('Serafim.png', 0)">Serafim da Ordem</span> revelou o retorno de uma for√ßa de destrui√ß√£o. Em troca de salvarem o mundo, ele prometeu realizar seus desejos e os guiou at√© a <span class="link-historia" onclick="verImagemHistoria('Capital.png', 0)">Capital Imperial</span>.
                
                L√°, o grupo se alistou no ex√©rcito com a ajuda do amig√°vel <span class="link-historia" onclick="verImagemHistoria('Will.png', 0)">Will</span> e adotou o nome "Os Pandem√¥nios". Para provar seu valor, enfrentaram os testes rigorosos da Comandante <span class="link-historia" onclick="verImagemHistoria('Valentina.png', 0)">Valentina</span>, que inclu√≠ram enigmas e uma batalha brutal contra um <span class="link-historia" onclick="verImagemHistoria('Gorila.png', 0)">Gorila</span> feroz.
                
                Na primeira miss√£o, sob a supervis√£o da arrogante Mestra <span class="link-historia" onclick="verImagemHistoria('Carla.png', 0)">Carla</span>, foram capturados pelo infame Capit√£o <span class="link-historia" onclick="verImagemHistoria('Kalamar.png', 0)">Kalamar</span>. Amea√ßados, tiveram que explorar uma masmorra antiga repleta de enigmas e tecnologia esquecida.
                
                O cl√≠max foi o confronto contra um <span class="link-historia" onclick="verImagemHistoria('Kraken.png', 0)">Kraken</span> colossal. Ap√≥s derrotarem a besta e recuperarem uma b√∫ssola m√°gica, a ilha foi destru√≠da, e o grupo escapou por pouco gra√ßas √† interven√ß√£o her√≥ica de Will.`
            },
            {
                titulo: "Cap√≠tulo 1: Desconhecido",
                texto: `Aventura em progresso...`
            },
            {
                titulo: "Cap√≠tulo 2: Desconhecido",
                texto: `Aventura em progresso...`
            },
            {
                titulo: "Cap√≠tulo 3: Desconhecido",
                texto: `Aventura em progresso...`
            },
            {
                titulo: "Cap√≠tulo 4: Desconhecido",
                texto: `Aventura em progresso...`
            }
        ],
// ... dentro de dadosCapital ...
        bestiario: [
            { 
                nome: "Gorila Gliador", 
                perigo: "üíÄ", 
                fraqueza: "N√£o h√°", 
                drops: "Pele de gorila", 
                foto: "Gorila.png", // Coloque a foto se tiver
                desc: "Uma besta territorial encontrada nas selvas do Coliseu. Usado para testar a for√ßa de gladiadores."
            },
            { 
                nome: "Kraken", 
                perigo: "üíÄüíÄüíÄüíÄüíÄüíÄ", 
                fraqueza: "Pedra gigante do Will", 
                drops: "Tinta M√≠stica, Tent√°culo Gigante", 
                foto: "Kraken.png", 
                desc: "O terror dos mares. Foi derrotado, mas boatos dizem que era apenas um filhote."
            },
            { 
                nome: "Murloc", 
                perigo: "üíÄ", 
                fraqueza: "Fogo, Ataques f√≠sicos, Gente inteligente", 
                drops: "Armas simples", 
                foto: "murloc.png", 
                desc: "Ca√ßam em bandos, gostam de lugares √∫midos e fechados"
            }
        ], 
        // ... dentro de dadosCapital ...
        
        lendas: [
            { 
                nome: "A Bruxa", 
                titulo: "A Guardi√£ Eterna", 
                desc: "Protetora dos segredos arcanos. Sua vigil√¢ncia constante impede que for√ßas m√≠sticas ameacem o equil√≠brio do mundo." 
            },
            { 
                nome: "O Palha√ßo", 
                titulo: "O Agente do Destino", 
                desc: "Com t√°ticas imprevis√≠veis, desestabilizou as fileiras inimigas, trazendo a vit√≥ria atrav√©s da genialidade n√£o convencional." 
            },
            { 
                nome: "A Prod√≠gio", 
                titulo: "A Arquiteta do Amanh√£", 
                desc: "Mente brilhante que forjou as defesas do reino, provando que a engenhosidade humana pode alcan√ßar o divino." 
            },
            { 
                nome: "O Druida", 
                titulo: "A Voz da Terra", 
                desc: "Aquele que uniu a f√∫ria da natureza √† causa dos mortais, garantindo que o mundo lutasse ao nosso lado." 
            },
            { 
                nome: "A Santa", 
                titulo: "A Luz da Esperan√ßa", 
                desc: "Sua f√© inabal√°vel foi o escudo que protegeu as almas inocentes durante as eras mais sombrias." 
            },
            { 
                nome: "O Her√≥i", 
                titulo: "O Escudo da Honra", 
                desc: "O l√≠der inquebr√°vel, cujo c√≥digo moral e bravura inspiraram ex√©rcitos inteiros a nunca recuar." 
            },
            { 
                nome: "O S√°bio", 
                titulo: "O Olho da Verdade", 
                desc: "Detentor do conhecimento supremo, cujas estrat√©gias foram tra√ßadas com uma sabedoria al√©m da compreens√£o mortal." 
            },
            { 
                nome: "A Vidente", 
                titulo: "A Tecel√£ do Tempo", 
                desc: "Guiou o grupo atrav√©s das infinitas possibilidades, garantindo o √∫nico futuro onde a luz prevaleceria." 
            },
            { 
                nome: "A Feiticeira", 
                titulo: "O Avatar do Poder", 
                desc: "Uma for√ßa da natureza em forma humana, cuja magia devastadora foi a espada que quebrou as defesas demon√≠acas." 
            },
            { 
                nome: "O Espadachim", 
                titulo: "A L√¢mina Perfeita", 
                desc: "O guerreiro definitivo, cuja maestria marcial transcendeu os limites f√≠sicos para derrotar o mal." 
            },
            { 
                nome: "O Bardo", 
                titulo: "A Alma do Mundo", 
                desc: "Suas can√ß√µes n√£o apenas registraram a hist√≥ria, mas acenderam a chama da coragem nos cora√ß√µes desesperados." 
            },
            { 
                nome: "O Invocador", 
                titulo: "O Mestre dos Planos", 
                desc: "Convocou aliados de dimens√µes distantes, unindo universos diferentes em prol da salva√ß√£o de Tarre." 
            }
        ],

        boatos: listaBoatos 

        
    };

/**
 * Exibe menus contextuais da Capital Imperial com diferentes abas
 * Tipos dispon√≠veis: 'lendas', 'banco', 'boatos', 'historico', 'bestiario', 'esquadrao', 'procurados'
 * Rastreia qual menu est√° aberto em menuAtualAberto para voltar corretamente de fotos
 * @param {string} tipo - Tipo de menu a exibir
 */
    /**
 * MENU CAPITAL - Sistema de abas din√¢mico para 7 tipos de conte√∫do
 * Atualiza menuAtualAberto = tipo para sincronizar back buttons de imagens
 * Tipos suportados:
 *   'lendas'     - 5 cap√≠tulos hist√≥ricos com imagens embutidas
 *   'banco'      - 6 pacotes de investimento + c√°lculos de retorno
 *   'historico'  - Cronologia com descri√ß√£o de √©pocas
 *   'bestiario'  - Criatura do bestiario com foto/desc/ataques
 *   'esquadrao'  - 6 PCs com classe/raca/lore/foto
 *   'procurados' - 8 criminosos procurados com recompensas
 *   'boatos'     - 100 rumores (apenas 1 descoberto no in√≠cio)
 * Back buttons de imagens retornam a menuCapital(tipo) via callback
 */
function menuCapital(tipo) {
    const modal = document.getElementById('modal-capital');
    const container = document.getElementById('conteudo-menu-capital');
    const titulo = document.getElementById('titulo-menu-capital');
    modal.style.display = 'flex';
    container.innerHTML = "";
    if (tipo !== 'hub') menuAtualAberto = tipo;

    if (tipo === 'hub') {
        menuAtualAberto = 'hub';
        titulo.innerText = "üèõÔ∏è Centro Administrativo";
        container.innerHTML = `
            <div style="display: grid; gap: 20px; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));">
                <section>
                    <div style="color: #cd853f; font-size: 13px; border-bottom: 1px solid #444; margin-bottom: 10px; font-weight: bold;">üìú HIST√ìRICO</div>
                    ${criarBtn("üìñ Miss√µes", "menuCapital('historico')", "#9370DB")}
                    ${criarBtn("üìñ Besti√°rio", "menuCapital('bestiario')", "#2E8B57")}
                    ${criarBtn("üó£Ô∏è Boatos", "menuCapital('boatos')", "#800080")}
                </section>
                <section>
                    <div style="color: #cd853f; font-size: 13px; border-bottom: 1px solid #444; margin-bottom: 10px; font-weight: bold;">üë• PESSOAS & LENDAS</div>
                    ${criarBtn("üõ°Ô∏è Esquadr√£o", "menuCapital('esquadrao')", "#4682B4")}
                    ${criarBtn("‚öúÔ∏è Her√≥is Lend√°rios", "menuCapital('lendas')", "#DAA520")}
                    ${criarBtn("‚ò†Ô∏è Procurados", "menuCapital('procurados')", "#8b0000")}
                </section>
                <section>
                    <div style="color: #cd853f; font-size: 13px; border-bottom: 1px solid #444; margin-bottom: 10px; font-weight: bold;">‚ÑπÔ∏è INFORMA√á√ïES</div>
                    ${criarBtn("üìö Biblioteca", "abrirBiblioteca()", "#483D8B")}
                    ${criarBtn("üè¶ Banco Imperial", "menuCapital('banco')", "#ffd700")}
                    ${criarBtn("üì∏ Ver Cidade", "verImagemEstatica('Capital.png', () => { restaurarMapaMenu(); menuCapital('hub'); })", "#5F9EA0")}
                </section>
            </div>`;
        return;
    }

    const btnVoltar = `<button onclick="menuCapital('hub')" class="btn-popup" style="margin-bottom:15px; background:#444; width:100%;">‚¨Ö Voltar ao Painel</button>`;

    if (tipo === 'bestiario') {
        titulo.innerText = "üìñ Besti√°rio Conhecido";
        container.innerHTML = btnVoltar;
        dadosCapital.bestiario.forEach(m => {
            let img = m.foto ? `<img src="${m.foto}" class="foto-lista" onclick="verImagemPersonagem('${m.foto}')">` : `<div class="foto-placeholder">?</div>`;
            container.innerHTML += `
                <div class="item-bestiario">
                    ${img}
                    <div class="texto-item">
                        <h4>${m.nome} <span class="tag-perigo">${m.perigo}</span></h4>
                        <span class="tag-info"><span class="tag-titulo-info">Fraqueza:</span> ${m.fraqueza}</span>
                        <span class="tag-info"><span class="tag-titulo-info">Drops:</span> ${m.drops}</span>
                        <p style="margin-top:8px;">${m.desc}</p>
                    </div>
                </div>`;
        });
    } else if (tipo === 'procurados') {
        titulo.innerText = "‚ò†Ô∏è Cartazes de Procurados";
        container.innerHTML = btnVoltar;
        dadosCapital.procurados.forEach(p => {
            let img = p.foto ? `<img src="${p.foto}" class="foto-lista" onclick="verImagemPersonagem('${p.foto}')">` : `<div class="foto-placeholder">WANTED</div>`;
            container.innerHTML += `<div class="item-menu">${img}<div class="texto-item"><h4>${p.nome}</h4><span class="recompensa">üí∞ ${p.recompensa}</span><p>${p.desc}</p></div></div>`;
        });
    } else if (tipo === 'esquadrao') {
        titulo.innerText = "üõ°Ô∏è Esquadr√£o";
        container.innerHTML = btnVoltar;
        dadosCapital.esquadrao.forEach(e => {
            let img = e.foto ? `<img src="${e.foto}" class="foto-lista" onclick="verImagemPersonagem('${e.foto}')">` : `<div class="foto-placeholder">RETRATO</div>`;
            container.innerHTML += `<div class="item-menu">${img}<div class="texto-item"><h4>${e.nome}</h4><span class="classe-char">${e.raca} ‚Ä¢ ${e.classe}</span><p>${e.desc}</p></div></div>`;
        });
    } else if (tipo === 'lendas') {
        titulo.innerText = "üèõÔ∏è Her√≥is Lend√°rios";
        container.innerHTML = btnVoltar + `<p style="text-align:center; color:#aaa; font-style:italic;">"Bravos membros da campanha que derrotou o primeiro Rei Dem√¥nio"</p>`;
        dadosCapital.lendas.forEach(h => {
            container.innerHTML += `<div class="item-menu"><div class="texto-item" style="width:100%;"><h4>${h.nome}</h4><span class="classe-char">${h.titulo}</span><p>${h.desc}</p></div></div>`;
        });
    } else if (tipo === 'banco') {
        titulo.innerText = "üè¶ Banco Imperial";
        let html = btnVoltar + `<table class="tabela-banco"><tr><th>Pacote</th><th>Custo</th><th>Benef√≠cios</th></tr>`;
        dadosGerais.banco.forEach(i => { html += `<tr><td>${i.nome}</td><td class="preco-banco">${i.custo}</td><td>${i.desc}</td></tr>`; });
        html += `</table><h4 style="color:#ffdead; margin-top:20px;">Investimentos</h4><ul style="color:#ccc;">`;
        dadosGerais.investimentos.forEach(inv => { html += `<li><strong>${inv.nome}:</strong> ${inv.risco} (Min ${inv.min})</li>`; });
        container.innerHTML = html + `</ul>`;
    } else if (tipo === 'boatos') {
        titulo.innerText = "üó£Ô∏è Boatos";
        container.innerHTML = btnVoltar + `<div class="lista-boatos">`;
        dadosCapital.boatos.forEach(b => {
            const txt = b.descoberto ? b.texto : "??????????";
            container.innerHTML += `<div class="boato-item ${b.descoberto ? 'boato-descoberto' : ''}"><span class="boato-numero">#${b.id}</span><span class="boato-texto">"${txt}"</span></div>`;
        });
        container.innerHTML += `</div>`;
    } else if (tipo === 'historico') {
        titulo.innerText = "üìú Miss√µes & Relatos";
        container.innerHTML = btnVoltar;
        dadosCapital.historico.forEach((cap, idx) => {
            container.innerHTML += `<div class="item-menu" onclick="lerCapitulo(${idx})" style="cursor:pointer;"><div class="foto-placeholder" style="width:40px; height:40px;">üìñ</div><div class="texto-item"><h4>${cap.titulo}</h4></div></div>`;
        });
    }
}



/**
 * Exibe a grade de 12 deuses do pante√£o com seus t√≠tulos e dom√≠nios
 * Cada deus √© clic√°vel para ver sua imagem em fullscreen
 * Rastreia que menuAtualAberto = 'deuses' para navega√ß√£o de voltar
 */
    /**
 * Exibe grid de 12 deuses do panteao com dominios
 * Clique em deus: verImagemDeus(nome, foto, dominio)
 * Atualiza menuAtualAberto = 'deuses' para back button voltar corretamente
 * Grid responsivo: 3 colunas (desktop), 2 (tablet), 1 (mobile)
 */
function menuDeuses() {
        menuAtualAberto = 'deuses'; // Rastreia que o pante√£o est√° aberto (usado por verImagemDeus)
        const modal = document.getElementById('modal-capital');
        const container = document.getElementById('conteudo-menu-capital');
        const titulo = document.getElementById('titulo-menu-capital');
        modal.style.display = 'flex';
        
        titulo.innerText = "‚ö° Pante√£o dos 12 Deuses";
        let html = `<div class="grid-deuses">`;
        
        dadosGerais.deuses.forEach(deus => {
            // Se tiver foto, usa ela. Se n√£o, usa um placeholder cinza.
            const htmlImagem = deus.foto 
                ? `<img src="${deus.foto}" class="foto-deus-thumb">`
                : `<div class="foto-deus-thumb" style="background:#333; display:flex; align-items:center; justify-content:center;">?</div>`;

            // Adiciona o onclick enviando o arquivo da foto
            html += `
                <div class="item-deus" onclick="verImagemDeus('${deus.foto}')">
                    ${htmlImagem}
                    <span class="nome-deus">${deus.nome}</span>
                    <span class="desc-deus">${deus.titulo}</span>
                    <span class="dominio-deus">${deus.raca}</span>
                </div>`;
        });
        
        html += `</div>`;
        container.innerHTML = html;
    }
    // --- ESTRUTURA DE DADOS DAS CLASSES (HIERARQUIA) ---
// Edite as descri√ß√µes aqui. O sistema monta o menu sozinho baseado nisso.
const arvoreClasses = {
    "Feiticeiro": {
        desc: "Dominadores da magia bruta, focados em controle de campo e utilidade arcana.",
        icone: "üîÆ",
        proximoNivel: {
            "Invocador": { 
                desc: "Especialista em conjurar criaturas e esp√≠ritos de outros planos para lutar ao seu lado.",
                proximoNivel: { 
                    "Mestre Invocador": { desc: "Pode invocar m√∫ltiplas criaturas ou bestas colossais." },
                    "Espiritualista": { desc: "Foca em esp√≠ritos utilit√°rios e buffs para o grupo." }
                }
            },
            "Bruxo": { 
                desc: "Utiliza artes proibidas e pactos sombrios para debilitar inimigos.",
                proximoNivel: { 
                    "Necromante": { desc: "Reanima mortos e manipula energia vital." },
                    "Demonologista": { desc: "Pactos diretos com dem√¥nios para poder destrutivo." }
                }
            }
            // Adicione Feiticeiro Temporal aqui se quiser
        }
    },
    "Mago": {
        desc: "Estudiosos dedicados ao poder destrutivo dos elementos e da magia pura.",
        icone: "üî•",
        proximoNivel: {
            "Elementalista": {
                desc: "Foca na manipula√ß√£o dos quatro elementos b√°sicos para ataque.",
                proximoNivel: {
                    "Mestre do Fogo/Ar/√Ågua/Terra": { desc: "Especializa√ß√£o m√°xima em um √∫nico elemento." }
                }
            },
            "Mago Arcano": {
                desc: "Usa magia pura n√£o elementar e manipula√ß√£o de energia.",
                proximoNivel: {
                     "R√∫nico": { desc: "Usa runas antigas para preparar magias poderosas." }
                }
            }
        }
    },
    "Guerreiro": {
        desc: "Mestres do combate corpo a corpo, linha de frente e prote√ß√£o.",
        icone: "‚öîÔ∏è",
        proximoNivel: {
            "Paladino": { desc: "Guerreiro sagrado que usa f√© para proteger e curar.", proximoNivel: { "Anjo": {desc:"..."}, "Monge": {desc:"..."} } },
            "Cavaleiro das Trevas": { desc: "Usa a pr√≥pria vitalidade e √≥dio para aumentar o dano.", proximoNivel: { "Berserker": {desc:"..."}, "Cavaleiro Demon√≠aco": {desc:"..."} } }
        }
    }
    // Adicione Ca√ßador e Curandeiro seguindo a mesma l√≥gica...
};


function abrirBiblioteca() {
    const container = document.getElementById('conteudo-menu-capital');
    document.getElementById('titulo-menu-capital').innerText = "üìö Biblioteca";
    container.innerHTML = `
        <button onclick="menuCapital('hub')" class="btn-popup" style="margin-bottom: 15px; background: #444; width: 100%;">‚¨Ö Voltar ao Painel Imperial</button>
        <div class="biblio-nav">
            <div class="rpg-card-small" onclick="biblioRacas('menu')"><span>üß¨</span><strong>Ra√ßas</strong></div>
            <div class="rpg-card-small" onclick="biblioClasses('t1')"><span>‚öîÔ∏è</span><strong>Classes</strong></div>
            <div class="rpg-card-small" onclick="biblioAtributos()"><span>üìä</span><strong>Atributos</strong></div>
            <div class="rpg-card-small" onclick="biblioMagias('menu')"><span>‚ú®</span><strong>Magias & Hab.</strong></div>
        </div>`;
}

// --- RA√áAS COM DETALHES DE B√îNUS E HABILIDADES ---
// --- SISTEMA DE RA√áAS (DETALHADO E EM CARDS) ---
function biblioRacas(view) {
    const container = document.getElementById('conteudo-menu-capital');
    
    // Banco de Dados Completo das Ra√ßas
    const dadosRacas = {
        "Humanos": {
            emoji: "üë®",
            desc: "A maior parte da popula√ß√£o de Tarre √© humana, s√£o bons em se adaptar aos diversos climas e possuem resist√™ncia alta.",
            bonus: "<b>Atributos:</b> +1 em dois atributos √† escolha, +1 Carisma",
            hab: "<b>Ambi√ß√£o:</b> Uma vez por dia, pode escolher um teste de atributo e rolar o dado novamente, ficando com o melhor resultado."
        },
        "An√µes": {
            emoji: "‚öíÔ∏è",
            desc: "Vistos como corajosos e teimosos, al√©m de artes√£os proficientes em muitas √°reas.",
            bonus: "<b>Atributos:</b> +2 Constitui√ß√£o, +1 For√ßa, -1 Destreza",
            hab: "<b>Pele de a√ßo:</b> Uma vez por dia, reduz o dano de um ataque pela metade."
        },
        "Elfo Alto": {
            emoji: "‚ú®",
            desc: "Elfos evolu√≠dos em quesitos m√°gicos, s√£o conhecidos por seus costumes extremistas em rela√ß√£o √† heran√ßa de sangue, n√£o possuem uma imagem muito boa com as outras ra√ßas.",
            bonus: "<b>Atributos:</b> +2 Sabedoria, +1 Mana, -1 Carisma",
            hab: "<b>Medita√ß√£o:</b> Uma vez por dia, recupera 1d4 + N√≠vel de Mana instantaneamente."
        },
        "Elfo Negro": {
            emoji: "üåë",
            desc: "Prod√≠gios no uso de magia elementares, muitos possuem medo dos elfos negros por pensarem neles como m√°quinas de destrui√ß√£o ambulantes.",
            bonus: "<b>Atributos:</b> +2 Intelig√™ncia, +1 Mana, -1 Precis√£o",
            hab: "<b>Vontade Ardente:</b> Uma vez por dia, pode usar um ataque em √°rea de chamas que causa 2d6*N√≠vel + 1d4*N√≠vel por 2 turnos."
        },
        "Elfo da Floresta": {
            emoji: "üçÉ",
            desc: "Como todos os outros elfos, s√£o descendentes de esp√≠ritos, mas possuem uma conex√£o maior com esse lado espiritual, geralmente vivem livre pelas florestas do mundo sem interagir muito com outras ra√ßas. Possuem afinidade com os animais e plantas.",
            bonus: "<b>Atributos:</b> +2 Intelig√™ncia, +1 Mana, -1 For√ßa",
            hab: "<b>Conversa Natural:</b> Uma vez por dia, pode-se comunicar com elementos da natureza por um curto per√≠odo (quanto maior o n√≠vel maior o tempo)."
        },
        "Meio anjo": {
            emoji: "üëº",
            desc: "Carregam sangue humano misturado com sangue angelical, possuem alto poder m√°gico al√©m de um elevado pre√ßo no mercado de escravos. (N√£o possuem asas)",
            bonus: "<b>Atributos:</b> +1 Sabedoria, +1 Mana, +1 For√ßa, -1 Carisma",
            hab: "<b>Aura Protetora:</b> Uma vez por dia, pode usar seu sangue para purificar a si mesmo ou a um aliado, removendo estados negativos (Queimando, Doente, Veneno) e curando ¬º da vida."
        },
        "Meio dem√¥nio": {
            emoji: "üòà",
            desc: "Carregam sangue humano e demon√≠aco, possuem alto poder m√°gico al√©m de um elevado pre√ßo no mercado de escravos. Essa ra√ßa possui uma reputa√ß√£o ruim, pois, na grande maioria das vezes, n√£o √© um nascimento desejado.",
            bonus: "<b>Atributos:</b> +1 Intelig√™ncia, +1 For√ßa, -1 Carisma",
            hab: "<b>F√∫ria Demon√≠aca:</b> Entra em f√∫ria por (n+1) turnos (+2 For√ßa/Destreza, -2 Intelig√™ncia/Sabedoria/Precis√£o). Risco de atacar aliados."
        },
        "Bestiais / Mesti√ßos": {
            emoji: "üêæ",
            desc: "Uma ra√ßa envolta de preconceitos, apesar de terem alta capacidade f√≠sica, s√£o vistos como animais selvagens. S√£o uma mistura de humanos com atributos de animais (caudas, chifres, orelhas, patas).",
            bonus: "<b>Atributos:</b> +2 For√ßa, +1 Destreza, -1 Carisma",
            hab: "<b>Metamorfose Selvagem:</b> Uma vez por dia, transforma-se no seu animal de origem por (n+1) turnos. Ganha vantagem em testes f√≠sicos e ataque de mordida/garra."
        },
        "Machinas": {
            emoji: "ü§ñ",
            desc: "Uma ra√ßa antiga, nenhum machina √© visto h√° centenas de anos, n√£o se sabe muito sobre essa ra√ßa. √â uma mistura de humano com m√°quinas (tipo um ciborgue).",
            bonus: "<b>Atributos:</b> +2 Mana, +1 Sabedoria, -1 For√ßa",
            hab: "<b>An√°lise de Mat√©ria:</b> Uma vez por dia, pode analisar qualquer objeto ou pessoa para descobrir propriedades m√°gicas, fraquezas ou utilidades escondidas."
        },
        "Orc": {
            emoji: "üëπ",
            desc: "Possuem alta capacidade f√≠sica, mas tem capacidade intelectual diminuta e p√©ssimos com magia.",
            bonus: "<b>Atributos:</b> +3 For√ßa e -1 Intelig√™ncia",
            hab: "<b>√öltimo Esfor√ßo:</b> Se sua vida cair para 0, voc√™ pode realizar um ataque imediato com +4 de b√¥nus no dano antes de cair inconsciente."
        },
        "Asura": {
            emoji: "üê≠",
            desc: "Uma ra√ßa antiga e quase extinta de um povo muito inteligente. Seres humanoides de quase 1 metro de altura que parecem um rato sem pelo.",
            bonus: "<b>Atributos:</b> +3 Intelig√™ncia e -1 For√ßa",
            hab: "<b>Rede de Conhecimento:</b> Acessa a consci√™ncia coletiva para descobrir uma informa√ß√£o hist√≥rica, fraqueza de monstro ou solu√ß√£o de puzzle."
        }
    };

    if (view === 'menu') {
        document.getElementById('titulo-menu-capital').innerText = "üß¨ Ra√ßas";
        container.innerHTML = `<button onclick="abrirBiblioteca()" class="btn-popup" style="margin-bottom:15px; background:#444; width:100%;">‚¨Ö Voltar</button>
        <div class="biblio-nav">
            <div class="rpg-card-small" onclick="biblioRacas('Humanos')"><span>üë®</span><strong>Humanos</strong></div>
            <div class="rpg-card-small" onclick="biblioRacas('An√µes')"><span>‚öíÔ∏è</span><strong>An√µes</strong></div>
            <div class="rpg-card-small" onclick="biblioRacas('elfos')" style="border-style:dashed; border-color:#2e8b57;"><span>üßù</span><strong>Elfos</strong></div>
            <div class="rpg-card-small" onclick="biblioRacas('Meio anjo')"><span>üëº</span><strong>M. Anjo</strong></div>
            <div class="rpg-card-small" onclick="biblioRacas('Bestiais / Mesti√ßos')"><span>üêæ</span><strong>Bestiais</strong></div>
            <div class="rpg-card-small" onclick="biblioRacas('Machinas')"><span>ü§ñ</span><strong>Machinas</strong></div>
            <div class="rpg-card-small" onclick="biblioRacas('Orc')"><span>üëπ</span><strong>Orc</strong></div>
            <div class="rpg-card-small" onclick="biblioRacas('Meio dem√¥nio')"><span>üòà</span><strong>M. Dem√¥nio</strong></div>
            <div class="rpg-card-small" onclick="biblioRacas('Asura')"><span>üê≠</span><strong>Asura</strong></div>
        </div>`;
    } 
    else if (view === 'elfos') {
        document.getElementById('titulo-menu-capital').innerText = "üßù Grupo: Elfos";
        container.innerHTML = `<button onclick="biblioRacas('menu')" class="btn-popup" style="margin-bottom:15px; background:#444; width:100%;">‚¨Ö Voltar</button>
        <div class="biblio-nav">
            <div class="rpg-card-small" onclick="biblioRacas('Elfo Alto')"><span>‚ú®</span><strong>Elfo Alto</strong></div>
            <div class="rpg-card-small" onclick="biblioRacas('Elfo Negro')"><span>üåë</span><strong>Elfo Negro</strong></div>
            <div class="rpg-card-small" onclick="biblioRacas('Elfo da Floresta')"><span>üçÉ</span><strong>Elfo Floresta</strong></div>
        </div>`;
    } 
    else {
        // TELA DE DETALHE FINAL
        const r = dadosRacas[view];
        document.getElementById('titulo-menu-capital').innerText = view;
        const voltarPara = view.includes('Elfo') ? 'elfos' : 'menu';

        container.innerHTML = `<button onclick="biblioRacas('${voltarPara}')" class="btn-popup" style="margin-bottom:15px; background:#444; width:100%;">‚¨Ö Voltar</button>
        <div class="detalhe-box">
            <h3>${r.emoji} ${view}</h3>
            <p>${r.desc}</p>
            <hr style="border:0; border-top:1px solid #555; margin:15px 0;">
            <p style="color:#ffd700;">${r.bonus}</p>
            <p style="color:#90EE90;">${r.hab}</p>
        </div>`;
    }
}

// --- MAGIAS E HABILIDADES (DRILL-DOWN POR CLASSE) ---
function biblioMagias(view) {
    const container = document.getElementById('conteudo-menu-capital');
    if (view === 'menu') {
        container.innerHTML = `<button onclick="abrirBiblioteca()" class="btn-popup" style="margin-bottom:15px; background:#444; width:100%;">‚¨Ö Voltar</button>
        <div class="biblio-nav">
            <div class="rpg-card-small" onclick="biblioMagias('Mago')"><span>üî•</span><strong>Mago</strong></div>
            <div class="rpg-card-small" onclick="biblioMagias('Curandeiro')"><span>üíñ</span><strong>Curandeiro</strong></div>
            <div class="rpg-card-small" onclick="biblioMagias('Guerreiro')"><span>üõ°Ô∏è</span><strong>Guerreiro</strong></div>
            <div class="rpg-card-small" onclick="biblioMagias('Ca√ßador')"><span>üèπ</span><strong>Ca√ßador</strong></div>
        </div>`;
    } else {
        container.innerHTML = `<button onclick="biblioMagias('menu')" class="btn-popup" style="margin-bottom:15px; background:#444; width:100%;">‚¨Ö Voltar</button>
        <div id="lista-magias-classe"></div>`;
        renderizarMagias(view);
    }
}

function renderizarMagias(classe) {
    const div = document.getElementById('lista-magias-classe');
    const term = (classe === 'Guerreiro' || classe === 'Ca√ßador') ? "Habilidades" : "Magias";
    let html = `<h3 style="color:#ffd700; text-align:center; border-bottom:1px solid #444; padding-bottom:10px;">${term} de ${classe}</h3>`;

    if (classe === 'Mago') {
        html += `
            <div class="spell-level">‚ú® Habilidades Passivas</div>
            <div class="spell-item"><b>Eco de Mana:</b> Sempre que conjurar uma magia de N√≠vel 1+ e tirar dano m√°ximo, recupera 1 Mana instantaneamente.</div>
            <div class="spell-item"><b>Resist√™ncia M√°gica:</b> Recebe redu√ß√£o permanente de -2 em qualquer dano de origem m√°gica.</div>
            <div class="spell-item"><b>Conhecimento das Eras:</b> Ganha +3 em todos os testes de Hist√≥ria, Arcanismo e Investiga√ß√£o.</div>

            <div class="spell-level">üåü N√≠vel 0 (0 Mana)</div>
            <div class="spell-item"><b>Luz:</b> Cria uma fonte de luz.</div>
            <div class="spell-item"><b>Prestidigita√ß√£o:</b> Realiza pequenos truques e efeitos menores.</div>
            <div class="spell-item"><b>Globos de Luz:</b> Cria esferas luminosas para iluminar o caminho.</div>
            <div class="spell-item"><b>Detectar Magia Menor:</b> Sente a presen√ßa de magias fracas no ambiente.</div>
            <div class="spell-item"><b>Chama Cont√≠nua:</b> Cria uma pequena chama (1d4 de dano) e aplica o estado queimando.</div>
            <div class="spell-item"><b>Sentir Aura:</b> Permite sentir a aura e a mana do alvo.</div>
            <div class="spell-item"><b>Ilus√£o Menor:</b> Cria uma ilus√£o pequena de imagem ou som.</div>
            <div class="spell-item"><b>M√£o Arcana:</b> M√£o m√°gica flutuante que manipula objetos a curta dist√¢ncia.</div>

            <div class="spell-level">üî∂ N√≠vel 1 (1 Mana)</div>
            <div class="spell-item"><b>Raio Pequeno:</b> Causa 2d4 de dano.</div>
            <div class="spell-item"><b>Bola de Fogo Menor:</b> Causa 1d6 de dano e aplica o estado queimando.</div>
            <div class="spell-item"><b>Espirro √Åcido:</b> Lan√ßa um jato que causa 2d4 de dano perfurante.</div>
            <div class="spell-item"><b>Raio Adoecente:</b> Causa 1d6 de dano e adoece o alvo por 2 turnos.</div>
            <div class="spell-item"><b>Teia:</b> Cria uma teia que prende os advers√°rios.</div>
            <div class="spell-item"><b>Concentra√ß√£o:</b> Melhora o pr√≥ximo ataque do usu√°rio em +2d6.</div>
            <div class="spell-item"><b>Prote√ß√£o contra L√¢minas:</b> Escudo que diminui danos de l√¢minas em 3 por 2 turnos.</div>

            <div class="spell-level">üî∑ N√≠vel 2 (2 Mana)</div>
            <div class="spell-item"><b>Raio Congelante:</b> Causa 2d4 de dano e congela o inimigo por 1d2 turnos.</div>
            <div class="spell-item"><b>M√≠ssil Arcano:</b> Tr√™s proj√©teis de energia que nunca erram, causando 1d4 cada.</div>
            <div class="spell-item"><b>Escudo de Mana:</b> Barreira que absorve 3d6 de dano por 1d2 turnos.</div>`;
    } 
    else if (classe === 'Curandeiro') {
        html += `
            <div class="spell-level">üôè Habilidades Passivas</div>
            <div class="spell-item"><b>Aura de Tranquilidade:</b> Aliados (3m) recebem +2 contra estados "Aterrorizado", "Adoecido" ou venenos.</div>
            <div class="spell-item"><b>Ajuda aos Necessitados:</b> Curas em aliados com menos de metade da vida recuperam +3 de vida adicional.</div>
            <div class="spell-item"><b>Olhar Cl√≠nico:</b> Enxerga o HP (%) e identifica condi√ß√µes negativas instantaneamente sem testes.</div>

            <div class="spell-level">üåü N√≠vel 0 (0 Mana)</div>
            <div class="spell-item"><b>Luz:</b> Cria luz.</div>
            <div class="spell-item"><b>Quebrar Maldi√ß√£o Menor:</b> Remove maldi√ß√µes fracas.</div>
            <div class="spell-item"><b>B√™n√ß√£o de For√ßa:</b> Melhora os atributos do alvo em +1 For√ßa por 1d4 turnos.</div>
            <div class="spell-item"><b>Cura Menor:</b> Cura 1d6 de vida de um alvo.</div>
            <div class="spell-item"><b>Detectar Magia Menor:</b> Sente a presen√ßa de magias fracas no ambiente.</div>

            <div class="spell-level">üíö N√≠vel 1 (1 Mana)</div>
            <div class="spell-item"><b>Curar Ferimentos:</b> Cura aliados vis√≠veis em 2d4 de vida.</div>
            <div class="spell-item"><b>Regenera√ß√£o:</b> O alvo recupera 1d4 de vida por round (3 rounds).</div>
            <div class="spell-item"><b>Tiro de Luz:</b> Atira um proj√©til de luz que causa 2d4 de dano.</div>
            <div class="spell-item"><b>Solo Sagrado:</b> Cura ferimentos de aliados em √°rea pequena em 1d6 de vida.</div>
            <div class="spell-item"><b>Palavra de Cura:</b> Cura ferimentos de aliados a curta dist√¢ncia em 2d6 de vida.</div>

            <div class="spell-level">üí† N√≠vel 2 (2 Mana)</div>
            <div class="spell-item"><b>Fechar Ferimentos:</b> Cura ferimentos de aliados vis√≠veis em 2d6 de vida.</div>
            <div class="spell-item"><b>Escudo Sagrado:</b> Concede escudo reduzindo 2 de dano e dando 2d4 de vida extra pelo combate.</div>
            <div class="spell-item"><b>C√≠rculo de Luz:</b> √Årea que ilumina, afasta mortos-vivos e cura 1d6 de vida por 1d4 turnos.</div>
            <div class="spell-item"><b>B√™n√ß√£o Intermedi√°ria:</b> Melhora atributos de um alvo em +2 por 1d4 turnos.</div>`;
    }
    else if (classe === 'Guerreiro') {
        html += `
            <div class="spell-level">‚öîÔ∏è Habilidades Passivas</div>
            <div class="spell-item"><b>For√ßa de Vontade:</b> Com menos de metade da vida, recebe +2 em testes de resist√™ncia f√≠sica.</div>
            <div class="spell-item"><b>Empolga√ß√£o:</b> A partir do seu 3¬∫ turno em combate, ganha +2 em for√ßa.</div>
            <div class="spell-item"><b>Casca Grossa:</b> Recebe uma redu√ß√£o permanente de -1 em todo dano f√≠sico recebido.</div>
            <div class="spell-item"><b>M√°rtir:</b> Pode absorver 2 de dano de um aliado (5m) para si mesmo automaticamente.</div>

            <div class="spell-level">üõ°Ô∏è Habilidades Ativas (5 Usos por Dia)</div>
            <div class="spell-item"><b>Corte Perfurante:</b> Estocada que causa o dano da arma e ignora 2 de armadura f√≠sica.</div>
            <div class="spell-item"><b>Grito de Desafio:</b> Rugido que for√ßa inimigos pr√≥ximos a focar ataques no Guerreiro.</div>
            <div class="spell-item"><b>Postura Defensiva:</b> Reduz todo dano f√≠sico em 4 at√© o pr√≥ximo turno, mas fica im√≥vel.</div>
            <div class="spell-item"><b>Corte Meteoro:</b> Corte em longa dist√¢ncia causando o dano da arma.</div>
            <div class="spell-item"><b>Investida Impactante:</b> Ombrada (1d6) com teste de resist√™ncia: chance de empurrar e atordoar.</div>
            <div class="spell-item"><b>F√¥lego Renovado:</b> Respira fundo e recupera 1d8 de vida no combate.</div>
            <div class="spell-item"><b>Impacto S√≠smico:</b> Bate arma/escudo no ch√£o, for√ßando inimigos pequenos ao redor a recuar.</div>
            <div class="spell-item"><b>Desarmar:</b> Teste de For√ßa para fazer a arma do inimigo voar para longe.</div>`;
    }
    else if (classe === 'Ca√ßador') {
        html += `
            <div class="spell-level">üåø Habilidades Passivas</div>
            <div class="spell-item"><b>Rastrear:</b> Vantagem em testes de percep√ß√£o para pegadas, cheiros ou sons.</div>
            <div class="spell-item"><b>Armadilheiro:</b> Vantagem em testes para detectar ou montar armadilhas.</div>
            <div class="spell-item"><b>Camuflagem:</b> Ganha +2 em testes para se esconder.</div>
            <div class="spell-item"><b>Sobrevivente:</b> Imune a penalidades de terrenos dif√≠ceis e recebe -2 dano de climas extremos.</div>
            <div class="spell-item"><b>Sentido de Perigo:</b> +2 em Iniciativa e nunca pode ser surpreendido enquanto acordado.</div>

            <div class="spell-level">üèπ Habilidades Ativas (5 Usos por Dia)</div>
            <div class="spell-item"><b>Tiro Triplo:</b> Tr√™s disparos r√°pidos. Cada acerto (teste de Precis√£o) causa 1d6.</div>
            <div class="spell-item"><b>Foco do Predador:</b> Mira intensa; pr√≥ximo ataque ignora dist√¢ncia e ganha +3 na Precis√£o.</div>
            <div class="spell-item"><b>Salto Acrob√°tico:</b> Move-se metade do deslocamento sem sofrer ataques e ganha +2 Destreza no turno.</div>
            <div class="spell-item"><b>Bomba de Fuma√ßa:</b> Produz 2 bombas que criam cortina de fuma√ßa em √°rea mediana (1 turno).</div>
            <div class="spell-item"><b>Tiro Marcador:</b> Marca o alvo para que o pr√≥ximo ataque cause +2d4 de dano.</div>`;
    }

    div.innerHTML = html;
}

// --- ATRIBUTOS (Texto resumido e Tabela ordenada) ---
function biblioAtributos() {
    const container = document.getElementById('conteudo-menu-capital');
    container.innerHTML = `<button onclick="abrirBiblioteca()" class="btn-popup" style="margin-bottom:15px; background:#444; width:100%;">‚¨Ö Voltar</button>
        <div class="grid-atributos">
            <div class="card-atributo"><strong>üí™ For√ßa</strong><span>F√≠sico</span></div>
            <div class="card-atributo"><strong>üìñ Sabedoria</strong><span>Conhecimento</span></div>
            <div class="card-atributo"><strong>üß† Intelig.</strong><span>Mental</span></div>
            <div class="card-atributo"><strong>‚ú® Mana</strong><span>Quantidade</span></div>
            <div class="card-atributo"><strong>‚ö° Destreza</strong><span>Agilidade</span></div>
            <div class="card-atributo"><strong>üõ°Ô∏è Const.</strong><span>Vida</span></div>
            <div class="card-atributo"><strong>üéØ Precis√£o</strong><span>Precis√£o</span></div>
            <div class="card-atributo"><strong>üó£Ô∏è Carisma</strong><span>Persuas√£o</span></div>
        </div>
        <h4 style="color:#ffd700; margin-top:20px; text-align:center;">üé≤ Tabela de B√¥nus</h4>
        <table class="tabela-banco" style="font-size:12px; width: 100%;">
            <tr><th>Pontos</th><th>B√¥nus</th><th>Pontos</th><th>B√¥nus</th></tr>
            <tr><td>0</td><td style="color:#ff4444;">-2</td><td>4 - 5</td><td style="color:#2ecc71;">+2</td></tr>
            <tr><td>1</td><td style="color:#ff7777;">-1</td><td>6 - 7</td><td style="color:#2ecc71;">+3</td></tr>
            <tr><td>2</td><td>0</td><td>8-9-10</td><td style="color:#ffd700;">+4</td></tr>
            <tr><td>3</td><td style="color:#90EE90;">+1</td><td>11+</td><td style="color:#ffd700;">+5</td></tr>
        </table>`;
}


const classesRPG = {
    "Feiticeiro": {
        emoji: "üîÆ",
        desc: "Possuem habilidades de controle e utilidade, uma classe que consegue se adaptar em diversas situa√ß√µes.",
        proximas: {
            "Invocador": { 
                emoji: "üßû", desc: "Utiliza magias m√≠sticas para invocar criaturas que lutam ao seu lado ou defendem a equipe.",
                final: { 
                    "Mestre Invocador": { emoji: "üêâ", desc: "Passa a invocar criaturas mais poderosas por rituais que duram dias." },
                    "Espiritualista": { emoji: "üëª", desc: "Ganha uma conex√£o espiritual para invocar esp√≠ritos poderosos por curto per√≠odo." }
                }
            },
            "Bruxo": { 
                emoji: "üíÄ", desc: "Utiliza magia negra para enfraquecer, envenenar e amaldi√ßoar seus oponentes.",
                final: { 
                    "Necromante": { emoji: "üßü", desc: "Aprende a fazer com que criaturas mortas voltem √† vida para ajudar." },
                    "Demonologista": { emoji: "üëπ", desc: "Aumenta sua liga√ß√£o com o mundo inferior para feiti√ßos demon√≠acos intensos." }
                }
            },
            "Feiticeiro Temporal": { 
                emoji: "‚è≥", desc: "Usa de poderes estranhos para controlar o tempo a sua volta (n√£o volta no tempo).",
                final: { 
                    "Temporalista": { emoji: "üåÄ", desc: "Maximiza seus poderes temporais ao n√≠vel mais elevado." },
                    "Dimensionalista": { emoji: "üåå", desc: "Controla o espa√ßo, criando fendas dimensionais e alterando a mat√©ria." }
                }
            }
        }
    },
    "Mago": {
        emoji: "üî•",
        desc: "Possuem, principalmente, habilidades de ataque, sem deixar de lado truques importantes.",
        proximas: {
            "Elementalista": { 
                emoji: "üå™Ô∏è", desc: "Consegue extrair o poder da natureza, usando magias dos elementos.",
                final: { 
                    "Mestre do Fogo": { emoji: "üî•", desc: "O mago extrai o poder puro do fogo, controlando-o e seus derivados." },
                    "Mestre do Ar": { emoji: "üí®", desc: "O mago extrai o poder puro do ar, controlando-o e seus derivados." },
                    "Mestre da √Ågua": { emoji: "üåä", desc: "O mago extrai o poder puro da √°gua, controlando-a e seus derivados." },
                    "Mestre da Terra": { emoji: "‚õ∞Ô∏è", desc: "O mago extrai o poder puro da terra, controlando-a e seus derivados." }
                }
            },
            "Mago Arcano": { 
                emoji: "üìñ", desc: "Estudiosos da magia pura, manipulam as leis do mundo atrav√©s da for√ßa da mente.",
                final: { "R√∫nico": { emoji: "üìú", desc: "Usa poderes de escritas antigas para feiti√ßos complexos bem poderosos." } }
            },
            "Mago de Combate": { 
                emoji: "üëä", desc: "Especialista em combates m√°gicos corpo a corpo e m√©dia dist√¢ncia.",
                final: { "Mago de Combate Especializado": { emoji: "‚öîÔ∏è", desc: "Escolhe um estilo de luta para se especializar com t√©cnicas especiais." } }
            }
        }
    },
    "Ca√ßador": {
        emoji: "üèπ",
        desc: "Utilizam de facas e arcos para derrotar oponentes. Classe vers√°til para confronto ou furtividade.",
        proximas: {
            "Arqueiro": { 
                emoji: "üéØ", desc: "Foca no arco, aprendendo t√©cnicas que combinam magia e precis√£o.",
                final: { 
                    "Sniper": { emoji: "üî≠", desc: "Vis√£o melhorada para ver a grandes dist√¢ncias. Dano aumenta com a dist√¢ncia." },
                    "Atirador de Elite": { emoji: "üî´", desc: "Invoca armas de fogo e tecnologias de uma civiliza√ß√£o tecnol√≥gica antiga." },
                    "Mestre Arqueiro": { emoji: "üèπ", desc: "Armazenamento de flechas variadas para qualquer situa√ß√£o de combate." }
                }
            },
            "Assassino": { 
                emoji: "üó°Ô∏è", desc: "Utiliza adagas e venenos para permanecer oculto at√© o momento oportuno.",
                final: { 
                    "Ceifador": { emoji: "‚ö∞Ô∏è", desc: "Maneja corrente e foice, trabalhando para um deus √† sua escolha." },
                    "Sombra": { emoji: "üë•", desc: "Evolui as t√©cnicas de oculta√ß√£o para se esconder facilmente de qualquer um." }
                }
            },
            "Druida": { 
                emoji: "üåø", desc: "Utiliza conhecimentos da natureza para aprender magias e curas.",
                final: { "Druida (reencarnado)": { emoji: "ü¶Ñ", desc: "Torna-se um com a natureza, reencarnando em uma classe selvagem m√≠stica." } }
            }
        }
    },
    "Guerreiro": {
        emoji: "üõ°Ô∏è",
        desc: "Consegue utilizar espadas e escudos para causar grande dano e suportar ataques.",
        proximas: {
            "Paladino": { 
                emoji: "‚öñÔ∏è", desc: "Recebe o dom m√°gico de um deus sem abandonar suas t√©cnicas de esgrima.",
                final: { 
                    "Anjo": { emoji: "üëº", desc: "Ganha dons e gra√ßa divina, tornando-se quase um anjo verdadeiro." },
                    "Monge": { emoji: "üßò", desc: "Abandona seu deus mas segue o caminho da bondade e resist√™ncia elemental." }
                }
            },
            "Cavaleiro das Trevas": { 
                emoji: "üåë", desc: "Cavaleiro movido por magia negra que ganha poder ao causar dano e matar.",
                final: { 
                    "Cavaleiro Demon√≠aco": { emoji: "üòà", desc: "Adquire poderes de mestre, acessando magias perdidas do submundo." },
                    "Berserker": { emoji: "üí¢", desc: "Focado em dano extremamente alto e resist√™ncia. Mais forte quanto mais apanha." }
                }
            },
            "Guerreiro Arcano": { 
                emoji: "‚öîÔ∏è‚ú®", desc: "Combina as t√©cnicas de magia arcana com suas habilidades de esgrima.",
                final: { "Veterano": { emoji: "üéñÔ∏è", desc: "Mestre em todos os tipos de armas, podendo melhor√°-las e usar feiti√ßos extras." } }
            }
        }
    },
    "Curandeiro": {
        emoji: "üíñ",
        desc: "Utilizam poderes divinos para curar aliados. Classe essencial para sobreviv√™ncia em combate.",
        proximas: {
            "Sacerdote": { 
                emoji: "‚òÄÔ∏è", desc: "Caminho da ilumina√ß√£o para aben√ßoar aliados e destruir mortos-vivos.",
                final: { 
                    "Anjo": { emoji: "üòá", desc: "Ganha dons do seu deus e a gra√ßa divina, tornando-se quase um anjo." },
                    "Vampiro": { emoji: "üßõ", desc: "Amaldi√ßoado pela noite; o sol causa dano e necessita de sangue para viver." }
                }
            },
            "Encantador": { 
                emoji: "‚ú®", desc: "Mestre em buffs e debuffs, encantando itens para terem poderes estranhos.",
                final: { "Mestre Encantador": { emoji: "üíé", desc: "Modifica magias e itens, criando ou destruindo itens m√°gicos e maldi√ß√µes." } }
            },
            "Bardo": { 
                emoji: "üéµ", desc: "Habilidades musicais de cura, utilidade e suporte.",
                final: { "Estrela": { emoji: "üåü", desc: "Ganha habilidades c√≥smicas. Canto e fala tornam-se mecanismos de magia." } }
            }
        }
    }
};

function biblioClasses(tier, c1 = null, c2 = null) {
    const container = document.getElementById('conteudo-menu-capital');
    const titulo = document.getElementById('titulo-menu-capital');
    
    if (tier === 't1') {
        titulo.innerText = "Classes Iniciais";
        container.innerHTML = `<button onclick="abrirBiblioteca()" class="btn-popup" style="margin-bottom:15px; background:#444; width:100%;">‚¨Ö Voltar</button>
            <div class="biblio-nav">
                ${Object.keys(classesRPG).map(c => `
                    <div class="rpg-card-small" onclick="biblioClasses('t2', '${c}')">
                        <span>${classesRPG[c].emoji}</span>
                        <strong>${c}</strong>
                    </div>`).join('')}
            </div>`;
    } 
    else if (tier === 't2') {
        titulo.innerText = `Evolu√ß√µes de ${c1}`;
        container.innerHTML = `<button onclick="biblioClasses('t1')" class="btn-popup" style="margin-bottom:15px; background:#444; width:100%;">‚¨Ö Voltar</button>
            <div class="detalhe-box">
                <h3>${classesRPG[c1].emoji} ${c1}</h3>
                <p>${classesRPG[c1].desc}</p>
            </div>
            <h4 style="text-align:center; color:#ffd700; margin: 15px 0;">‚ñº Escolha a 2¬™ Classe ‚ñº</h4>
            <div class="biblio-nav">
                ${Object.keys(classesRPG[c1].proximas).map(c => `
                    <div class="rpg-card-small" onclick="biblioClasses('t3', '${c1}', '${c}')">
                        <span>${classesRPG[c1].proximas[c].emoji}</span>
                        <strong>${c}</strong>
                    </div>`).join('')}
            </div>`;
    } 
    else if (tier === 't3') {
        titulo.innerText = `Especializa√ß√µes de ${c2}`;
        const classeT2 = classesRPG[c1].proximas[c2];
        container.innerHTML = `<button onclick="biblioClasses('t2', '${c1}')" class="btn-popup" style="margin-bottom:15px; background:#444; width:100%;">‚¨Ö Voltar</button>
            <div class="detalhe-box">
                <h3>${classeT2.emoji} ${c2}</h3>
                <p>${classeT2.desc}</p>
            </div>
            <h4 style="text-align:center; color:#00ffff; margin: 15px 0;">‚ñº Escolha a 3¬™ Classe ‚ñº</h4>
            <div class="biblio-nav">
                ${Object.keys(classeT2.final).map(c => `
                    <div class="rpg-card-small" onclick="biblioClasses('t4', '${c1}', '${c2}', '${c}')">
                        <span>${classeT2.final[c].emoji}</span>
                        <strong>${c}</strong>
                    </div>`).join('')}
            </div>`;
    } 
    else if (tier === 't4') {
        const c3 = arguments[3];
        const dadosC3 = classesRPG[c1].proximas[c2].final[c3];
        titulo.innerText = c3;
        container.innerHTML = `<button onclick="biblioClasses('t3', '${c1}', '${c2}')" class="btn-popup" style="margin-bottom:15px; background:#444; width:100%;">‚¨Ö Voltar</button>
            <div class="detalhe-box">
                <h3>${dadosC3.emoji} ${c3}</h3>
                <p>${dadosC3.desc}</p>
            </div>`;
    }
}

/**
 * Exibe o conte√∫do completo de um cap√≠tulo do hist√≥rico
 * Inclui bot√£o para voltar √† lista de cap√≠tulos
 * Fotos dentro do texto s√£o clic√°veis (onclick verImagemHistoria)
 * @param {number} index - √çndice do cap√≠tulo em dadosCapital.historico
 */
function lerCapitulo(index) {
    const container = document.getElementById('conteudo-menu-capital');
    const cap = dadosCapital.historico[index];
    
    // Bot√£o para voltar √† LISTA de cap√≠tulos (n√£o ao Hub direto)
    let html = `<button onclick="menuCapital('historico')" class="btn-popup" style="margin-bottom: 15px; background: #444; width: 100%;">‚¨Ö Voltar √† Lista de Cap√≠tulos</button>`;
    
    html += `<h3 style="color: #ffdead; border-bottom: 1px dashed #555; padding-bottom: 10px;">${cap.titulo}</h3>`;
    html += `<div class="texto-capitulo">${cap.texto}</div>`;
    
    container.innerHTML = html;
}

/**
 * Exibe foto do deus em fullscreen e volta para o pante√£o ao clicar voltar
 * Chamada por: onclick em cada deus na grade de menuDeuses()
 * @param {string} arquivo - Nome do arquivo PNG do deus
 */
function verImagemDeus(arquivo) {
    verImagemEstatica(arquivo, function() {
        restaurarMapaMenu(); // Volta mapa e menu
        menuDeuses(); // Reabre a grade de deuses
    });
}

/**
 * Exibe foto de personagem/criatura em fullscreen
 * Volta para o menu espec√≠fico que estava aberto (rastreado em menuAtualAberto)
 * Funciona para: besti√°rio, esquadr√£o, procurados
 * @param {string} arquivo - Nome do arquivo PNG da foto
 */
function verImagemPersonagem(arquivo) {
    // Abre a imagem e define um bilhete de volta personalizado
    verImagemEstatica(arquivo, function() {
        restaurarMapaMenu(); // Reexibe mapa e menu lateral
        document.getElementById('modal-capital').style.display = 'flex'; // Reabre o modal
        
        // Volta para a aba espec√≠fica que estava aberta (Ex: 'bestiario')
        if (menuAtualAberto) {
            menuCapital(menuAtualAberto);
        } else {
            menuCapital('hub'); // Fallback caso perca o estado
        }
    });
}
/**
 * Exibe foto linkada dentro de um cap√≠tulo do hist√≥rico em fullscreen
 * Volta para o mesmo cap√≠tulo ap√≥s fechar a imagem
 * Fotos s√£o embarcadas no texto com onclick="verImagemHistoria('arquivo.png', index)"
 * @param {string} arquivo - Nome do arquivo PNG da foto
 * @param {number} capituloIndex - √çndice do cap√≠tulo para voltar para ele
 */
function verImagemHistoria(arquivo, capituloIndex) {
    verImagemEstatica(arquivo, function() {
        restaurarMapaMenu(); // Volta mapa e menu
        document.getElementById('modal-capital').style.display = 'flex'; // Reabre o overlay
        lerCapitulo(capituloIndex); // Volta para o texto exato do cap√≠tulo
    });
}
/**
 * Centraliza a restaura√ß√£o visual ap√≥s fechar visualiza√ß√£o de imagem fullscreen
 * Oculta o container de imagem e reexibe o mapa + menu
 * @param {object} options - { restoreMenuIfContinent: bool } - Se true, s√≥ mostra menu no continente
 * Usado por: verImagemPersonagem, verImagemHistoria, verImagemDeus, etc
 */
    function restaurarMapaMenu(options = {}) {
        const container = document.getElementById('provincia-container');
        const mapa = document.getElementById('map-container');
        const menu = document.getElementById('menu-provincias');

        if (container) container.style.display = 'none';
        if (mapa) mapa.style.display = 'block';

        if (options.restoreMenuIfContinent) {
            if (mapaAtualAtivo === 'continente') {
                if (menu) menu.style.display = 'block';
            }
        } else {
            if (menu) menu.style.display = 'block';
        }
    }

/**
 * Fecha TODOS os modais ativos (info, capital, senha, viagem)
 * Chamado antes de exibir novo modal para evitar sobreposi√ß√£o
 * N√£o reseta menu-provincias (navegaci√£o independente)
 * window.fecharModalInfo apontado para essa fun√ß√£o garante compatibilidade com onclick HTML
 */
function fecharModais() { 
        document.getElementById('modal-info').style.display = 'none';
        document.getElementById('modal-capital').style.display = 'none';
    }
    
    // TRUQUE: Isso garante que se o HTML chamar 'fecharModalInfo', ele usa a nova fun√ß√£o
    window.fecharModalInfo = fecharModais;

/**
 * Abre modal de detalhes com conte√∫do inteligente baseado no mapa atual
 * - Se em Planos.jpg e clicou em marcador: mostra descri√ß√£o do plano (divino, demon√≠aco, etc)
 * - Se em Planos.jpg sem clique: mostra resumo geral do Nexus
 * - Se em outra prov√≠ncia: mostra descricao de dadosProvincias
 */
    function abrirModalInfo() {
        let dados;

        // 1. Se estiver no mapa dos Planos E tiver clicado em um marcador (Divino, Mortal, etc)
        if (mapaAtualAtivo === 'Planos.jpg' && selecaoAtual) {
            dados = textosPlanos[selecaoAtual]; 
        } 
        // 2. Se estiver no mapa dos Planos mas n√£o clicou em nada (Mostra resumo geral)
        else if (mapaAtualAtivo === 'Planos.jpg') {
            dados = dadosProvincias['Planos.jpg'];
        }
        // 3. Comportamento padr√£o para os outros mapas (Hukmal'tep, Deserto, etc)
        else {
            dados = dadosProvincias[mapaAtualAtivo] || dadosProvincias['default'];
        }

        // Abre o modal com os dados certos
        if (dados) {
            document.getElementById('titulo-provincia').innerHTML = dados.titulo;
            document.getElementById('texto-provincia').innerHTML = dados.texto || dados.descricao;
            document.getElementById('modal-info').style.display = 'flex';
        }
    }


/**
 * CONFIGURA√á√ïES DE SUBMAPAS - Planos e Regi√µes Especiais
 * Define tamanho (pixels) e zoom para cada mapa cosmol√≥gico
 */
    // O Mapa Geral dos Planos (O Nexus central)
    const configPlanos = { largura: 741, altura: 1024, minZoom: -1.0, maxZoom: 3 }; 
    
    // Os Mapas Individuais dos Planos (Divino, Demon√≠aco, Espiritual)
    const configSubPlanos = { largura: 1024, altura: 1536, minZoom: -1.0, maxZoom: 3 }; 

/**
 * Carrega um novo mapa (prov√≠ncia ou plano) com seus marcadores espec√≠ficos
 * Ajusta automaticamente: escala, tamanho, bot√£o de voltar din√¢mico
 * Limpa rota anterior e coordenadas para evitar persist√™ncia
 * Atualiza menu lateral conforme o tipo de mapa
 * @param {string} arquivo - Nome do arquivo PNG (ex: 'Lago.jpg', 'Plano Divino.png')
 */
function abrirMapaProvincia(arquivo) {
    mapaAtualAtivo = arquivo;
    
    // --- LIMPEZA DE ROTA ---
    if (medindo) cancelarModoMedicao();
    grupoRota.clearLayers();
    pontosRota = [];

    // Ajusta escala conforme tipo de mapa
    // Planos (cosmologia): 0.5 km/px | Prov√≠ncias: 0.13 km/px | Continental: 0.23 km/px
    if (arquivo.includes('Planos.jpg') || arquivo.includes('Plano')) { 
        fatorEscala = 0.5;
    } else {
        fatorEscala = 0.13; 
    }

    // Configura o tamanho baseado no arquivo
    let cfg = configProvincia; 
    if (arquivo === 'Planos.jpg') cfg = configPlanos; 
    else if (arquivo.includes('Plano')) cfg = configSubPlanos;

    // Inicializa o mapa (A caixa preta #menu-provincias deve continuar display: block)
    inicializarMapa(arquivo, cfg.largura, cfg.altura, cfg.minZoom, cfg.maxZoom);

    // Atualiza menu lateral: esconde 'Prov√≠ncias', mostra 'Menu da Regi√£o'
    // Esconde a lista de prov√≠ncias e mostra as ferramentas da regi√£o
    document.getElementById('lista-botoes-provincia').style.display = 'none';
    document.getElementById('lista-ferramentas-regiao').style.display = 'block';

    if (marcadorTempCoords) { map.removeLayer(marcadorTempCoords); marcadorTempCoords = null; }
    adicionarMarcadoresLocais(arquivo);
    atualizarVisualBotao();

    // Ajusta visibilidade do menu dependendo do tamanho da tela
    atualizarVisibilidadeMenuMobile();
// Bot√£o de voltar est√° dinamicamente vinculado a carregarMapaPrincipal() via #btn-voltar-dinamico
    const btnVoltar = document.getElementById('btn-voltar-dinamico');
    
    // Se for um plano (mas n√£o o pr√≥prio Nexus), volta para o Nexus
    if (arquivo.includes('Plano') && arquivo !== 'Planos.jpg') {
        btnVoltar.innerHTML = "‚¨Ö Voltar ao Nexus";
        btnVoltar.onclick = function() { abrirMapaProvincia('Planos.jpg'); };
    } 
    // Se for uma prov√≠ncia normal ou o pr√≥prio Nexus, volta para o Continente
    else {
        btnVoltar.innerHTML = "‚¨Ö Voltar ao Continente";
        btnVoltar.onclick = function() { carregarMapaPrincipal(); };
    }
    // Sincroniza o visual das ferramentas ao entrar na prov√≠ncia
    atualizarBotaoMedidor(medindo ? 'medindo' : 'iniciar');
    atualizarVisualBotao();

}

/**
 * Exibe uma imagem em tela cheia com bot√£o de voltar customiz√°vel
 * @param {string} arquivo - Caminho/nome do arquivo de imagem
 * @param {function} callbackVoltar - Fun√ß√£o executada ao clicar "Voltar"
 * Usado por: verImagemPersonagem(), verImagemHistoria(), verImagemDeus()
 */
function verImagemEstatica(arquivo, callbackVoltar = null) {
    if (!arquivo || arquivo === 'none') return;

    // 1. FECHA POPUPS DO MAPA (Evita que o clique do marcador bloqueie a tela)
    if (map) map.closePopup();

    // 2. Fecha modais de texto
    fecharModais();

    // 3. Prepara a tela
    document.getElementById('map-container').style.display = 'none';
    document.getElementById('menu-provincias').style.display = 'none';
    
    const container = document.getElementById('provincia-container');
    container.style.display = 'flex';
    document.getElementById('img-provincia').src = arquivo;

    // 4. Gerencia o Bot√£o Voltar (Limpeza e Cria√ß√£o)
    const btnAntigo = container.querySelector('.btn-voltar-foto');
    if (btnAntigo) btnAntigo.remove();

    const btnVoltarImg = document.createElement('button');
    btnVoltarImg.innerHTML = "‚¨Ö Voltar";
    btnVoltarImg.className = "btn-popup btn-voltar-foto";
    
    // Z-INDEX alt√≠ssimo garante visibilidade do bot√£o acima da imagem
    // pointer-events: auto essencial para mobile (event propagation)
    btnVoltarImg.style.cssText = "position: absolute; top: 20px; left: 20px; font-size: 16px; z-index: 9999; padding: 12px 24px; cursor: pointer; pointer-events: auto; background-color: #8b4513; color: white; border-radius: 5px;";
    
    btnVoltarImg.onclick = function(e) {
        e.stopPropagation(); // Impede que o clique "vaze" para a imagem atr√°s
        if (callbackVoltar) {
            callbackVoltar();
        } else {
            restaurarMapaMenu();
        }
    };

    // appendChild coloca bot√£o como √öLTIMO filho -> fica vis√≠vel na frente
    container.appendChild(btnVoltarImg);
}

 /**
 * Adiciona todos os marcadores (cidades, vilarejos, ru√≠nas, etc) de um mapa espec√≠fico
 * POLIM√ìRFICO: Cada tipo de mapa (prov√≠ncia, plano, etc) tem sua pr√≥pria l√≥gica
 * 
 * Mapas principais com l√≥gica especial:
 *   'Hukmal_tep.jpg' - 5 cidades + Port√£o de Entrada (bot√£o especial para Capital)
 *   'Blat_khyr.jpg'  - Cidades floresta + Escola de Magia (senha 'fofoca')
 *   'Deserto.jpg'    - Localidades deserto + Mina do Leste
 *   'Lago.jpg'       - Vilarejos lacustres + senha 'ninja'
 *   'Alcova.jpg'     - Pirata/submundo + Taverna da Lama
 *   'Planos.jpg'     - Nexus central + 3 planos (Divino, Demon√≠aco, Espiritual)
 * 
 * Submapas de planos (quando nomeDoMapa = 'Plano_Divino.jpg', etc):
 *   - 5-6 regi√µes tem√°ticas com descri√ß√µes atmosf√©ricas
 *   - Bot√£o "Retornar ao Nexus" leva de volta a Planos.jpg
 * 
 * FLUXO DE CLIQUE:
 *   1. Usu√°rio clica marcador -> popup com t√≠tulo + descri√ß√£o + bot√µes
 *   2. Clica bot√£o "Ver Foto" ou especial -> fullscreen image
 *   3. Back button no fullscreen -> restaura mapa + reabre popup (se suportado)
 * @param {string} nomeDoMapa - Nome do arquivo PNG a popular com marcadores
 */
function adicionarMarcadoresLocais(nomeDoMapa) {
    // √çcones padr√£o Leaflet com tamanhos vari√°veis (normal: 50px, grande: 100px)
    const iconP = L.icon({iconUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png', iconSize: [50, 50], iconAnchor: [25, 25], popupAnchor: [0, -25]});
    const iconG = L.icon({iconUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png', iconSize: [100, 100], iconAnchor: [50, 50], popupAnchor: [0, -50]});

    // Helper interno: cria marcador padr√£o com foto clic√°vel
function criarPontoLocal(coord, nome, info, foto = null, grande = false, botaoExtra = null) {
        const m = L.marker(coord, {icon: grande ? iconG : iconP, opacity: 0}).addTo(map);
        let htmlBotoes = `<div style="margin-top: 8px; display:flex; flex-direction:column;">`;
        
        if (foto) htmlBotoes += criarBtn("üì∏ Ver Foto", `verImagemEstatica('${foto}')`, "#5F9EA0");
        if (botaoExtra) htmlBotoes += botaoExtra; // Para bot√µes customizados (ex: Escola de Magia)
        
        htmlBotoes += `</div>`;
        m.bindPopup(`<div style="text-align:center;"><b>${nome}</b><br><small style="color:#ccc;">${info}</small>${htmlBotoes}</div>`);
    }

        if (nomeDoMapa === 'Hukmal_tep.jpg') {
            criarPontoLocal([1396, 780], "Capital de Hukmal'tep", "Felista", "C√≥pia de capital de hukmal_tep.png", true);
            criarPontoLocal([1422, 441], "Torre de Vigia", "Felista");
            criarPontoLocal([1209, 520], "Torre de Vigia", "Felista");
            criarPontoLocal([1488, 1081], "Torre de Vigia", "Felista");
            criarPontoLocal([1222, 1158], "Torre de Vigia", "Felista");
            criarPontoLocal([1474, 546], "Porto", "Felista");
            criarPontoLocal([1256, 1129], "Vilarejo", "Felista");
            criarPontoLocal([1106, 505], "Vilarejo", "Felista");
            criarPontoLocal([157, 267], "Cidade", "Garra do Inverno");
            criarPontoLocal([419, 483], "Vilarejo", "Garra do Inverno");
            criarPontoLocal([242, 1338], "Vilarejo", "Garra do Inverno", "C√≥pia de cidade ponte.png", true);
            criarPontoLocal([369, 868], "Vilarejo", "Garra do inverno", "C√≥pia de Cidade neve 3.png", true);
            criarPontoLocal([268, 1472], "Torre de Vigia", "Malista");
            criarPontoLocal([513, 1617], "Cidade", "Malista", "C√≥pia de Cidade neve 5.png", true);
            criarPontoLocal([534, 1918], "Vilarejo", "Malista");
            criarPontoLocal([530, 1710], "Porto", "Malista");
            criarPontoLocal([678, 101], "Porto", "Malista");
            criarPontoLocal([707, 1520], "Vilarejo", "Malista");
            criarPontoLocal([659, 1127], "Vilarejo", "Malista", "C√≥pia de Cidade neve 4.png", true);
            criarPontoLocal([796, 1134], "Torre de Vigia", "Malista");
            criarPontoLocal([960, 1733], "Torre de Vigia", "Malista");
            criarPontoLocal([1113, 1460], "Vilarejo", "Malista");
            criarPontoLocal([1003, 172], "Vilarejo", "Malista");
            criarPontoLocal([673, 640], "Vilarejo", "Malista", "C√≥pia de cidade drag√£o.png", true);
            criarPontoLocal([621, 358], "Torre de Vigia", "Malista");
            criarPontoLocal([740, 452], "Torre de Vigia", "Malista");
            criarPontoLocal([713, 257], "Cidade Malista", "Malista", "C√≥pia de Cidade portuaria gelo.png", true);
            criarPontoLocal([141, 578], "Vilarejo", "Neutro", "inicial.png", true);
            criarPontoLocal([1184, 1014], "Vilarejo", "Neutro");
        }

        if (nomeDoMapa === 'Blat_khyr.jpg') {
            // --- PONTO DA ESCOLA DE MAGIA (J√Å EXISTIA) ---
            const btnEscola = criarBtn("üéì Escola de Magia", "abrirModalSenha('poder', 'bloqueado.jpg', 'imagem')", "#800080");
            criarPontoLocal([382, 1359], "Capital de Blat'khyr", "Elfos", "cidade magica.png", true, btnEscola);
            
            // --- OUTROS PONTOS ---
            criarPontoLocal([986, 1239], "Vilarejo", "Desconhecido");
            criarPontoLocal([1091, 606], "Vilarejo", "Desconhecido");

            // --- NOVO: PONTO DAS BRUXAS [1463, 1151] ---
            // 1. Cria o bot√£o com a senha "Bruxas" que abre a imagem "Vila bruxa.png"
            const btnBruxas = criarBtn("üîç Descobrir", "abrirModalSenha('Bruxas', 'Vila bruxa.png', 'imagem')", "#2E8B57");
            
            // 2. Cria o ponto passando o bot√£o
            criarPontoLocal([1463, 1151], "Vilarejo", "Desconhecido", null, true, btnBruxas);

            // --- RESTANTE DOS PONTOS DE BLAT'KHYR ---
            criarPontoLocal([491, 371], "Cidade", "Elfos", "Cidade portu√°ria 4.png", true);
            criarPontoLocal([741, 963], "Cidade", "Elfos", "Cidade portu√°ria.png", true);
            criarPontoLocal([621, 1760], "Cidade", "Elfos", "Cidade portu√°ria 2.png", true);
            criarPontoLocal([69, 1054], "Cidade", "Elfos", "Cidade portu√°ria 3.png", true);
            criarPontoLocal([408, 745], "Cidade", "Elfos", "Cidade portu√°ria 5.webp", true);
            criarPontoLocal([252, 891], "Cidade", "Elfos", "Cidade portu√°ria 6.jpg", true);
            criarPontoLocal([611, 1210], "Vilarejo", "Humanos", "Vila.png", true);
            criarPontoLocal([530, 1149], "Vilarejo", "Humanos");
            criarPontoLocal([556, 850], "Vilarejo", "Humanos");
            criarPontoLocal([641, 641], "Vilarejo", "Humanos");
            criarPontoLocal([256, 1302], "Vilarejo", "Humanos");
            criarPontoLocal([500, 1644], "Vilarejo", "Humanos");
            criarPontoLocal([273, 1366], "Cidade", "Elfos");
            criarPontoLocal([824, 894], "Muralha", "Elfos");
            criarPontoLocal([791, 648], "Muralha", "Elfos");
            criarPontoLocal([766, 388], "Muralha", "Elfos");
            criarPontoLocal([884, 1094], "Muralha", "Elfos");
            criarPontoLocal([882, 1271], "Muralha", "Elfos");
        }
         if (nomeDoMapa === 'Deserto.jpg') {
            criarPontoLocal([240, 762], "Capital do Deserto", "Zha-Ruk", "Capital deserto.png", true);
            criarPontoLocal([1314, 588], "Vilarejo", "Ghovar", "Vila deserto.png", true);
            criarPontoLocal([1422, 1582], "Vilarejo", "Ghovar", "Vila de areia.png", true);
            criarPontoLocal( [1256, 126], "Minera√ß√£o", "Ghovar");
            criarPontoLocal( [1436, 112], "Minera√ß√£o", "Abandonada");
            criarPontoLocal( [1362, 400], "Minera√ß√£o", "Ghovar");
            criarPontoLocal( [1247, 730], "Minera√ß√£o", "Ghovar");
            criarPontoLocal( [1213, 846], "Minera√ß√£o", "Ghovar");
            criarPontoLocal( [1256, 126], "Minera√ß√£o", "Ghovar");
            criarPontoLocal( [1408, 1727], "Minera√ß√£o", "Abandonada");
            criarPontoLocal( [1363, 1855], "Minera√ß√£o", "Ghovar");
            criarPontoLocal( [1217, 1298], "Minera√ß√£o", "Abandonada");
            criarPontoLocal( [1149, 1784], "Minera√ß√£o", "Abandonada");
            criarPontoLocal(  [1049, 1809], "Minera√ß√£o", "Abandonada");
            criarPontoLocal( [1142, 1921], "Minera√ß√£o", "Abandonada");
            criarPontoLocal( [693, 1510], "Minera√ß√£o", "Ghovar");
            criarPontoLocal( [871, 1533], "Minera√ß√£o", "Ghovar");
            criarPontoLocal( [786, 1775], "Minera√ß√£o", "Ghovar");
            criarPontoLocal( [1032, 365], "Minera√ß√£o", "Ghovar");
            criarPontoLocal( [990, 617], "Minera√ß√£o", "Ghovar");
            criarPontoLocal(  [808, 580], "Minera√ß√£o", "Ghovar");
            criarPontoLocal(  [813, 399], "Minera√ß√£o", "Ghovar");
            criarPontoLocal( [475, 566], "Minera√ß√£o", "Abandonada");
            criarPontoLocal( [326, 539], "Minera√ß√£o", "Abandonada");
            criarPontoLocal( [401, 376], "Minera√ß√£o", "Ghovar");
        
            criarPontoLocal([1082, 1619], "Cidade", "Samum", "Cidade an√£.png", true);
            criarPontoLocal([1434, 312], "Cidade", "Samum", "Cidade deserto.png", true);
            criarPontoLocal([1082, 146], "Cidade", "Samum", "Cidade deserto 2.png", true);
            criarPontoLocal( [752, 536], "Cidade", "Samum", "Cidade enterrada 2.png", true);
            criarPontoLocal( [148, 170], "Cidade", "Samum");
            criarPontoLocal( [188, 1910], "Cidade", "Samum");

            criarPontoLocal( [1394, 814], "Ru√≠nas", "Atarim", "Entrada deserto.png", true);
            criarPontoLocal( [920, 662], "Ru√≠nas", "Atarim", "paisagem.png", true);
            criarPontoLocal( [660, 1652], "Ru√≠nas", "Atarim");
            criarPontoLocal(  [1310, 1502], "Ru√≠nas", "Atarim");

            criarPontoLocal( [792, 912], "Castelo", "Zha-Ruk", "Castelo deserto 1.png", true);
            criarPontoLocal( [1394, 915], "Castelo", "Zha-Ruk", "Castelo deserto 2.png", true);
            criarPontoLocal( [332, 1278], "Castelo", "Zha-Ruk");
            criarPontoLocal( [1020, 1188], "Castelo", "Zha-Ruk");
            criarPontoLocal( [1210, 1118], "Torre de Vigia", "Zha-Ruk");
            criarPontoLocal(  [1432, 1196], "Torre de Vigia", "Zha-Ruk");

        }
         if (nomeDoMapa === 'Lago.jpg') {
            criarPontoLocal([970, 1152], "Templo do Lago", "Guardi√µes do Templo", "Templo do lago.png", true);
            const btnPanteao = criarBtn("‚ö° Pante√£o", "menuDeuses()", "#4682B4");
            criarPontoLocal([1366, 1578], "Cidade Sagrada", "Igreja dos 12 Deuses", "Cidade Santa.png", true, btnPanteao);
            criarPontoLocal([1336, 1740], "Cidade Sagrada", "Igreja dos 12 Deuses", "Cidade Santa.png", true, btnPanteao);
            criarPontoLocal([446, 1336], "Vilarejo", "Dinastia Xogum");
            const btnNinja = criarBtn("üîç Descobrir", "abrirModalSenha('ninja', 'vila oculta.png', 'imagem')", "#2E8B57");
            criarPontoLocal([180, 912], "Cidade", "Dinastia Xogum", "cidade lago 1.png", true, btnNinja);
            criarPontoLocal([898, 1908], "Cidade", "Dinastia Kemono", "capital do lago.png", true); 
            criarPontoLocal([726, 1366], "Cidade", "Dinastia Kemono", "cidade lago 2.png", true); //imagem beira do lago
            criarPontoLocal([948, 1672], "Vilarejo", "Dinastia Kemono");
            criarPontoLocal([980, 818], "Cidade", "Dinastia Kitsune", "cidade na montanha.png", true); //imagem beira do lago
            criarPontoLocal([1014, 92], "Vilarejo", "Dinastia Kitsune", "vilarejo na montanha.png", true);
            criarPontoLocal( [610, 706], "Vilarejo", "Dinastia Kitsune");
            criarPontoLocal( [1190, 532], "Vilarejo", "Dinastia Kitsune", "templo.png", true);
            criarPontoLocal( [1400, 192], "Vilarejo", "Dinastia Kitsune");
            criarPontoLocal( [1370, 1016], "Vilarejo", "Dinastia Kitsune");
            criarPontoLocal( [534, 400], "Vilarejo", "Dinastia Seilor");
            criarPontoLocal( [786, 460], "Cidade", "Dinastia Seilor", "cidade lago 3.png", true); //imagem com porto

 
        }

         if (nomeDoMapa === 'Alcova.jpg') {
            criarPontoLocal( [1326, 782], "Torre de Vigia", "Marinha Imperial");
            criarPontoLocal( [1175, 1185], "Torre de Vigia", "Marinha Imperial");
            criarPontoLocal( [1228, 1740], "Torre de Vigia", "Marinha Imperial");
            criarPontoLocal( [724, 650], "Torre de Vigia", "Marinha Imperial");
            criarPontoLocal( [850, 1007], "Torre de Vigia", "Marinha Imperial");
            criarPontoLocal(  [835, 1426], "Torre de Vigia", "Marinha Imperial");
            criarPontoLocal(  [778, 1526], "Torre de Vigia", "Marinha Imperial");

            criarPontoLocal(  [1333, 845], "Cidade", "Desconhecido");
            criarPontoLocal(  [1178, 1137], "Cidade", "Desconhecido");
            criarPontoLocal(  [1191, 1770], "Cidade", "Desconhecido");
            criarPontoLocal(  [637, 1817], "Cidade", "Desconhecido");
            criarPontoLocal(   [565, 1781], "Cidade", "Desconhecido");
            criarPontoLocal(  [814, 1010], "Cidade", "Desconhecido");
            criarPontoLocal(   [775, 643], "Cidade", "Desconhecido");
            criarPontoLocal(   [693, 612], "Cidade", "Desconhecido");
            criarPontoLocal(  [570, 285], "Cidade", "Desconhecido");
            criarPontoLocal(   [210, 344], "Cidade", "Desconhecido");
            criarPontoLocal(  [344, 1175], "Cidade", "Desconhecido");
            criarPontoLocal(   [1133, 536], "Cidade", "Desconhecido");
            criarPontoLocal(    [994, 437], "Cidade", "Desconhecido");

            criarPontoLocal( [904, 269], "Cidade", "Desconhecido", "Cidade pirata.png", true);
            criarPontoLocal(  [333, 1571], "Cidade", "Desconhecido");
            criarPontoLocal( [291, 1628], "Cidade", "Desconhecido");
            criarPontoLocal( [1311, 391], "Cidade", "Desconhecido", "Cidade alcova.jpg", true);
            const btnDescobrir = criarBtn("üîç Descobrir", "abrirModalSenha('mar', 'Mar.jpg')", "#2E8B57");
            criarPontoLocal([1052, 540], "Cidade", "Desconhecido", "Alcova.png", true, btnDescobrir);
            criarPontoLocal( [1131, 688], "Cidade", "Desconhecido", "Alcova 2.png", true);
            criarPontoLocal( [1189, 1455], "Cidade", "Desconhecido", "Alcova 3.png", true);
            criarPontoLocal( [1317, 1679], "Cidade", "Desconhecido");
            criarPontoLocal( [370, 736], "Cidade", "Desconhecido"); 
            criarPontoLocal(  [482, 1192], "Ilha dos Afogados", "Desconhecido", "lugar no mar.png", true);
            criarPontoLocal( [778, 1442], "Ilha Naval", "Marinha Imperial", "ilha naval.png", true);
            criarPontoLocal( [866, 1518], "Ilha Naval", "Marinha Imperial", "ilha naval.png", true);
            const btnRuinas = criarBtn("üîç Descobrir", "abrirModalSenha('12', 'Templo do fim do mundo.png', 'imagem')", "#2E8B57");
            criarPontoLocal([134, 1355], "Ru√≠nas", "Desconhecido", null, true, btnRuinas);
 
        }
if (nomeDoMapa === 'Mar.jpg') {

            const btnSubir = criarBtn("‚¨ÜÔ∏è Subir", "abrirMapaProvincia('Alcova.jpg')", "#4682B4");
            criarPontoLocal([962, 444], "T√∫neis", "Passagem de volta para a superf√≠cie.", null, true, btnSubir);
            criarPontoLocal([772, 264], "T√∫neis", "Passagem de volta para a superf√≠cie.", null, true, btnSubir);
            criarPontoLocal([720, 948], "T√∫neis", "Passagem de volta para a superf√≠cie.", null, true, btnSubir);
            criarPontoLocal([834, 1404], "T√∫neis", "Passagem de volta para a superf√≠cie.", null, true, btnSubir);
            criarPontoLocal([1180, 1744], "T√∫neis", "Passagem de volta para a superf√≠cie.", null, true, btnSubir);
            
            criarPontoLocal( [1020, 954], "Cidade Submersa", "Desconhecido", "Cidade no mar.png", true);
            criarPontoLocal( [470, 538], "Cidade Submersa", "Desconhecido", "mais cidade no mar.png", true);
            criarPontoLocal( [982, 1826], "Cidade Submersa", "Desconhecido", "Cidade no mar 2.jpg", true);
            criarPontoLocal( [292, 1370], "Cidade Submersa", "Desconhecido");
        
        
        }
if (nomeDoMapa === 'Planos.jpg') {
        selecaoAtual = null; // Reseta sele√ß√£o

        // √çcone Gigante
        const iconMega = L.icon({
            iconUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png', 
            iconSize: [120, 120], iconAnchor: [60, 120], popupAnchor: [0, -100]
        });

        // Fun√ß√£o Especial para o Nexus (Agora abre MAPAS e tem descri√ß√£o)
// Fun√ß√£o Especial para o Nexus (Atualizada para o novo estilo)
        function criarPontoNexus(coord, nome, descricao, chaveTexto, arquivoMapa) {
            const m = L.marker(coord, {icon: iconMega, opacity: 0}).addTo(map); 

            let botoes = "";
            if (arquivoMapa) {
                // Usamos a fun√ß√£o criarBtn para o fundo preto com barra roxa (#483D8B)
                botoes = criarBtn("üó∫Ô∏è Entrar no Plano", `abrirMapaProvincia('${arquivoMapa}')`, "#483D8B");
            }

            m.bindPopup(`<div style="text-align:center; width: 180px;"><b>${nome}</b><br><small style="color:#ccc;">${descricao}</small><div style="margin-top:10px;">${botoes}</div></div>`);

            m.on('click', function() { selecaoAtual = chaveTexto; });
        }

        // --- PONTOS DO NEXUS ---
        // Divino -> Abre o mapa "Plano Divino.png"
        criarPontoNexus([806, 214], "Plano Divino", "A morada da luz eterna.", "divino", "Plano Divino.png");
        criarPontoNexus([590, 214], "Plano Divino", "A morada da luz eterna.", "divino", "Plano Divino.png");

        // Demon√≠aco -> Abre o mapa "Plano Demon√≠aco.png"
        criarPontoNexus([254, 193], "Plano Demon√≠aco", "O abismo do caos.", "demoniaco", "Plano Demon√≠aco.png");
        criarPontoNexus([92, 202], "Plano Demon√≠aco", "O abismo do caos.", "demoniaco", "Plano Demon√≠aco.png");

        // Espiritual -> Abre o mapa "Plano Espiritual.png"
        criarPontoNexus([763, 544], "Plano Espiritual", "O fluxo de mana e almas.", "espiritual", "Plano Espiritual.png");
        criarPontoNexus([616, 556], "Plano Espiritual", "O fluxo de mana e almas.", "espiritual", "Plano Espiritual.png");

        // Mortal -> Volta pro Continente (Mantive o bot√£o verde diferente)
        const m = L.marker([246, 558], {icon: iconMega, opacity: 0}).addTo(map);
        
        const btnVoltar = criarBtn("üåç Voltar ao Continente", "carregarMapaPrincipal()", "#2E8B57");
       // const btnVoltar = `<button onclick="carregarMapaPrincipal()" class="btn-popup" style="background: #2E8B57; width: 100%;">üåç Voltar ao Continente</button>`;
        m.bindPopup(`<div style="text-align:center; width: 180px;"><b>Plano Mortal</b><br><small style="color:#ccc;">O mundo material de Arton.</small><div style="margin-top:10px;">${btnVoltar}</div></div>`);
        m.on('click', function() { selecaoAtual = 'mortal'; });
        
    }

    // --- 2. OS NOVOS MAPAS DOS PLANOS (Bot√£o para voltar ao Nexus) ---
    
    // Configura√ß√£o do bot√£o de voltar para o Nexus
    const btnVoltarNexus = `<button onclick="abrirMapaProvincia('Planos.jpg')" class="btn-popup" style="background: #aeb6bf; color: black;">‚Ü© Voltar ao Nexus</button>`;

    if (nomeDoMapa === 'Plano Divino.png') {
        // Coloquei num canto gen√©rico, ajuste a coordenada [Y, X] depois
        criarPontoLocal([100, 100], "Sa√≠da do Plano", "Portal de volta para a Grande Roda.", null, true, btnVoltarNexus);
        // Adicione aqui os pontos internos do Plano Divino...
    }

    if (nomeDoMapa === 'Plano Demon√≠aco.png') {
        criarPontoLocal([100, 100], "Sa√≠da do Abismo", "Portal de volta para a Grande Roda.", null, true, btnVoltarNexus);
        // Adicione aqui os pontos internos do Plano Demon√≠aco...
    }

    if (nomeDoMapa === 'Plano Espiritual.png') {
        criarPontoLocal([100, 100], "Sa√≠da do Fluxo", "Portal de volta para a Grande Roda.", null, true, btnVoltarNexus);
        // Adicione aqui os pontos internos do Plano Espiritual...
    }
    }

// --- 7. MARCADORES DO CONTINENTE ---
/**
 * ADICIONA MARCADORES DO MAPA CONTINENTAL
 * 5 Prov√≠ncias + 3 Locais Especiais (Capital, Cidade Sagrada, Torre)
 * 
 * Fluxo de clique:
 *   - Prov√≠ncia (ex: Hukmal_tep) -> abrirMapaProvincia(arquivo)
 *   - Capital Imperial -> popup com 8 bot√µes (lendas, banco, esquadr√£o, etc)
 *   - Cidade Sagrada -> popup com Pante√£o
 *   - Torre dos S√°bios -> senha 'fofoca' para acessar interior
 * 
 * Sistema de √≠cones:
 *   - iconP: Normal (80x80)
 *   - iconG: Grande/importante (120x120)
 * 
 * FUN√á√ÉO INTERNA: criarPonto()
 *   Polim√≥rfica, infere tipo de popup a partir dos argumentos
 *   Tipo 1: criarPonto([y,x], "Nome", "desc", "arquivo.png", 'mapa')
 *   Tipo 2: criarPonto([y,x], "Nome", "desc", "arquivo.png", 'imagem')
 *   Tipo 3: criarPonto([y,x], "Nome", null, 'none', true) -> apenas placeholder
 */
    function adicionarMarcadoresPrincipais() {
        const iconP = L.icon({iconUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png', iconSize: [80, 80], iconAnchor: [40, 40], popupAnchor: [0, -40]});
        const iconG = L.icon({iconUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png', iconSize: [120, 120], iconAnchor: [60, 60], popupAnchor: [0, -60]});

        function criarPonto(coord, nome, arg3, arg4, arg5) {
            let descricao = "", arquivo = "", tipo = "", grande = false;
            if (arg3 && (arg3.includes('.png') || arg3.includes('.jpg') || arg3.includes('.webp') || arg3 === null)) {
                arquivo = arg3; tipo = arg4; grande = arg5 || false;
            } else {
                descricao = arg3; arquivo = arg4; tipo = arg5;
            }

            const m = L.marker(coord, { icon: grande ? iconG : iconP, opacity: 0 }).addTo(map);
            let botoes = `<div style="margin-top:10px; display:flex; flex-direction:column;">`;

// --- L√ìGICA NOVA PARA A CAPITAL (PAINEL UNIFICADO) ---
            if (nome === "Capital Imperial") {
                    botoes += criarBtn("üèõÔ∏è Acessar Painel Imperial", "menuCapital('hub')", "#DAA520");
                }
            // --- CIDADE SAGRADA ---
            else if (nome === "Cidade Sagrada") {
                if (arquivo) botoes += criarBtn("üì∏ Ver Cidade", `verImagemEstatica('${arquivo}')`, "#5F9EA0");
                botoes += criarBtn("‚ö° Pante√£o", "menuDeuses()", "#4682B4");
            }
            // --- TORRE DOS S√ÅBIOS ---

            else if (nome === "Torre dos S√°bios") {
                if (arquivo) botoes += criarBtn("üì∏ Ver Exterior", `verImagemEstatica('${arquivo}')`, "#5F9EA0");
                botoes += criarBtn("üîÆ Acessar Interior", `abrirModalSenha('fofoca', 'abrirMenuTorre()', 'funcao')`, "#9370DB");
            }
            else if (nome === "Ilha Paradis√≠aca") {
    if (arquivo) botoes += criarBtn("üì∏ Ver Ilha", `verImagemEstatica('${arquivo}')`, "#5F9EA0");
    // Adicionando a Importa√ß√£o com o estilo novo
    botoes += criarBtn("üì¶ Importa√ß√£o", "verImagemEstatica('bloqueado.jpg')", "#FF8C00");
}
            // --- PONTOS GEN√âRICOS (VILAREJOS / PROV√çNCIAS) ---
            else {
                if (arquivo) {
                    if (tipo === 'mapa') botoes += criarBtn("üó∫Ô∏è Explorar Prov√≠ncia", `abrirMapaProvincia('${arquivo}')`, "#8b4513");
                    else if (tipo === 'imagem') botoes += criarBtn("üì∏ Ver Foto", `verImagemEstatica('${arquivo}')`, "#5F9EA0");
                }
                
                if (nome === "P√¢ntano" || nome === "Floresta dos Sonhos") {
                    let senha = (nome === "P√¢ntano") ? "Seita" : "perdido";
                    botoes += criarBtn("üîç Descobrir", `abrirModalSenha('${senha}', 'bloqueado.jpg', 'imagem')`, "#2E8B57");
                }
            }

            botoes += `</div>`;
            m.bindPopup(`<div style="text-align:center;"><b>${nome}</b><br><small style="color:#ccc;">${descricao}</small>${botoes}</div>`);
        }

// PONTOS
        criarPonto([824, 2330], "Deserto","A Origem do Mundo", "Deserto.jpg", 'mapa');
        criarPonto([3850, 3580], "Hukmal'tep", "O Inverno Absoluto","Hukmal_tep.jpg", 'mapa');
        criarPonto([2902, 5464], "Blat'khyr", "O Ber√ßo da Magia", "Blat_khyr.jpg", 'mapa');
        criarPonto([1118, 4346], "Lago", "O Solo Aben√ßoado", "Lago.jpg", 'mapa');
        criarPonto([1356, 3284], "Alcova","O Lar dos Piratas", "Alcova.jpg", 'mapa');
        criarPonto([2250, 4258], "Espinha do Gigante", "As Terras Altas", "Espinha do Gigante.jpg", 'mapa', true);
        criarPonto([2142, 4378], "Espinha do Gigante","As Terras Altas", "Espinha do Gigante.jpg", 'mapa', true);
        
        criarPonto([2370, 3767], "Capital Imperial", "A Casa do Imp√©rio", "Capital.png", 'imagem');
        criarPonto([1648, 4438], "Cidade Sagrada", "Cidade Santa.png", 'imagem');
        criarPonto([2862, 2890], "Torre dos S√°bios", "Torre dos Sabios.png", 'imagem');
        criarPonto([1188, 5574], "Ilha Paradis√≠aca", "ilha 2.png", 'imagem');
        
        criarPonto([1830, 2322], "Vilarejo", "cidade da ra√ßa l√°.png", 'imagem');
        criarPonto([2114, 3854], "Vilarejo", "vilarejo.png", 'imagem');
        criarPonto([2142, 3254], "Vilarejo", "vilarejo 2.jpg", 'imagem');
        criarPonto([1758, 4620], "Vilarejo", "vilarejo 3.jpg", 'imagem');
        
        criarPonto([2252, 2880], "P√¢ntano", "pantano.png", 'imagem');
        criarPonto([2138, 2890], "P√¢ntano", "pantano.png", 'imagem');
        criarPonto([2228, 3032], "P√¢ntano", "pantano.png", 'imagem');
        criarPonto([2220, 2656], "P√¢ntano", "pantano.png", 'imagem');
        
        criarPonto([2232, 3936], "Vilarejo", "Sem detalhes", 'none');
        criarPonto([2300, 3400], "Vilarejo", "Sem detalhes", 'none');
        criarPonto([1830, 4354], "Vilarejo", "Sem detalhes", 'none');
        criarPonto([1630, 3054], "Vilarejo", "Sem detalhes", 'none');
        criarPonto([2464, 4974], "Ilha de Blat'khyr", "Cad√™?", "Ilha.png", 'imagem');
        
        criarPonto([1838, 3526], "Floresta dos Sonhos", "floresta dos sonhos.png", 'imagem');
        criarPonto([1750, 3320], "Floresta dos Sonhos", "floresta dos sonhos.png", 'imagem');
        criarPonto([1536, 3634], "Floresta dos Sonhos", "floresta dos sonhos.png", 'imagem');
        criarPonto([2070, 3642], "Floresta dos Sonhos", "floresta dos sonhos.png", 'imagem');
        
        criarPonto([3912, 1780], "Inverno Desolado", "O inverno est√° chegando...", 'none', true);
    }
    


/**
 * Atualiza visual dos bot√µes de calculadora de viagem (Menu + Regi√£o)
 * Muda texto e aplica classe 'btn-ferramenta-ativa' (verde) quando ativo
 * @param {string} estado - 'medindo' ou 'iniciar'
 */
function atualizarBotaoMedidor(estado) {
    const botoes = [document.getElementById('btn-medidor'), document.getElementById('btn-medidor-prov')];
    let texto = (estado === 'medindo') ? "üèÅ Finalizar Rota" : "üìè Calculadora de Viagem";
    botoes.forEach(btn => {
        if (!btn) return;
        btn.innerHTML = texto;
        if (estado === 'medindo') {
            btn.classList.add('btn-ferramenta-ativa');
        } else {
            btn.classList.remove('btn-ferramenta-ativa');
        }
    });
}
/**
 * Ativa/desativa modo de medi√ß√£o de rotas
 * Ao ativar: desabilita cliques em marcadores, ativa modo crosshair
 * Ao desativar (com 2+ pontos): abre calculadora com resultados
 * Ao desativar (com < 2 pontos): cancela silenciosamente
 * Conflita com: modoCoordenadas (desativa coords se ativar medidor)
 */
function ativarMedidor() {
    if (!medindo) {
        // Se as coordenadas estiverem ON, mata elas primeiro
        if (modoCoordenadas) {
            modoCoordenadas = false;
            document.getElementById('map-container').classList.remove('mapa-intangivel');
            atualizarVisualBotao(); // Reseta os bot√µes de coordenadas para OFF
        }

        medindo = true;
        pontosRota = [];
        grupoRota.addTo(map);
        grupoRota.clearLayers();
        
        document.getElementById('map-container').classList.add('mapa-intangivel');
        document.getElementById('map').classList.add('modo-medicao-ativo');
        
        atualizarBotaoMedidor('medindo'); // Deixa os bot√µes de Medir verdes
        
    } else {
        // Se j√° estava medindo, finaliza
        if (pontosRota.length > 1) {
            calcularResultados();
        } else {
            cancelarModoMedicao();
        }
    }
}

/**
 * Cancela o modo de medi√ß√£o mantendo a rota visual no mapa
 * Remove classes CSS de intangibilidade e crosshair
 * Reseta bot√£o para estado inicial (n√£o verde)
 */
    function cancelarModoMedicao() {
        medindo = false;
        document.getElementById('map-container').classList.remove('mapa-intangivel');
        document.getElementById('map').classList.remove('modo-medicao-ativo');
        atualizarBotaoMedidor('iniciar');
    }

/**
 * Processa cada clique do usu√°rio enquanto est√° em modo de medi√ß√£o
 * Adiciona ponto √† rota e desenha linha conectando ao anterior
 * Ctrl+Z remove o √∫ltimo ponto
 * @param {object} latlng - Coordenada [lat, lng] do clique
 */
    function processarCliqueMedicao(latlng) {
        // Adiciona coordenada √† lista
        pontosRota.push(latlng);

        // Desenha uma bolinha (ponto)
        const bolinha = L.circleMarker(latlng, {
            radius: 4, color: 'white', fillColor: '#ff4444', fillOpacity: 1, className: 'marcador-rota'
        }).addTo(grupoRota);

        // Se tiver mais de 1 ponto, desenha a linha conectando o anterior ao atual
        if (pontosRota.length > 1) {
            const ultimoPonto = pontosRota[pontosRota.length - 2];
            const linha = L.polyline([ultimoPonto, latlng], {
                color: '#ff4444', weight: 3, dashArray: '5, 10'
            }).addTo(grupoRota);
        }
    }

/**
 * Calcula dist√¢ncia, tempo de viagem e custo de transporte imperial
 * Usa fatorEscala (0.23 continental, 0.13 prov√≠ncias, 0.5 planos)
 * Tempo base: 30 km/dia a p√© (padr√£o RPG), 1.5x mula, 2x cavalo, 4x especial
 * Custo: 2.5g taxa + 2.5p por km (sistema: 1g=100p=10000b)
 * Abre modal com tabela de resultados
 */
function calcularResultados() {
        let distanciaTotalPixels = 0;

        // Soma a dist√¢ncia de todos os segmentos da rota
        for (let i = 0; i < pontosRota.length - 1; i++) {
            distanciaTotalPixels += map.distance(pontosRota[i], pontosRota[i+1]);
        }

        // --- C√ÅLCULOS ---
        const distanciaReal = distanciaTotalPixels * fatorEscala;

        // CALIBRA√á√ÉO DE TEMPO (CORRIGIDA)
        // Usamos 30 km por dia (ritmo de marcha padr√£o de RPG)
        // Antes estava 150 (que era baseado em pixels, por isso estava r√°pido demais)
        const kmPorDiaPe = 30; 
        
        const diasPe = (distanciaReal / kmPorDiaPe).toFixed(1);
        const diasMontariaLenta = (distanciaReal / (kmPorDiaPe * 1.5)).toFixed(1); // Mula
        const diasMontariaNormal = (distanciaReal / (kmPorDiaPe * 2.0)).toFixed(1); // Cavalo
        const diasMontariaRapida = (distanciaReal / (kmPorDiaPe * 4.0)).toFixed(1); // Voo

        // --- ECONOMIA (CORRIGIDA - METADE DO PRE√áO) ---
        // 1 Gold = 100 Prata = 10000 Bronze
        
        // Taxa de Embarque: 2.5 Golds (Era 5)
        const custoBase = 25000; 
        
        // Custo por KM: 2.5 Pratas (Era 5)
        const custoPorKm = 250;  
        
        let custoTotalCobre = Math.floor(custoBase + (distanciaReal * custoPorKm));

        // Convers√£o de Moedas
        const golds = Math.floor(custoTotalCobre / 10000);
        custoTotalCobre %= 10000;
        const silvers = Math.floor(custoTotalCobre / 100);
        const bronzes = custoTotalCobre % 100;

        // Monta o HTML do Resultado
        let html = `
            <p><strong>Rota Total:</strong> ${Math.floor(distanciaReal)} km (aprox).</p>
            <table class="tabela-viagem">
                <tr><th>M√©todo</th><th>Tempo Total</th></tr>
                <tr><td>üö∂ A P√©</td><td>${diasPe} dias</td></tr>
                <tr><td>üê¥ Mula/Burro (Montaria Lenta)</td><td>${diasMontariaLenta} dias</td></tr>
                <tr><td>üêé Cavalo (Montaria Normal)</td><td>${diasMontariaNormal} dias</td></tr>
                <tr><td>‚ö° Montaria Especial (Montaria R√°pida)</td><td>${diasMontariaRapida} dias</td></tr>
            </table>

            <hr>
            <h4 style="color: #87CEEB;">üîÆ Transporte Imperial Seguro</h4>
            <p>Taxa de risco e seguro inclusos.</p>
            <p><strong>Valor Total:</strong><br>
            <span class="destaque-gold">${golds} Ouro</span>, 
            <span class="destaque-silver">${silvers} Prata</span>, 
            <span class="destaque-bronze">${bronzes} Bronze</span>.
            </p>
        `;

        document.getElementById('resultado-viagem').innerHTML = html;
        document.getElementById('modal-viagem').style.display = 'flex';
        
        // Sai do modo de medi√ß√£o, mas MANT√âM O DESENHO na tela para verem
        cancelarModoMedicao();
    }
/**
 * Remove o √∫ltimo ponto e linha da rota durante medi√ß√£o
 * Atalho: Ctrl+Z
 * Mant√©m visualmente consistente (remove ponto e linha associada)
 */
    function desfazerUltimoPonto() {
        if (pontosRota.length > 0) {
            // Remove a √∫ltima coordenada da mem√≥ria
            pontosRota.pop();
            
            // Remove o √∫ltimo desenho (bolinha ou linha)
            // O Leaflet adiciona camadas em ordem, ent√£o remover a √∫ltima funciona visualmente
            const camadas = grupoRota.getLayers();
            if (camadas.length > 0) {
                grupoRota.removeLayer(camadas[camadas.length - 1]); // Remove a bolinha
                if (camadas.length > 1) { // Se tinha linha ligando, remove ela tamb√©m
                     grupoRota.removeLayer(camadas[camadas.length - 2]); 
                }
            }
        }
    }
    // Inicializa√ß√£o
    carregarMapaPrincipal();
    </script>
</body>
</html>